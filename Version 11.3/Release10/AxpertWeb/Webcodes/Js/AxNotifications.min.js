/*https://web.agile-labs.com/minZIP/*//*version=3.9.1*/function _classCallCheck(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function _createClass(t,n,e){return n&&_defineProperties(t.prototype,n),e&&_defineProperties(t,e),Object.defineProperty(t,"prototype",{writable:!1}),t}var notifyCount,newNotifications,reversedNotifications,apiUrl,apiSessionId,apiToken,signalrServiceinit,notificationtrigger,notifications=[],clientId=null,loginToken=null,pendingCount=0,_thisClickCount=0,readNotifications=[];$(document).ready(function(){"undefined"!=typeof signalRNotifications&&"true"==signalRNotifications&&($.ajax({type:"POST",url:"../aspx/Axpeg.aspx/AxGetARMDetails",cache:!1,async:!1,contentType:"application/json;charset=utf-8",dataType:"json",success:function(t){var n=t.d;apiUrl=n.url,apiSessionId=n.sessionId,apiToken=n.token}}),clientId="ARM-"+mainProject+"-"+mainUserName,loginToken=apiToken,(signalrServiceinit=new SignalrService).startConnection())});var SignalrService=function(){function t(){_classCallCheck(this,t),this.data=null,this.connectionId=null,this.hubConnection=(new signalR.HubConnectionBuilder).withUrl(apiUrl,{accessTokenFactory:function(){return loginToken}}).build()}return _createClass(t,[{key:"startConnection",value:function(){var t=this;this.hubConnection.start().then(function(){return t.getConnectionId()})["catch"](function(t){return console.log("Error while starting connection: "+t)})}},{key:"getConnectionId",value:function(){var t=this;this.hubConnection.invoke("getconnectionid").then(function(n){t.connectionId=n,t.passConnectionId(clientId,n),t.getMessage()})}},{key:"passConnectionId",value:function(t,n){this.hubConnection.invoke("PassConnectionId",t,n)["catch"](function(t){return console.error(t)})}},{key:"getMessage",value:function(){this.hubConnection.on("ReceiveNotification",function(t){var n=(newNotifications=JSON.parse(t)).length;pendingCount=n;newNotifications.length;notifications=notifications.concat(newNotifications),AxNotifyHistory=JSON.stringify(notifications),(notificationtrigger=document.querySelector("#notificationtrigger")).classList.add("blink"),(notifyCount=document.querySelector("#notifyCountForBlink")).classList.remove("d-none"),notifyCount.classList.add("blink");var e=document.querySelector(".floatnotification");e&&e.remove();var i=document.createElement("div");i.classList.add("floatnotification","d-flex","gap-1");var o=document.createElement("span");o.classList.add("floatnotificationSpan","text-truncate");var a,s=document.createElement("button");if(s.classList.add("notificationClose"),s.innerHTML="&times",(a=document.createElement("span")).classList.add("flotnotificationCount"),pendingCount<=1?a.innerHTML=pendingCount:(pendingCount-=1,a.innerHTML="+"+pendingCount+"Notifications"),pendingCount>=0){var c=notifications[pendingCount];c!==undefined?(o.textContent=c.title,o.title=c.title):(o.textContent=notifications[0].title,o.title=notifications[0].title)}i.appendChild(o),i.appendChild(s),i.appendChild(a),document.querySelector("body").appendChild(i),setTimeout(function(){document.querySelector(".floatnotification").remove()},5e3),(a=document.querySelector(".flotnotificationCount")).addEventListener("click",function(){var t=document.querySelector(".floatnotification"),n=document.querySelector("#notificationtrigger");t&&t.remove(),signalrServiceinit.onclick();var e=document.querySelector("#notificationtrigger"),i=KTMenu.getInstance(e),o=document.querySelector("#notificationWindowMain");i.show(o),o.style.transform="translate(370%, 45px)",signalrServiceinit.notificationEvent(),n.classList.remove("blink"),notifyCount.classList.remove("blink"),notifyCount.classList.add("d-none")}),document.querySelector(".cardsPageWrapper").addEventListener("click",function(){var t=document.querySelector("#notificationtrigger"),n=KTMenu.getInstance(t),e=document.querySelector("#notificationWindowMain");n.hide(e)}),document.querySelector(".notificationClose").addEventListener("click",function(){document.querySelector(".floatnotification").remove()})})}},{key:"init",value:function(){this.onclick(),this.notificationEvent()}},{key:"onclick",value:function(){0==_thisClickCount&&GetHistoryFromCache(),_thisClickCount++,AxNotifyHistory=JSON.stringify(notifications);var t=document.querySelector("#notificationWindow");if(0===notifications.length){t.innerHTML="";var n=document.createElement("span");t.classList.add("d-flex"),n.innerHTML="No notification available",t.appendChild(n),(notifyCount=document.querySelector("#notifyCountForBlink")).classList.add("d-none")}else{var e;t.innerHTML="",t.classList.remove("d-flex"),(notifyCount=document.querySelector("#notifyCountForBlink")).classList.remove("d-none"),notifyCount.classList.add("blink");for(var i=notifications.length-1;i>=0;i--){e=i;var o=notifications[i],a=!1;readNotifications.indexOf(o.dt)>-1&&(a=!0);var s=document.createElement("div");a?s.classList.add("d-flex","align-items-center","notificationList","col-12","px-4","py-2","border-bottom-dashed","border-1","border-gray-300","min-h-70px","mh-150px","bg-light"):s.classList.add("d-flex","align-items-center","notificationList","col-12","px-4","py-2","border-bottom-dashed","border-1","border-gray-300","min-h-70px","mh-150px"),s.setAttribute("data-index",e);var c=document.createElement("div");c.classList.add("d-flex","justify-content-end","closebtnAppend","col-1");var r=document.createElement("button");r.innerHTML="<span class='material-icons material-icons-style fs-3'>close</span>",r.setAttribute("data-index",e),r.classList.add("btn","btn-sm","btn-icon","btn-white","closeNotification"),r.title="Clear",r.onclick=function(){clearOneNotification()},c.appendChild(r);var l=document.createElement("div");l.classList.add("symbol","symbol-50px","col-2"),"tstruct"==o.type.toLowerCase()?""==o.icon?l.innerHTML='<span class="symbol-label"><img src="../images/NotificationIcons/TstructSave.png" class="w-30px"></span>':l.innerHTML='<span class="symbol-label"><img src="../images/'+o.icon+'" class="w-30px"></span>':"iview"==o.type.toLowerCase()?""==o.icon?l.innerHTML='<span class="symbol-label"><img src="../images/NotificationIcons/Defalut.png" class="w-30px"></span>':l.innerHTML='<span class="symbol-label"><img src="../images/'+o.icon+'" class="w-30px"></span>':"page"==o.type.toLowerCase()?""==o.icon?l.innerHTML='<span class="symbol-label"><img src="../images/NotificationIcons/Defalut.png" class="w-30px"></span>':l.innerHTML='<span class="symbol-label"><img src="../images/'+o.icon+'" class="w-30px"></span>':"export"==o.type.toLowerCase()&&(""==o.icon?l.innerHTML='<span class="symbol-label"><img src="../images/NotificationIcons/Defalut.png" class="w-30px"></span>':l.innerHTML='<span class="symbol-label"><img src="../images/'+o.icon+'" class="w-30px"></span>');var d=document.createElement("div");d.classList.add("d-flex","notificationText","flex-column","col-9");var u=document.createElement("a");u.classList.add("notificationText-h5","title"),u.title=o.title,u.textContent=o.title;var f=o.link;if(""!==f){if(a?u.classList.add("notificationLinkClick","h5","text-truncate","mb-0","fw-normal","cursor-pointer"):u.classList.add("notificationLinkClick","h5","text-truncate","mb-0","fw-boldest","cursor-pointer"),"t"==f.t){var p="t"+f.name+"&act="+f.act;""!=f.p&&(p+="&"+f.p),u.setAttribute("data-link",p),u.setAttribute("data-axmsgid",f.axmsgid),u.setAttribute("data-tstname",f.name)}else if("i"==f.t){var m="i"+f.name;""!=f.p&&(m+="&"+f.p),u.setAttribute("data-link",m)}else if("p"==f.t){var g="HP"+f.name;""!=f.p&&(g+="&"+f.p),u.setAttribute("data-link",g)}else if("e"==f.t){var v="e"+f.name;u.setAttribute("data-link",v)}e++}var y=document.createElement("span");y.classList.add("notificationText-sapn","message","text-truncate"),y.textContent=o.message,y.title=o.message;var h=document.createElement("span");h.classList.add("notificationText-dt","message"),h.textContent=o.dt,d.appendChild(u),d.appendChild(y),d.appendChild(h),s.appendChild(l),s.appendChild(d),s.appendChild(c),t.appendChild(s)}}}},{key:"notificationEvent",value:function(){var t=document.querySelectorAll(".notificationLinkClick"),n=document.querySelector("#notificationtrigger"),e=KTMenu.getInstance(n),i=document.querySelector("#notificationWindowMain");t.forEach(function(t){t.addEventListener("click",function(){AxNotifyMsgId="";var n=t.getAttribute("data-link");$(t).parents(".notificationList").addClass("bg-light"),$(t).removeClass("fw-boldest").addClass("fw-normal"),readNotifications.push($(t).parent().find(".notificationText-dt").text()),n.startsWith("i")?(n=n.substring(1),LoadIframe("iview.aspx?ivname=".concat(n)),e.hide(i)):n.startsWith("t")?(n=n.substring(1),AxNotifyMsgId=t.getAttribute("data-axmsgid"),LoadIframe("tstruct.aspx?transid=".concat(n)),e.hide(i)):n.startsWith("HP")?(n=n.substring(2),LoadIframe("htmlPages.aspx?load=".concat(n)),e.hide(i)):n.startsWith("e")&&(DownloadExportFile(n=n.substring(1)),e.hide(i))})});var o=document.querySelector("#notificationtrigger");o.addEventListener("mouseover",function(){o.classList.remove("blink"),notifyCount.classList.remove("blink"),notifyCount.classList.add("d-none")}),o.addEventListener("click",function(){o.classList.remove("blink"),notifyCount.classList.remove("blink"),notifyCount.classList.add("d-none")}),document.querySelectorAll(".closeNotification").forEach(function(t){t.addEventListener("click",function(n){var e=t.closest(".notificationList");if(e){var i=e.getAttribute("data-index");i=parseInt(i,10),!isNaN(i)&&i>=0&&i<notifications.length&&notifications.splice(i,1),e.classList.add("d-none")}})})}},{key:"stopConnection",value:function(){var t=this;this.hubConnection.stop().then(function(){t.hubConnection=null})["catch"](function(t){return console.log("Error while stopping connection: "+t)})}}]),t}();function DownloadExportFile(t){if(""!=t&&(t.startsWith("http:")||t.startsWith("https:"))){var n=t,e=t.substring(t.lastIndexOf("/")+1),i=document.createElement("a");i.href=n,i.download=e,document.body.appendChild(i),i.click(),document.body.removeChild(i)}else{var o=t.substring(0,t.lastIndexOf("\\")+1),a=t.substring(t.lastIndexOf("\\")+1);try{ASB.WebService.LoadExportFileToScript(o,a,successfileMoved)}catch(s){}}}function successfileMoved(t,n){if(!CheckSessionTimeout(t)){var e=t,i=t.substring(t.lastIndexOf("/")+1),o=document.createElement("a");o.href=e,o.download=i,document.body.appendChild(o),o.click(),document.body.removeChild(o)}}function clearAll(){var t=document.querySelector("#notificationWindow");t.innerHTML="";var n=document.createElement("span");t.classList.add("d-flex"),n.innerHTML="No notification available",t.appendChild(n),notifications=[],document.querySelector("#notificationtrigger").click()}function GetHistoryFromCache(){$.ajax({type:"POST",url:"../aspx/Axpeg.aspx/AxGetNotifyHistory",cache:!1,async:!1,contentType:"application/json;charset=utf-8",dataType:"json",success:function(t){if(""!=t.d){for(var n=JSON.parse(t.d),e=0;e<n.length;e++)readNotifications.push(n[e].dt);if(notifications.length>0){var i=notifications;notifications=(notifications=(notifications=[]).concat(n)).concat(i)}else notifications=notifications.concat(n)}}})}function removeSavedtranNotify(t,n){try{if(""==n||"0"==n)for(var e=notifications.length-1;e>=0;e--){"cachedsave"==(i=notifications[e]).notifytype&&i.link.name==t&&""==i.link.p&&notifications.splice(e,1)}else for(e=notifications.length-1;e>=0;e--){var i;"cachedsave"==(i=notifications[e]).notifytype&&i.link.name==t&&i.link.p.indexOf(n)>-1&&notifications.splice(e,1)}}catch(o){}}
/*https://web.agile-labs.com/minZIP/*//*version=3.9.1*/var xlresult,xlGridfieldNames,xlDcNo,xlRowCount,IsgridummyRow=!1;function ImportGridData(){var e="",t=[],l=[],a=[],r="",n="";callParentNew("gridDummyRowVal").length>0&&callParentNew("gridDummyRowVal").map(function(e){e.split("~")[0]==xlDcNo&&(IsgridummyRow=!0)});for(var o=1;o<xlresult.length;o++){if(xlRowCount>0&&!IsgridummyRow){var i=xlRowCount+o;e+="i"+i+",",l.push({n:xlGridfieldNames[0],v:"0",r:i.toString(),t:"s"})}else e+="i"+o+",",l.push({n:xlGridfieldNames[0],v:"0",r:o.toString(),t:"s"});for(var c=0;c<xlresult[o].length;c++)if(n="undefined"!=typeof xlresult[o][c]?xlresult[o][c]:"",(r=xlresult[0][c]).indexOf("(")>-1&&r.endsWith(")")&&(r=r.split("(")[1].split(")")[0]),""!=n&&(n=n.toString()),xlRowCount>0&&!IsgridummyRow){var s=xlRowCount+o;a.push({n:r,v:n,r:s.toString(),t:"s"})}else a.push({n:r,v:n,r:o.toString(),t:"s"})}e=e.slice(0,-1),t.push({n:"DC"+xlDcNo,v:xlDcNo,cr:e,t:"dc",hasdatarows:"yes"});var d=[];d=d.concat(t,l,a),callParentNew("AxActiveDc=",xlDcNo);try{callParentNew("gridDummyRowVal").length>0&&callParentNew("gridDummyRowVal").map(function(e){e.split("~")[0]==xlDcNo&&callParentNew("gridDummyRowVal").splice($.inArray(e,callParentNew("gridDummyRowVal")),1)})}catch(D){}parent.ExecData(d,"LoadData",!0),callParentNew("closeModalDialog()","function");var u=parent.$("#gridHd"+xlDcNo+" tbody tr").length,m="",f=!1;for(c=1;c<=u;c++){callParentNew("AxActiveRowNo=",c),m=c<=9?"00"+c:c>9&&c<=99?"0"+c:c;for(var g=0;g<xlGridfieldNames.length;g++){"axp_formula"==xlGridfieldNames[g].toLowerCase()&&(f=!0);var p=xlGridfieldNames[g]+m+"F"+xlDcNo,w=$j.inArray(xlGridfieldNames[g],parent.FNames);"True"==parent.FFieldHidden[w]&&(parent.EvaluateAxFunction(xlGridfieldNames[g],p,m+"F"+xlDcNo),parent.EvaluateExpressions(p))}}if(f){m="";var x=parent.GetFieldIndex("axp_formula"),N=parent.FNames[x];for(o=1;o<=u;o++){var h=N+(m=o<=9?"00"+o:o>9&&o<=99?"0"+o:o)+"F"+xlDcNo;parent.ValidateFldValFormula(parent.$("#"+h),x,N)}}}$(function(){$("#excelimport").click(function(){if(callParentNew("gridDummyRowVal").length>0&&callParentNew("gridDummyRowVal").map(function(e){e.split("~")[0]==xlDcNo&&(IsgridummyRow=!0)}),xlRowCount>0&&!IsgridummyRow)var e=$.confirm({theme:"modern",title:appGlobalVarsObject.lcm[155],closeIcon:!0,onContentReady:function(){disableBackDrop("bind")},backgroundDismiss:"false",escapeKey:"buttonB",content:"Do You Want to Append?<br> Yes will Append, No will clear the existing data and import again!",buttons:{buttonA:{text:"Yes",btnClass:"btn btn-primary",action:function(){ImportGridData(),e.close()}},buttonB:{text:"No",btnClass:"btn btn-bg-light btn-color-danger btn-active-light-danger",action:function(){IsgridummyRow=!1,parent.$j("#chkallgridrow"+xlDcNo).prop("checked","checked"),parent.clearDataGrid(xlDcNo,"excelimport"),xlRowCount=0;var e=setInterval(function(){"false"==callParentNew("isExcelImpDelWS")&&(clearInterval(e),ImportGridData())},2e3);disableBackDrop("destroy")}}}});else ImportGridData()})}),$j(document).ready(function(){$("#excelfile").bind({change:function change(e){var filename=$("#excelfile").val(),fName=filename.toString().split("\\");filename=fName[fName.length-1],$("#noFile").text(filename);var file=e.target.files[0],files=e.target.files,f=files[0],FR=new FileReader;FR.onload=function(e){var data=new Uint8Array(e.target.result),workbook=XLSX.read(data,{type:"array",cellDates:!0,dateNF:"dd/mm/yyyy;@"}),firstSheet=workbook.Sheets[workbook.SheetNames[0]],result=XLSX.utils.sheet_to_json(firstSheet,{header:1,raw:!1});if(0!=result.length&&(result=result.filter(function(e){return e.some(function(e){return""!==e&&null!==e})})),0!=result.length){var dcNo=window.location.href.split("=")[1],gridFieldNames=callParentNew("GetGridFields("+dcNo+")","function"),gridRowCount=callParentNew("GetDcRowCount("+dcNo+")","function"),gridFieldAlongwithCap=[];gridFieldNames.forEach(function(e,t){var l=parent.FNames.indexOf(e),a=parent.FCaption[l];gridFieldAlongwithCap.push(a+"("+e+")")});var check=gridFieldNames.some(function(e){return result[0].includes(e)}),checkwithCap=gridFieldAlongwithCap.some(function(e){return result[0].includes(e)});check||checkwithCap?0!=result[1].length?(xlresult=result,xlGridfieldNames=gridFieldNames,xlRowCount=gridRowCount,xlDcNo=dcNo):showAlertDialog("error",eval(callParent("lcm[511]"))):showAlertDialog("error",eval(callParent("lcm[510]")))}else showAlertDialog("error",eval(callParent("lcm[509]")))},FR.readAsArrayBuffer(file)}})});
/*https://web.agile-labs.com/minZIP/*//*version=3.9.1*/var fldAutoData=[],fldAutoList="",fldExpData=[],colNames=[],colVExp=[],colfExp=[],aportionWhat=[],aportionAgainst=[],aportionWhatVal=[],isQuery="",QueryData="",colSource=[],thisFldId="",valuesep="",rowsep="",rowObj=$(),isfromSqlExec=!1;function LoadTableEvents(dvId){var autoDiv=dvId==undefined?"#divDc1":dvId;tblAutoComplete(autoDiv+" .tblAutocom"),$j(autoDiv).find(".tblAutocom").autocomplete(),$j(dvId+" .date").removeClass("hasDatepicker");var glType=eval(callParent("gllangType")),dtpkrRTL=!1;dtpkrRTL="ar"==glType;var glCulture=eval(callParent("glCulture")),dtFormat="dd/mm/yy";"en-us"==glCulture&&(dtFormat="mm/dd/yy"),$j(dvId+" .date").datepicker({isRTL:dtpkrRTL,dateFormat:dtFormat,changeMonth:!0,changeYear:!0}),$j(dvId+" .number").unbind("keypress"),$j(".number").keypress(function(e){return CheckNumeric(e,$j(this).val())}),$j("input.number").on("input",function(){var e=$j(this).val(),t=$j(this).attr("id"),a=$j(this).attr("data-fInd");if(t!=undefined){var l=callParentNew("FMaxLength")[a],n=callParentNew("FDecimal")[a];if(n!=undefined&&n>0){var o=l-n-1;if(-1==e.indexOf("."))e.length>o&&$j(this).val(e.slice(0,o));else if(-1!=e.indexOf(".")){var i=e.substring(0,e.indexOf(".")),r=e.substring(e.indexOf(".")+1,e.length);i.length>o&&(i=i.slice(0,o)),r.length>n&&(r=r.slice(0,n)),$j(this).val(i+"."+r)}}}}),$j(":text").unbind("blur"),$j(":text").blur(function(e){MainBlur($j(this),"input")}),$j("select").unbind("change"),$j("select").change(function(){MainBlur($j(this),"select")})}function tblAutoComplete(e){var t={my:"left top",at:"left bottom"};$("body").hasClass("btextDir-rtl")&&(t={my:"right top",at:"right bottom"});var a=$(e);a.each(function(){var e=$(this);e.data("uiAutocomplete")&&e.autocomplete("destroy"),e.data("ui-Autocomplete")&&e.autocomplete("destroy")}),a.autocomplete({minLength:0,selectFirst:!0,autoFocus:!0,position:t,source:function(e,t){var a=$(this.element).attr("data-id");if(fldAutoList!=a&&GetTblFldAutoData(a),void 0!==fldAutoData&&fldAutoData.length>0){var l=[];""!=e.term?($(fldAutoData).each(function(t,a){(a=a.replace(/\^\^dq/g,'"')).toLowerCase().indexOf(e.term.toLowerCase())>=0&&l.push(a)}),t(l)):t(fldAutoData)}else t(fldAutoData)},search:function(e,t){$(this).autocomplete("option","delay",300)}}),$(".tblFldAutoClick").off("click"),$(".tblFldAutoClick").click(function(e){var t=$(this).attr("data-clk");""!=$("#"+t).val()&&$("#"+t).val(""),$("#"+t).focus().autocomplete("search",$("#"+t).val())})}function GetTableHtml(){var e="",t="";try{parent.ChangedTblFields=new Array,parent.ChangedTblFieldVals=new Array,thisFldId=$("#hdnfieldId").val();var a="",l=!1,n="",o="";if(void 0!==thisFldId&&"fromsqlexec"==thisFldId)isfromSqlExec=!0,a=callParentNew("_sqlParStr"),l=!1,n="",o=callParentNew("_sqlTblJson");else{a=$(callParentNew(thisFldId,"id")).val(),l=$(callParentNew(thisFldId,"id")).prop("disabled"),n=callParentNew("GetFieldsRowNo("+thisFldId+")","function");var i=thisFldId.substring(0,thisFldId.lastIndexOf("F")-3),r=callParentNew("GetFieldIndex("+i+")","function");o=callParentNew("FTableTypeVal")[r]}if(""!=o){if((o=RepSpecialCharsInHTML(o)).startsWith("{")||o.startsWith("db@"))o.startsWith("db@")&&(t=o=GetDBProcTableJson(o));else{var s=o.split("~")[1],d=callParentNew("GetDcNo("+s+")","function");t=o=GetstrTableJson("True"==parent.DCIsGrid[d-1]?$(callParentNew(s+n+"F"+d,"id")).val():$(callParentNew(s+"000F"+d,"id")).val())}var c=JSON.parse(o);if(void 0!==c){var p=c.props.type,u=c.props.colcount,f=c.props.rowcount,v=c.props.deleterow,h=c.props.addrow;rowsep=c.props.rowseparator,valuesep=c.props.valueseparator,"undefined"!=typeof c.props.sql&&(isQuery=c.props.sql);var m=1==l?"disabled":"";if("table"==p){var b="";""!=a&&(b=a.split(rowsep)).length>f&&(f=b.length),""==b&&"true"==isQuery&&SqlFillData();var g="",y="";g+='<tr class="fw-bold fs-6 text-gray-800 border-bottom-2 border-gray-200">',"t"!=v.toLowerCase()&&"true"!=v.toLowerCase()||(g+="<th></th>");for(var w=0;w<u;w++){var N=c.columns[w+1].caption,F="";"undefined"!=typeof c.columns[w+1].hide&&""!=c.columns[w+1].hide&&(F="t"==c.columns[w+1].hide.toLowerCase()?" d-none ":""),colNames.push(c.columns[w+1].name),parent.ChangedTblFields.push(c.columns[w+1].name),parent.ChangedTblFieldVals.push(""),g+=""!=F?'<th class="'+F+'">'+N+"</th>":"<th>"+N+"</th>";var x=c.columns[w+1].exp;colfExp.push(x);var C="";if(""!=x&&(x=x.replace(/,/g,"♦"),C=callParentNew("Evaluate("+c.columns[w+1].name+",000,"+x+",expr,table)","function")),fldExpData.push(C),colVExp.push(c.columns[w+1].vexp),"undefined"!=typeof c.columns[w+1].aportionwhat&&""!=c.columns[w+1].aportionwhat){aportionWhat.push(c.columns[w+1].aportionwhat);var I=c.columns[w+1].aportionwhat,T=$j($j("[id*='"+I+"']",doParentOpInIframe("document","rtn","[id*='"+I+"']")).find("input")).attr("id");aportionWhatVal.push($(callParentNew(T,"id")).val())}else aportionWhat.push(""),aportionWhatVal.push("");"undefined"!=typeof c.columns[w+1].aportionagainst?aportionAgainst.push(c.columns[w+1].aportionagainst):aportionAgainst.push("")}g+="</tr>";for(var D=0;D<f;D++){var j="";"undefined"!=typeof b[D]&&""!=b[D]&&""!=b&&(j=(j=b[D]).split(valuesep)),y+="<tr id="+D+">","t"!=v.toLowerCase()&&"true"!=v.toLowerCase()||(y+='<td style="text-align:center;"><input type="checkbox" class="fgChk" name="chkItem" onclick="javascript:ChkHdrCheckbox(this);"></td>');var P=function(){var e="";e="undefined"!=typeof j[w]&&""!=j[w]&&""!=j?j[w]:"undefined"!=typeof fldExpData[w]&&""!=fldExpData[w]?fldExpData[w]:"undefined"!=typeof aportionWhatVal[w]&&""!=aportionWhatVal[w]&&0==D?aportionWhatVal[w]:c.columns[w+1].value;var t=c.columns[w+1].source,a="";"undefined"!=typeof c.columns[w+1].allowempty&&""!=c.columns[w+1].allowempty&&(a="f"==c.columns[w+1].allowempty.toLowerCase()?" data-ae='false' ":"");var l="";"undefined"!=typeof c.columns[w+1].allowduplicate&&""!=c.columns[w+1].allowduplicate&&(l="f"==c.columns[w+1].allowduplicate.toLowerCase()?" data-ad='false' ":"");var o="";"undefined"!=typeof c.columns[w+1].readyonly&&""!=c.columns[w+1].readyonly&&(o="t"==c.columns[w+1].readyonly.toLowerCase()?" disabled ":"");var i="";"undefined"!=typeof c.columns[w+1].hide&&""!=c.columns[w+1].hide&&(i="t"==c.columns[w+1].hide.toLowerCase()?" d-none ":""),colSource.push(t);var r=callParentNew("GetFieldIndex("+t+")","function"),s=(callParentNew("GetDWBFieldType('',"+r+")","function"),callParentNew("GetDcNo("+t+")","function")),d=t+n+"F"+s;if("Select"==callParentNew("FMoe")[r])if("True"==callParentNew("FldIsSql")[r])y+='<td class="'+i+'"><div class="autoinput-parent">',y+="<input "+m+o+a+l+' type="text" class="combotem Family form-control tblAutocom fldtableinput" name="'+colNames[w]+'" id="'+colNames[w]+"R"+D+'" value="'+e+'" data-id="'+d+'">',y+='<div class="edit"><i class="glyphicon glyphicon-chevron-down tblFldAutoClick" title="select" data-clk='+colNames[w]+"R"+D+"></i></div>",y+="</div></td>";else if(V="",$(callParentNew(d)).find("option").each(function(){""!=e&&$(this)[0].value==e?V+=$(this)[0].outerHTML.replace("<option ","<option selected "):V+=$(this)[0].outerHTML.replace('selected="selected"',"")}),""==V){var p=$(callParentNew(d)).data("val").split(","),u=""==$(callParentNew(d)).val()?e:$(callParentNew(d)).val();for(S=0;S<p.length;S++)""!=u&&u==p[S]?V+='<option selected="selected" value="'+p[S]+'">'+(""==p[S]?"-- Select --":p[S])+"</option>":V+='<option value="'+p[S]+'">'+(""==p[S]?"-- Select --":p[S])+"</option>";y+='<td class="'+i+'"><select '+m+o+a+l+' class="tem Family form-control" name="'+colNames[w]+'" id="'+colNames[w]+"R"+D+'" value="'+u+'">'+V+"</select></td>"}else y+='<td class="'+i+'"><select '+m+o+a+l+' class="tem Family form-control" name="'+colNames[w]+'" id="'+colNames[w]+"R"+D+'" value="'+e+'">'+V+"</select></td>";else if("Accept"==callParentNew("FMoe")[r]&&"True"==callParentNew("FldIsSql")[r])y+='<td class="'+i+'"><input '+m+o+a+l+' type="text" class="tem Family form-control fldtableinput" name="'+colNames[w]+'" id="'+colNames[w]+"R"+D+'" value="'+e+'"></td>';else if("undefined"!=typeof aportionWhat[w]&&""!=aportionWhat[w])y+='<td class="'+i+'"><input '+m+o+a+l+' type="text" class="tem Family form-control fldtableinput" readonly name="'+colNames[w]+'" id="'+colNames[w]+"R"+D+'" value="'+e+'"></td>';else if("Numeric"==callParentNew("FDataType")[r])y+='<td class="'+i+'"><input '+m+o+a+l+' type="text" style="text-align:right;" class="tem Family form-control number fldtableinput" data-fInd="'+r+'" name="'+colNames[w]+'" id="'+colNames[w]+"R"+D+'" value="'+e+'"></td>';else if("Date/Time"==callParentNew("FDataType")[r])y+='<td class="input-group '+i+'"><input '+m+o+a+l+' type="text" class="tem Family form-control flatpickr-input fldtableinput" name="'+colNames[w]+'" id="'+colNames[w]+"R"+D+'" value="'+e+'">',y+='<span class="input-group-addon spandate "><i class="glyphicon glyphicon-calendar icon-basic-calendar" title='+colNames[w]+"></i></span></td>";else if(""!=t&&"Accept"==callParentNew("FMoe")[r]&&""!=$(callParentNew(d)).val()&&$(callParentNew(d)).val().indexOf(",")>0){var f=$(callParentNew(d)).val().split(","),v=e;for(V="",V+='<option value="">-- Select --</option>',S=0;S<f.length;S++)""!=v&&v==f[S]?V+='<option selected="selected" value="'+f[S]+'">'+f[S]+"</option>":V+='<option value="'+f[S]+'">'+f[S]+"</option>";y+='<td class="input-group-sm '+i+'"><select '+m+o+a+l+' class="tem Family form-control" name="'+colNames[w]+'" id="'+colNames[w]+"R"+D+'" value="'+v+'">'+V+"</select></td>"}else isfromSqlExec&&"datatypefld"==colNames[w]?(V="",V+='<option selected="selected" value="c">'+e+"</option>",V+='<option value="n">Numeric</option>',V+='<option value="d">Date/Time</option>',y+='<td class="input-group-sm '+i+'"><select '+m+o+a+l+' class="tem Family form-control" name="'+colNames[w]+'" id="'+colNames[w]+"R"+D+'" value="c">'+V+"</select></td>"):y+='<td class="input-group-sm '+i+'"><input '+m+o+a+l+' type="text" class="tem Family form-control fldtableinput" name="'+colNames[w]+'" id="'+colNames[w]+"R"+D+'" value="'+e+'"></td>';parent.ChangedTblFieldVals[w]=0==D?e:parent.ChangedTblFieldVals[w]+"~"+e};for(w=0;w<u;w++){P()}y+="</tr>"}e="<div>",e+="<div>","t"!=h.toLowerCase()&&"true"!=h.toLowerCase()||(e+='<div class="pull-left"><i class="glyphicon glyphicon-plus" title="Add" onclick="AddTableRows(\'fldTable\');"></i></div>'),"t"!=v.toLowerCase()&&"true"!=v.toLowerCase()||(e+='<div class="pull-left"><i class="glyphicon cup glyphicon-trash" title="Delete" onclick="DeleteTableRows(\'fldTable\');"></i></div>'),""!=isQuery&&(e+='<div class="pull-left"><i class="glyphicon glyphicon-list" title="Fill Data" onclick="SqlFillData();"></i></div>'),e+='<table id="fldTable" class="table">',e+="<thead>",e+=g,e+="</thead>",e+="<tbody>",e+=y,e+="</tbody>",e+="</table>",e+="</div>",e+="<div></div>",e+='<div><input type="button" class="coldbtn btn" value="Clear" onclick="ClearTableData(\'fldTable\');" /><input type="button" class="hotbtn btn" value="Ok" onclick="AddTableData(\''+thisFldId+"','"+valuesep+"','"+rowsep+'\');" style="float: right;"/></div>',e+="</div>",""==b&&"sqlDescr"==isQuery&&setTimeout(function(){SqlFillData()},0)}else{var A="";""!=a&&(A=(A=a).split(valuesep));var R='<div id="divtblForm" >',k=function(){var e="";"undefined"!=typeof c.columns[w+1].hide&&""!=c.columns[w+1].hide&&(e="t"==c.columns[w+1].hide.toLowerCase()?" d-none ":"");var t=c.columns[w+1].caption;R+='<div class="col-lg-12 col-sm-3 col-md-3 col-xs-12 '+e+'"><label>'+t+"</label></div>",R+='<div class="col-lg-12 col-sm-9 col-md-9 col-xs-12 '+e+'">',colNames.push(c.columns[w+1].name),parent.ChangedTblFields.push(c.columns[w+1].name),parent.ChangedTblFieldVals.push("");var a=c.columns[w+1].exp;if(colfExp.push(a),C="",""!=a&&(a=a.replace(/,/g,"♦"),C=callParentNew("Evaluate("+c.columns[w+1].name+",000,"+a+",expr,table)","function")),fldExpData.push(C),colVExp.push(c.columns[w+1].vexp),"undefined"!=typeof c.columns[w+1].aportionwhat&&""!=c.columns[w+1].aportionwhat){aportionWhat.push(c.columns[w+1].aportionwhat);var l=c.columns[w+1].aportionwhat;T=$j($j("[id*='"+l+"']",doParentOpInIframe("document","rtn","[id*='"+l+"']")).find("input")).attr("id"),aportionWhatVal.push($(callParentNew(T,"id")).val())}else aportionWhat.push(""),aportionWhatVal.push("");"undefined"!=typeof c.columns[w+1].aportionagainst?aportionAgainst.push(c.columns[w+1].aportionagainst):aportionAgainst.push("");var o="";o="undefined"!=typeof A[w]&&""!=A[w]&&""!=A?A[w]:"undefined"!=typeof fldExpData[w]&&""!=fldExpData[w]?fldExpData[w]:"undefined"!=typeof aportionWhatVal[w]&&""!=aportionWhatVal[w]?aportionWhatVal[w]:c.columns[w+1].value;var i=c.columns[w+1].source,r="";"undefined"!=typeof c.columns[w+1].allowempty&&""!=c.columns[w+1].allowempty&&(r="f"==c.columns[w+1].allowempty.toLowerCase()?" data-ae='false' ":"");var s="";"undefined"!=typeof c.columns[w+1].allowduplicate&&""!=c.columns[w+1].allowduplicate&&(s="f"==c.columns[w+1].allowduplicate.toLowerCase()?" data-ad='false' ":"");var d="";"undefined"!=typeof c.columns[w+1].readyonly&&""!=c.columns[w+1].readyonly&&(d="t"==c.columns[w+1].readyonly.toLowerCase()?" disabled ":""),colSource.push(i);var p=callParentNew("GetFieldIndex("+i+")","function"),u=(callParentNew("GetDWBFieldType('',"+p+")","function"),callParentNew("GetDcNo("+i+")","function")),f=i+n+"F"+u;if("Select"==callParentNew("FMoe")[p])if("True"==callParentNew("FldIsSql")[p])R+='<div class="autoinput-parent">',R+="<input "+m+d+r+s+' type="text" name='+colNames[w]+' class="combotem Family form-control tblAutocom fldtableinput" name="'+colNames[w]+'" id="'+colNames[w]+'R0" value="'+o+'" data-id="'+f+'">',R+='<div class="edit"><i class="glyphicon glyphicon-chevron-down tblFldAutoClick" title="select" data-clk='+colNames[w]+"R0></i></div>",R+="</div>";else if(V="",$(callParentNew(f)).find("option").each(function(){""!=o&&$(this)[0].value==o?V+=$(this)[0].outerHTML.replace("<option ","<option selected "):V+=$(this)[0].outerHTML.replace('selected="selected"',"")}),""==V){var v=$(callParentNew(f)).data("val").split(","),h=""==$(callParentNew(f)).val()?o:$(callParentNew(f)).val();for(S=0;S<v.length;S++)""!=h&&h==v[S]?V+='<option selected="selected" value="'+v[S]+'">'+(""==v[S]?"-- Select --":v[S])+"</option>":V+='<option value="'+v[S]+'">'+(""==v[S]?"-- Select --":v[S])+"</option>";R+="<select "+m+d+r+s+' class="tem Family form-control" name="'+colNames[w]+'" id="'+colNames[w]+'R0" value="'+h+'">'+V+"</select>"}else R+="<select "+m+d+r+s+' class="tem Family form-control" name="'+colNames[w]+'" id="'+colNames[w]+'R0" value="'+o+'">'+V+"</select>";else if("Accept"==callParentNew("FMoe")[p]&&"True"==callParentNew("FldIsSql")[p])R+="<input "+m+d+r+s+' type="text" class="tem Family form-control fldtableinput" name="'+colNames[w]+'" id="'+colNames[w]+'R0" value="'+o+'">';else if("undefined"!=typeof aportionWhat[w]&&""!=aportionWhat[w])R+="<input "+m+d+r+s+' type="text" class="tem Family form-control fldtableinput" readonly name="'+colNames[w]+'" id="'+colNames[w]+'R0" value="'+o+'">';else if("Numeric"==callParentNew("FDataType")[p])R+="<input "+m+d+r+s+' type="text" style="text-align:right;" class="tem Family form-control number fldtableinput" data-fInd="'+p+'" name="'+colNames[w]+'" id="'+colNames[w]+'R0" value="'+o+'">';else if("Date/Time"==callParentNew("FDataType")[p])R+='<div class="input-group"><input '+m+d+r+s+' type="text" class="tem Family form-control date hasDatepicker fldtableinput" name="'+colNames[w]+'" id="'+colNames[w]+'R0" value="'+o+'">',R+='<span class="input-group-addon spandate "><i class="glyphicon glyphicon-calendar icon-basic-calendar" title="'+colNames[w]+'"></i></span></div>';else if(""!=i&&"Accept"==callParentNew("FMoe")[p]&&""!=$(callParentNew(f)).val()&&$(callParentNew(f)).val().indexOf(",")>0){var b=$(callParentNew(f)).val().split(","),g=o;for(V="",V+='<option value="">-- Select --</option>',S=0;S<b.length;S++)""!=g&&g==b[S]?V+='<option selected="selected" value="'+b[S]+'">'+b[S]+"</option>":V+='<option value="'+b[S]+'">'+b[S]+"</option>";R+="<select "+m+d+r+s+' class="tem Family form-control" name="'+colNames[w]+'" id="'+colNames[w]+'R0" value="'+g+'">'+V+"</select>"}else R+="<input "+m+d+r+s+' type="text" class="tem Family form-control fldtableinput" name="'+colNames[w]+'" id="'+colNames[w]+'R0" value="'+o+'">';parent.ChangedTblFieldVals[w]=0==w?o:parent.ChangedTblFieldVals[w]+"~"+o,R+='</div><div class="clearfix"></div>'};for(w=0;w<u;w++){var V,S;k()}e="<div>",e+=R+="</div>",e+='</div><div class="clearfix"></div>',e+='<div><div class="col-lg-12 col-sm-12 col-md-12 col-xs-12"><input type="button" class="coldbtn btn" value="Clear" onclick="ClearTableData(\'fldTable\');" /><input type="button" class="hotbtn btn" value="Ok" onclick="AddTableData(\''+thisFldId+"','"+valuesep+"','"+rowsep+'\');" style="float: right;"/></div></div>'}}}}catch(O){}$("#divTable").html(e);try{parent.AxAfterTableLoad(t)}catch(O){}}function AddTableData(){var e="",t=!0,a="";if($("#fldTable tbody tr").length>0)$("#fldTable tbody tr").each(function(){var l="",n=0;$(this).find("td").each(function(){if($(this).find("select").length>0&&void 0!==$(this).find("select").attr("value"))l+=$(this).find("select").attr("value")+valuesep,n++;else if($(this).find("input:text").length>0){if(void 0!==$(this).find("input").data("ae")&&0==$(this).find("input").data("ae")&&""==$(this).find("input").attr("value"))return callParentNew('showAlertDialog("error",'+$(this).find("input").attr("id")+" cannot be left empty.)","function"),$(this).find("input").focus(),t=!1,!1;if(void 0!==$(this).find("input").data("ad")&&0==$(this).find("input").data("ad")&&""!=$(this).find("input").attr("value")){var e=$(this).find("input").attr("name")+"~"+$(this).find("input").attr("value")+"♠";if(a.indexOf(e)>-1)return callParentNew('showAlertDialog("error",'+$(this).find("input").attr("id")+" duplicate value not allowed.)","function"),$(this).find("select").focus(),t=!1,!1;a+=$(this).find("input").attr("name")+"~"+$(this).find("input").attr("value")+"♠"}l+=$(this).find("input").attr("value")+valuesep,n++}}),l!=valuesep.repeat(n)||"ad_i"!=parent.transid&&"ad_iq"!=parent.transid||(l=""),""!=l&&(l=l.substring(0,l.length-1)),e+=l+rowsep});else{var l="";$("#divTable").find("input,select").each(function(){if($(this).is("select")&&void 0!==$(this).attr("value"))l+=$(this).attr("value")+valuesep;else if($(this).is("input")&&"text"==$(this).attr("type")){if(void 0!==$(this).data("ae")&&0==$(this).data("ae")&&""==$(this).attr("value"))return callParentNew('showAlertDialog("error",'+$(this).attr("name")+" cannot be left empty.)","function"),$(this).find("input").focus(),t=!1,!1;l+=$(this).attr("value")+valuesep}}),""!=l&&(l=l.substring(0,l.length-1)),e+=l+rowsep}if(t){isfromSqlExec?(e=e.substring(0,e.length-1),parent._sqlTblValues=e):(e=e.substring(0,e.length-1),$j("#"+thisFldId,doParentOpInIframe("document","rtn","#"+thisFldId)).val(e),UpdateArray(thisFldId,e)),closeUploadDialog();try{parent.AxAfterAddTableData()}catch(n){}}}function ClearTableData(e){$("#"+e+" tbody tr td").each(function(){$(this).find("input:text").val(""),$(this).find("input:text").attr("value",""),$(this).find("select").val(""),$(this).find("select").prop("selected",!1)})}function DeleteTableRows(e){$("#"+e+" tbody tr").each(function(){void 0!==$(this).find(".fgChk:checked").prop("checked")&&$(this).find(".fgChk:checked").prop("checked")&&(1==$("#"+e+" tbody tr").length&&($j(".fgHdrChk").prop("checked",!1),rowObj=$(this).clone()),$(this).remove())})}function AddTableRows(e){var t=$("#"+e+" tbody tr:last"),a="-1";0==t.length?(rowObj.find("input:text").val(""),$("#"+e+" tbody").append(rowObj)):(a=$("#"+e+" tbody tr:last").attr("id"),$(t).clone().insertAfter(t).find("input:text").val("")),$("#"+e+" tbody tr:last").find(".fgChk").prop("checked",!1),$j(".fgHdrChk").prop("checked",!1),$("#"+e+" tbody tr:last").find("select,input,div.autoclear i,div.edit i,div[id^=autoadv],div[id^=autoadv] i").each(function(e,t){var l=$j(this);if(id=l.attr("data-clk"),id!=undefined)l.attr("data-clk",$j(this).parents(".autoinput-parent").find("input").attr("id"));else{var n=l.attr("name"),o=n+"R"+(parseInt(a)+1);l.attr("id",o),l.removeAttr("value").attr("value","")}}),$("#"+e+" tbody tr:last").attr("id",(parseInt(a)+1).toString()),LoadTableEvents("#divTable")}function MainBlur(obj,type){var fldInd=colNames.indexOf(obj.attr("name"));if("undefined"!=typeof colVExp[fldInd]&&""!=colVExp[fldInd]){var vExp=colVExp[fldInd].replace(/,/g,"♦"),vRowNo=obj.attr("id").replace(obj.attr("name")+"R",""),indx=$j.inArray(obj.attr("name"),parent.ChangedTblFields),cellVal=parent.ChangedTblFieldVals[indx].split("~");cellVal[vRowNo]=$(obj).val(),parent.ChangedTblFieldVals[indx]=cellVal.join("~");var fResult=callParentNew("Evaluate("+obj.attr("name")+","+vRowNo+","+vExp+",vexpr,table)","function");if("T"!=fResult&&"t"!=fResult&&1!=fResult){var cutMsg=eval(callParent("lcm[52]")),firstChar=fResult.substring(0,1),alertMsg=fResult.substring(1);if("_"!=firstChar){if("?"==firstChar){if(showAlertDialog("error",alertMsg),"input"==type)$(obj).val($(obj).val()),$(obj).attr("value",$(obj).val());else{var ddlValue=$j(obj).val();$j(obj).attr("selected","selected"),$(obj).attr("value",ddlValue)}return!1}if("*"==firstChar)return showAlertDialog("error",alertMsg),!1;if("MessageSetAxFont"==fResult)return!0;if(confirm(fResult+". "+cutMsg)){if("input"==type)$(obj).val($(obj).val()),$(obj).attr("value",$(obj).val());else{var _ddlValue=$j(obj).val();$j(obj).attr("selected","selected"),$(obj).attr("value",_ddlValue)}return!1}return!0}showAlertDialog("error",alertMsg)}TableEvalonBlur(indx,vRowNo)}else{if("input"==type)$(obj).val($(obj).val()),$(obj).attr("value",$(obj).val());else{var _ddlValue2=$j(obj).val();$j(obj).attr("selected","selected"),$(obj).attr("value",_ddlValue2)}var vRowNo=obj.attr("id").replace(obj.attr("name")+"R",""),indx=$j.inArray(obj.attr("name"),parent.ChangedTblFields),cellVal=parent.ChangedTblFieldVals[indx].split("~");cellVal[vRowNo]=$(obj).val(),parent.ChangedTblFieldVals[indx]=cellVal.join("~"),TableEvalonBlur(indx,vRowNo)}Aportion(obj)}function TableEvalonBlur(e,t){if("undefined"!=typeof colfExp[e]&&""==colfExp[e])for(var a=e;a<colfExp.length;a++)if("undefined"!=typeof colfExp[a]&&""!=colfExp[a]){var l=colfExp[a].replace(/,/g,"♦"),n=$("#"+colNames[a]+"R"+t),o=$j.inArray(n.attr("name"),parent.ChangedTblFields),i=parent.ChangedTblFieldVals[o].split("~");i[t]=$(n).val(),parent.ChangedTblFieldVals[o]=i.join("~");var r=callParentNew("Evaluate("+n.attr("name")+","+t+","+l+",expr,table)","function");if(""!=r){if("text"==$(n).attr("type"))$(n).val(r),$(n).attr("value",r);else{var s=r;$j(n).attr("selected","selected"),$(n).attr("value",s)}i[t]=r,parent.ChangedTblFieldVals[o]=i.join("~")}}}function UpdateArray(e,t){for(var a=!1,l=0;l<doParentOpInIframe("ChangedFields","rtn").length;l++){if(doParentOpInIframe("ChangedFields["+l+"]","rtn").toString()==e){"***"==t?(doParentOpInIframe("ChangedFields","rtn").splice(l,1),doParentOpInIframe("ChangedFieldDbRowNo","rtn").splice(l,1),doParentOpInIframe("ChangedFieldValues","rtn").splice(l,1),doParentOpInIframe().ChangedFieldOldValues.splice(l,1)):(doParentOpInIframe("ChangedFieldOldValues["+l+"]","var",doParentOpInIframe("ChangedFieldValues["+l+"]","rtn").toString()),doParentOpInIframe("ChangedFieldDbRowNo["+l+"]","var",doParentOpInIframe("ChangedFieldDbRowNo["+l+"]","rtn")),doParentOpInIframe("ChangedFieldValues["+l+"]","var",t)),a=!0;break}}if(!a&&"***"!=t){var n=e.lastIndexOf("F"),o=e.substring(n-3,n),i=e.substring(n+1),r=callParentNew("GetDbRowNo("+o+","+i+")","function");parent.ChangedFields.push(e),parent.ChangedFieldDbRowNo.push(r),parent.ChangedFieldValues.push(t),parent.ChangedFieldOldValues.push("")}}function closeUploadDialog(){$(parent.$(".custom-dialog"))!=undefined&&$(parent.$(".custom-dialog")).length>0&&($(parent).focus(),$(parent.$(".custom-dialog .close"))!=undefined&&$(parent.$(".custom-dialog .close")).length>0&&$(parent.$(".custom-dialog  .close"))[$(parent.$(".custom-dialog .close")).length-1].click(),setTimeout(function(){$(parent.$(".custom-dialog"))[$(parent.$(".custom-dialog")).length-1].remove()},300))}function CheckSpecialCharsInStr(e){return e=(e=e)!=undefined?(e=(e=(e=(e=e.replace(/&/g,"&amp;")).replace(/</g,"&lt;")).replace(/>/g,"&gt;")).replace(/'/g,"&apos;")).replace(/"/g,"&quot;"):""}function RepSpecialCharsInHTML(e){return e=(e=(e=(e=(e=e.replace(/&amp;/g,"&")).replace(/&lt;/g,"<")).replace(/&gt;/g,">")).replace(/&apos;/g,"'")).replace(/&quot;/g,'"')}function CheckAll(e){$j("input[name=chkItem]:checkbox").each(function(){$j(this).prop("checked",e.checked)})}function ChkHdrCheckbox(e,t){$j(".fgChk:visible").length==$j(".fgChk:checked").length?$j(".fgHdrChk").prop("checked",!0):$j(".fgHdrChk").prop("checked",!1)}function GetTblFldAutoData(e){fldAutoData=[];var t=callParentNew("AxGetCustSelectFldData("+e+")","function");if(""!=t){fldAutoList=e;var a=JSON.parse(t).pickdata[3].data;$(a).each(function(e,t){t.i=t.i.replace(/\^\^dq/g,'"'),fldAutoData.push(t.i)})}}function Aportion(e){colNames.indexOf(e.attr("name"));var t=e.attr("name"),a=aportionAgainst.indexOf(t);if(a>-1){var l=colNames[a],n=0;$('[name="'+l+'"]').each(function(){n=parseInt(n)+parseInt(""==$(this).val()?0:$(this).val())});var o=$(e).val();if(""!=o){var i=$(e).parents("tr").find("[name='"+l+"']").val(),r=$(e).parents("tr").find("[name='"+l+"']").attr("id");if(parseInt(o)<=parseInt(i)){$($("#"+r)).val(o),$($("#"+r)).attr("value",o);var s=$(e).parents("tr").next("tr").find("[name='"+l+"']").val(),d=$(e).parents("tr").next("tr").find("[name='"+l+"']").attr("id"),c=0;if($('[name="'+l+'"]').each(function(){c=parseInt(c)+parseInt(""==$(this).val()?0:$(this).val())}),""==s&&parseInt(aportionWhatVal[a])>parseInt(o)){var p=0;p=aportionWhatVal[a]==n?aportionWhatVal[a]-parseInt(c):aportionWhatVal[a]-(n+parseInt(o)),$($("#"+d)).val(p),$($("#"+d)).attr("value",p)}else if(""!=s&&parseInt(aportionWhatVal[a])>parseInt(n));}else if(""!=i&&"0"!=i||parseInt(aportionWhatVal[a])==parseInt(n)){if(""!=i&&""==aportionWhatVal[a])$($("#"+r)).val(o),$($("#"+r)).attr("value",o);else if(parseInt(aportionWhatVal[a])!=parseInt(n)){var u=parseInt(aportionWhatVal[a])-parseInt(n),f=$(e).parents("tr").find("[name='"+l+"']").val();o>=(u+=parseInt(f))?($($("#"+r)).val(u),$($("#"+r)).attr("value",u)):($($("#"+r)).val(o),$($("#"+r)).attr("value",o))}}else $($("#"+r)).val(o),$($("#"+r)).attr("value",o)}}}function SqlFillData(){if("true"==isQuery){var e="";try{$.ajax({url:"tsttable.aspx/GetSqlFillData",type:"POST",cache:!1,async:!0,data:JSON.stringify({tstDId:callParentNew("tstDataId"),fldName:$("#hdnfieldId").val()}),dataType:"json",contentType:"application/json",success:function(t){if(""!=t.d){e=JSON.parse(t.d);for(var a=0;a<e.length;a++){var l=e[a];for(var n in l)for(var o in l[n]){var i=o,r=$($("#"+i+"R"+a));0==r.length&&(AddTableRows("fldTable"),r=$($("#"+i+"R"+a)));var s=l[n][o];if("text"==$(r).attr("type"))$(r).val(s),$(r).attr("value",s);else{var d=s;$(r).attr("selected","selected"),$(r).attr("value",d)}}}}else e=""},error:function(t){e=""}})}catch(d){}}else if("sqlDescr"==isQuery&&""!=QueryData){e=JSON.parse(QueryData);for(var t=0;t<e.length;t++){var a=e[t];for(var l in a)for(var n in a[l]){var o=n,i=$($("#"+o+"R"+t));0==i.length&&(AddTableRows("fldTable"),i=$($("#"+o+"R"+t)));var r=a[l][n];if("text"==$(i).attr("type"))$(i).val(r),$(i).attr("value",r);else{var s=r;i.hasClass("tblFromSelect")?(s=null==s?"":s,$(i).append('<option value="'+s+'" selected="selected">'+s+"</option>"),$(i).attr("value",s)):($(i).attr("selected","selected"),$(i).attr("value",s))}}}}}function GetstrTableJson(e){var t="";try{$.ajax({url:"tsttable.aspx/GetstrTableJson",type:"POST",cache:!1,async:!1,data:JSON.stringify({descrName:e,tstDId:callParentNew("tstDataId"),fldName:$("#hdnfieldId").val()}),dataType:"json",contentType:"application/json",success:function(e){if(""!=e.d){var a=e.d;QueryData=a.split("♥")[1],""!=(a=a.split("♥")[0])&&(t=a)}else t=""},error:function(e){t=""}})}catch(a){}return t}function GetAutoCompData(e,t,a,l){var n="";if(arrRefreshDcs.length>0)for(var o=0;o<arrRefreshDcs.length;o++){var i=arrRefreshDcs[o].split(":");n=i[1].replace("dc","")+","+i[0].replace("dc","")}t=CheckSpecialCharsInStr(t);var r=callParentNew("GetFieldsDcNo("+e+")","function");AxActiveRowNo=parseInt(callParentNew("GetFieldsRowNo("+e+")","function"),10),AxActiveRowNo=callParentNew("GetDbRowNo("+AxActiveRowNo+","+r+")","function");var s=AxActiveRowNo,d="";""!=AxActivePRow&&""!=AxActivePDc&&(d=AxActivePDc+"♠"+AxActivePRow);return a.toString()+"~"+l.toString()+"~"+r+"~"+s+"~"+d+"~~"+n}function GetDBProcTableJson(e){var t="";try{var a=$("#hdnfieldId").val().substring(0,$("#hdnfieldId").val().lastIndexOf("F")-3),l=callParentNew("GetFieldsRowNo("+$("#hdnfieldId").val()+")","function"),n=callParentNew("GetDcNo("+a+")","function"),o=callParentNew("GetDbRowNo("+l+","+n+")","function");$.ajax({url:"tsttable.aspx/GetDBProcTableJson",type:"POST",cache:!1,async:!1,data:JSON.stringify({procName:e,tstDId:callParentNew("tstDataId"),fldName:$("#hdnfieldId").val(),ChangedFields:parent.ChangedFields,ChangedFieldDbRowNo:parent.ChangedFieldDbRowNo,ChangedFieldValues:parent.ChangedFieldValues,DeletedDCRows:parent.DeletedDCRows,tfldDc:n,tfldRowNo:o}),dataType:"json",contentType:"application/json",success:function(e){if(""!=e.d){var a=e.d;QueryData=a.split("♥")[1],""!=(a=a.split("♥")[0])&&(t=a)}else t=""},error:function(e){t=""}})}catch(i){}return t}function GetSourceParamValue(e){var t="",a=void 0===e.parents("tr").attr("id")?"0":e.parents("tr").attr("id"),l=e.attr("name");return $(colNames).each(function(e,n){if(""!=colSource[e]&&l!=n){var o=n+"R"+a;$("#"+o).is("select")&&void 0!==$("#"+o).attr("value")&&""!=$("#"+o).attr("value")?t+=""==t?colSource[e]+":"+$("#"+o).attr("value"):"♠"+colSource[e]+":"+$("#"+o).attr("value"):$("#"+o).is("input")&&"text"==$("#"+o).attr("type")&&""!=$("#"+o).attr("value")&&(t+=""==t?colSource[e]+":"+$("#"+o).attr("value"):"♠"+colSource[e]+":"+$("#"+o).attr("value"))}}),t}$j(document).ready(function(){GetTableHtml(),$j(":text").blur(function(e){MainBlur($j(this),"input")}),$j("select").change(function(){MainBlur($j(this),"select")}),LoadTableEvents("#divTable")});
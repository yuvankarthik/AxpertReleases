/*https://web.agile-labs.com/minZIP/*//*version=3.9.1*/function _typeof(e){"@babel/helpers - typeof";return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var menuJSON,fancytreeObj,isFormDirty=!1,changedNodeArr=[],maxlevel=2,actionSequenceArr=[],prevNodeOrd="",prevNodeLevel="",changedVisibility=[];function validateFile(e,t){var n,r=t.get_fileName(),i=r.substring(r.lastIndexOf(".")+1),o=t._length;if(-1!=$("#hdnUserIconList").val().indexOf(r))throw(n=new Error).name="Duplicate File",n.message="Selected file alredy exists",n;if("jpg"!=i&&"jpeg"!=i&&"png"!=i&&"JPG"!=i&&"PNG"!=i)throw(n=new Error).name="File Format",n.message="Selected file is not supported, please select .jpg, .jpeg, .png file only",n;if(o>515785)throw(n=new Error).name="Max Size",n.message="Max. icon upload size is 500 KB",n}function uploadError(e,t){showAlertDialog("error",t.get_errorMessage()),$.each($("#uploadIcon input"),function(){$(this).val("")})}function SetNodeIcon(e,t){$("#hdnUserIconList").val($("#hdnUserIconList").val()+t.get_fileName()+","),$(".userIcons").append('<span><img src="'+$("#hdnIconPath").val()+t.get_fileName()+'"><a  href="javascript:void(0)" title="Delete" data-caption="'+t.get_fileName()+'" class="icon-arrows-remove DltIcnBtn"></a></span>'),$("#lblFileInf").text(t.get_fileName()),$.each($("#uploadIcon input"),function(){$(this).val("")})}function OBJtoXML(e,t){var n;for(var r in e)if(e[r]instanceof Array)for(var i in e[r])n="undefined"!=typeof e[r][i].key?document.createElementNS(null,e[r][i].key):document.createElementNS(null,r),t.appendChild(OBJtoXML(new Object(e[r][i]),n));else"object"==_typeof(e[r])?(n="undefined"!=typeof e[r].key?document.createElementNS(null,e[r].key):document.createElementNS(null,r),t.appendChild(OBJtoXML(new Object(e[r]),n))):t.setAttributeNS(null,r,"string"==typeof e[r]?ReverseCheckSpecialChars(e[r]):e[r]);return t}function changeNodeLevel(e){e.hasChildren()?(e.getChildren().forEach(function(e){changeNodeLevel(e)}),e.data.level=(e.getLevel()-1).toString()):e.data.level=(e.getLevel()-1).toString()}function ShowDimmer(e){DimmerCalled=!0;var t=$("#waitDiv");if(t.length>0&&t!=undefined)if(1==e){var n=$("#middle1",parent.document);n&&t.width(n.width()),t.show(),document.onkeydown=function(){return!1}}else t.hide(),document.onkeydown=function(){if(1==DimmerCalled)return!0};else window.opener!=undefined&&(t=$("#waitDiv",window.opener.document)).length>0&&(1==e?t.show():t.hide());DimmerCalled=!1}function randomInteger(e,t){return(Math.floor(Math.random()*(t-e+1))+e).toString()}function getNodeOrd(e){var t=0;return fancytreeObj.visit(function(n,r){if(t++,n.key==e.key)return!1}),t}function getActionString(e,t,n){var r="",o=t;if(""==(r=null!=o.getNextSibling()?o.getNextSibling().key:"")){var a=(o=o.getParent()).getLevel()-1;for(i=a;i>=0;i--){var c=o.getNextSibling();if(null!=c){r=c.key;break}a=(o=o.getParent()).getLevel()-1}}switch(e){case"move":if(prevNodeOrd!=getNodeOrd(t))return t.key+"="+e+"|"+prevNodeOrd+"-"+getNodeOrd(t)+"|"+r+"|"+prevNodeLevel+"-"+(t.getLevel()-1).toString()+"|"+("root_1"==n.key?"null":n.key);break;case"add":return""==prevNodeOrd?t.key+"="+e+"|"+getNodeOrd(t)+"|"+(t.getLevel()-1).toString()+"|null":t.key+"=move|"+prevNodeOrd+"-"+getNodeOrd(t)+"|"+r+"|"+prevNodeLevel+"-"+(t.getLevel()-1).toString()+"|"+("root_1"==n.key?"null":n.key);case"remove":return t.key+"="+e+"|"+getNodeOrd(t)+"|"+(t.getLevel()-1).toString()+"|"+("root_1"==n.key?"null":n.key);default:return""}}function getMenuPath(e,t){return"insert Before"==t?"\\"+e.getNextSibling().getPath().replaceAll("/","\\"):"Add Under"==t?"\\"+e.getParent().getPath().replaceAll("/","\\"):void 0}$(document).ready(function(e){if(callParentNew("HideStructLoader()","function"),$.ui.fancytree.debugLevel=0,menuData){menuData=menuData.replace(/&apos;/g,"'");var t=parseXml(menuData);menuJSON=JSON.parse(xml2json(t,""))}createTheTreeView({menuJSON:menuJSON,treeContainer:"#arrangeMenu"}),(fancytreeObj=$.ui.fancytree.getTree("#arrangeMenu")).selectAll(!1),$("#arrangeMenu").fancytree("getRootNode").visit(function(e){e.setExpanded(!1)}),$("#btnDelete").on("click",function(){var e=fancytreeObj.getSelectedNodes();return 0==e.length?(showAlertDialog("warning","Please select atleast one node."),!1):(deleteCnfrmBx=$.confirm({title:"Confirm!",onContentReady:function(){disableBackDrop("bind")},onOpen:function(){$(".cnfrmBxHotBtn").focus()},escapeKey:"buttonB",content:"Do you really want to delete ?",buttons:{buttonA:{text:"Yes",btnClass:"hotbtn",action:function(){e.forEach(function(e){for(;e.hasChildren();){var t=e.getFirstChild();prevNodeOrd=getNodeOrd(t),prevNodeLevel=t.getLevel()-1,t.moveTo(e.parent,"child"),changeNodeLevel(t)}var n=getActionString("remove",e,e.getParent());""!=n&&actionSequenceArr.push(n),-1!=Array.indexOf(changedNodeArr,e.key)&&Array.remove(changedNodeArr,e.key),changedVisibility.findIndex(function(t){return t.name==e.key})>-1&&(elemIndex=changedVisibility.findIndex(function(t){return t.name==e.key}),changedVisibility.splice(elemIndex,1)),e.remove()}),showAlertDialog("success","Node(s) deleted successfully")}},buttonB:{text:"Cancel",btnClass:"coldbtn",action:function(){disableBackDrop("destroy")}}}}),!1)}),$("#btnAdd").on("click",function(){return fancytreeObj.getRootNode().editCreateNode("child",{key:"Head"+randomInteger(1e5,999999),title:"New Folder",folder:!0,level:"0"}),!1}),$("#btnSave").on("click",function(){var e=0;fancytreeObj.visit(function(t){t.data.ordno=++e,t.data.parent="root_1"==t.parent.key?"":t.parent.key,t.data.action&&(t.data.action=t.data.action.toString()),t.getLevel()>maxlevel&&(maxlevel=t.getLevel()),1==t.getLevel()?null==t.getNextSibling()?t.data.menuPos="default":(t.data.menuPos="Insert Before",t.data.menuPath=getMenuPath(t,t.data.menuPos)):t.getLevel()>1&&(null==t.getNextSibling()?(t.data.menuPos="Add Under",t.data.menuPath=getMenuPath(t,t.data.menuPos)):(t.data.menuPos="Insert Before",t.data.menuPath=getMenuPath(t,t.data.menuPos)))}),changedNodeArr.sort(function(e,t){return fancytreeObj.getNodeByKey(e).data.ordno-fancytreeObj.getNodeByKey(t).data.ordno}),changedNodeArr=changedNodeArr.map(function(e){return fancytreeObj.getNodeByKey(e).getKeyPath()}),changedVisibility=changedVisibility.map(function(e){return[[e.name,e.status].join("="),e.parentList.join("~")].join("|")}).join();var t=fancytreeObj.toDict();menuJSON.root.max=maxlevel,menuJSON.root.parent=ParseTreeJsonToOriginalFormat({TreeJSON:t});var n=document.createElementNS(null,"arrangemenu");n=(new XMLSerializer).serializeToString(OBJtoXML(menuJSON.root,n)),ShowDimmer(!1);callParentNew("StructLoader(Arrange Menu..)","function"),$.ajax({url:"ArrangeMenu.aspx/SaveTreeView",type:"POST",cache:!1,async:!0,data:JSON.stringify({key:n,changedNodes:changedNodeArr.toString(),actionSequence:actionSequenceArr.toString(),changedVisibility:changedVisibility}),contentType:"application/json",success:function(e){var t=e.d;"success"==t.status?(showAlertDialog("success","Data saved successfully"),window.location.href=window.location.href):"SESSION_TIMEOUT"==t.msg?parent.window.location.href="../aspx/sess.aspx":""==t.msg?showAlertDialog("error","Error while saving."):showAlertDialog("error",t.msg),ShowDimmer(!1),setTimeout(function(){callParentNew("HideStructLoader()","function")},0)},failure:function(){showAlertDialog("error","Error while saving."),ShowDimmer(!1),setTimeout(function(){callParentNew("HideStructLoader()","function")},0)},error:function(){showAlertDialog("error","Error while saving."),ShowDimmer(!1),setTimeout(function(){callParentNew("HideStructLoader()","function")},0)}})}),$("#lnkChngIcon").on("click",function(){return fancytreeObj.getSelectedNodes().length?(createIconPopup("uploadIcon","hdnUserIconList",$("#hdnIconPath").val()),!1):(showAlertDialog("warning","Please select atleast one node."),!1)}),$(document).off("click").on("click",".modal-content #iconWrapperData  span",function(e){if($(e.target).is($(".DltIcnBtn")))return!0;var t=fancytreeObj.getSelectedNodes();if($(this).find("img").length)for(var n=$(this).find("img").attr("src"),r=0;r<t.length;r++)t[r].icon=n,t[r].renderTitle(),-1==Array.indexOf(changedNodeArr,t[r].key)&&changedNodeArr.push(t[r].key),fancytreeObj.options.renderNode("changeIcon",t[r]),t[r].setSelected(!0);else{icon=$(this).text();for(r=0;r<t.length;r++)t[r].icon={text:icon,addClass:"material-icons"},t[r].renderTitle(),-1==Array.indexOf(changedNodeArr,t[r].key)&&changedNodeArr.push(t[r].key),fancytreeObj.options.renderNode("changeIcon",t[r]),t[r].setSelected(!0)}isFormDirty||(isFormDirty=!0)}),$("body").on("keyup","#srchIcon",function(){var e=$(this).val().toLowerCase();$("#iconWrapperData span").filter(function(){$(this).toggle($(this).text().toLowerCase().indexOf(e)>-1)})}).on("keyup","input#amSearch",function(e){var t=$(this).val();fancytreeObj.filterNodes.call(fancytreeObj,t)}),$(document).on("click",".DltIcnBtn",function(){var e=$(this).data("caption"),t=this;deleteCnfrmBx=$.confirm({title:"Confirm!",onContentReady:function(){disableBackDrop("bind")},onOpen:function(){$(".cnfrmBxHotBtn").focus()},escapeKey:"buttonB",content:"Do you really want to delete ?",buttons:{buttonA:{text:"Yes",btnClass:"hotbtn",action:function(){$.ajax({url:"ArrangeMenu.aspx/deleteIconImage",type:"POST",data:JSON.stringify({fileName:e}),dataType:"json",contentType:"application/json",success:function(n){if("Success"==n.d){$(t).parent("span").remove();var r=$("#hdnUserIconList").val().split(","),i=r.indexOf(e);r.splice(i,1),$("#hdnUserIconList").val(r.join()),showAlertDialog("success","Icon deleted successfully")}else showAlertDialog("error","Error while Deleting")},failure:function(){showAlertDialog("error","Error while Deleting")},error:function(){showAlertDialog("error","Error while Deleting")}}),deleteCnfrmBx=""}},buttonB:{text:"Cancel",btnClass:"coldbtn",action:function(){disableBackDrop("destroy"),deleteCnfrmBx=""}}}})}).on("click","button#amResetSearch",function(e){$("input#amSearch").val(""),fancytreeObj.clearFilter()})}),function(){window.createTheTreeView=function(e){var t=e.menuJSON,n=e.treeContainer;n=$(n);var r=function i(e){var t=[],n=e.parent;return n.length===undefined&&(n=[n]),n&&n.forEach(function(e,n){var r=e.child;if(r){var o=[];"undefined"==typeof r.length?o.push(i({parent:[r]})):r.forEach(function(e,t){o.push(i({parent:[e]}))}),delete e.child,Object.assign(e,{title:e.name,key:e.oname,folder:!0,children:o}),t.push(e)}else{var a=e.name,c=e.target,l=e.oname,d=e.icon,s=function(e){var t=e.target,n=e.icon,r="folder",i="folder";return t&&(0!==t.indexOf("tstruct.aspx")&&0!==t.indexOf("iview.aspx")&&0!==t.indexOf("iviewInteractive.aspx")&&0!=t.indexOf("page.aspx")&&0!=t.indexOf("htmlPages.aspx")||(r="item"),n==undefined)?(0===t.indexOf("tstruct.aspx")?i="assignment":0===t.indexOf("iview.aspx")||0===t.indexOf("iviewInteractive.aspx")?i="view_list":0!=t.indexOf("page.aspx")&&0!=t.indexOf("htmlPages.aspx")||(i="insert_drive_file"),{targetType:r,iconn:{text:i,addClass:"material-icons"}}):{targetType:r,iconn:n}}({target:c,icon:d}),u=s.targetType,f=s.iconn;folder="folder"===u,Object.assign(e,{title:a,key:l,folder:folder,icon:f}),t.push(e)}}),1===t.length?t[0]:t}(t.root);r.length===undefined&&(r=[r]),n.fancytree({checkbox:!0,selectMode:2,icon:!0,autoCollapse:!0,quicksearch:!0,defaultKey:function(){return"Head"+randomInteger(1e5,999999)},extensions:["dnd5","edit","glyph","filter"],source:r,dnd5:{autoExpandMS:400,focusOnClick:!0,preventVoidMoves:!0,preventRecursion:!0,dragStart:function(e,t){return prevNodeOrd=getNodeOrd(e),prevNodeLevel=e.getLevel()-1,!0},dragEnter:function(e,t){return!!e.isFolder()||["before"]},dragDrop:function(e,t){t.otherNode.moveTo(e,t.hitMode)},dragEnd:function(e,t){changeNodeLevel(e)}},edit:{adjustWidthOfs:null,triggerStart:["clickActive","dblclick","f2","mac+enter","shift+click","active","focus"],beforeEdit:function(e,t){if(!t.node.folder)return!1},edit:function(e,t){$(t.input).attr("maxlength","50")},close:function(e,t){fancytreeObj.options.renderNode(e,t)}},glyph:{preset:"material",map:{_addClass:"material-icons",checkbox:{text:"check_box_outline_blank"},checkboxSelected:{text:"check_box"},checkboxUnknown:{text:"indeterminate_check_box"},dragHelper:{text:"play_arrow"},dropMarker:{text:"arrow-forward"},error:{text:"warning"},expanderClosed:{text:"chevron_right"},expanderLazy:{text:"last_page"},expanderOpen:{text:"expand_more"},loading:{text:"autorenew",addClass:"fancytree-helper-spin"},nodata:{text:"info"},noExpander:{text:""},radio:{text:"radio_button_unchecked"},radioSelected:{text:"radio_button_checked"},doc:{text:"web_asset"},docOpen:{text:"web_asset"},folder:{text:"folder"},folderOpen:{text:"folder_open"}}},filter:{autoExpand:!0,counter:!1,hideExpanders:!0,mode:"hide"},activate:function(e,t){},lazyLoad:function(e,t){t.result={FinalmenuJson:r}},modifyChild:function(e,t){isFormDirty||(isFormDirty=!0);var n=t.childNode,r=t.operation,i="";return n&&("move"==r||"add"==r?(""!=(i=getActionString(r,n,t.node))&&actionSequenceArr.push(i),prevNodeOrd="",prevNodeLevel=""):"remove"!=r&&-1==Array.indexOf(changedNodeArr,n.key)&&changedNodeArr.push(n.key)),!0},renderNode:function(e,t){var n=t.node||t,r=$(n.span);if(!r.data("rendered")||"close"==e.type||"changeIcon"==e){var i="visibility";i=changedVisibility.findIndex(function(e){return e.name==n.key})>-1?changedVisibility[changedVisibility.findIndex(function(e){return e.name==n.key})]["class"]:"T"==n.data.visible?"visibility":n.data.visible==undefined?"visibility":"visibility_off";var o=$('<span role="visible" class="fancytree-visible material-icons">'.concat(i,"</span>")),a=$('<span role="delnode" class="fancytree-delnode material-icons">highlight_off</span>');o.insertBefore(r.find(".fancytree-icon, .fancytree-custom-icon")),r.append(a),a.hide(),r.hover(function(){n.folder||a.show()},function(){a.hide()}),n.setSelected(!1),r.data("rendered",!0)}},click:function(e,t){if("checkbox"!=t.targetType){var n=t.node,r=$(t.originalEvent.target);if($.each(fancytreeObj.getSelectedNodes(),function(e,t){t.setSelected(!1)}),"visible"==r.attr("role")){var i=n.getParentList(),o={name:n.key,"class":"visibility",status:!0,parentList:[]};"visibility"==r.html()?(o["class"]="visibility_off",o.status=!1):(o["class"]="visibility",o.status=!0),r.html(o["class"]),n.folder&&n.hasChildren()&&(n.setExpanded(!0),n.visit(function(e){e.setExpanded(!0),$(e.span).find(".fancytree-visible").html(o["class"])})),i&&o.status&&$.each(i,function(e,t){$(t.span).find(".fancytree-visible").html(o["class"]),o.parentList.push(t.key)}),-1==changedVisibility.findIndex(function(e){return e.name==o.name})?changedVisibility.push(o):changedVisibility.findIndex(function(e){return e.name==o.name})>-1&&(elemIndex=changedVisibility.findIndex(function(e){return e.name==o.name}),changedVisibility.splice(elemIndex,1),changedVisibility.push(o))}else"delnode"==r.attr("role")?(n.setSelected(!0),$("#btnDelete").trigger("click")):"icon"==t.targetType&&(n.setSelected(!0),createIconPopup("uploadIcon","hdnUserIconList",$("#hdnIconPath").val()))}}}),$(".drag").draggable()},window.ParseTreeJsonToOriginalFormat=function e(t){var n=t.TreeJSON,r=[];return n.forEach(function(t,n){var i=t.data,o=t.children,a=t.title,c=t.key;if(delete t.children,delete t.data,o){var l=[];"undefined"==typeof o.length?l.push(e({TreeJSON:[o]})):o.forEach(function(t,n){l.push(e({TreeJSON:[t]}))}),i?r.push(Object.assign(t,i,{name:a,oname:c},{child:l})):r.push(Object.assign(t,{name:a,oname:c},{child:l}))}else i?r.push(Object.assign(t,i,{name:a,oname:c})):r.push(Object.assign(t,{name:a,oname:c}))}),1===r.length?r[0]:r}}();
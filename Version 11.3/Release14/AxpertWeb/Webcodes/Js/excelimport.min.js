/*https://web.agile-labs.com/minZIP/*//*version=3.9.1*/var xlresult,xlGridfieldNames,xlDcNo,xlRowCount,IsgridummyRow=!1;function ImportGridData(){var e="",t=[],r=[],l=[],a="",i="";callParentNew("gridDummyRowVal").length>0&&callParentNew("gridDummyRowVal").map(function(e){e.split("~")[0]==xlDcNo&&(IsgridummyRow=!0)});for(var n=1;n<xlresult.length;n++){if(xlRowCount>0&&!IsgridummyRow){var o=xlRowCount+n;e+="i"+o+",",r.push({n:xlGridfieldNames[0],v:"0",r:o.toString(),t:"s"})}else e+="i"+n+",",r.push({n:xlGridfieldNames[0],v:"0",r:n.toString(),t:"s"});for(var d=0;d<xlresult[n].length;d++)if(i="undefined"!=typeof xlresult[n][d]?xlresult[n][d]:"",(a=xlresult[0][d]).indexOf("(")>-1&&a.endsWith(")")&&(a=a.split("(")[1].split(")")[0]),""!=i&&(i=i.toString()),xlRowCount>0&&!IsgridummyRow){var c=xlRowCount+n;l.push({n:a,v:i,r:c.toString(),t:"s"})}else l.push({n:a,v:i,r:n.toString(),t:"s"})}e=e.slice(0,-1),t.push({n:"DC"+xlDcNo,v:xlDcNo,cr:e,t:"dc",hasdatarows:"yes"});var s=[];s=s.concat(t,r,l),callParentNew("AxActiveDc=",xlDcNo);try{callParentNew("gridDummyRowVal").length>0&&callParentNew("gridDummyRowVal").map(function(e){e.split("~")[0]==xlDcNo&&callParentNew("gridDummyRowVal").splice($.inArray(e,callParentNew("gridDummyRowVal")),1)})}catch(S){}parent.ExecData(s,"LoadData",!0),callParentNew("closeModalDialog()","function");var u=parent.$("#gridHd"+xlDcNo+" tbody tr").length,m="",f=!1,p=new Array;for(d=1;d<=u;d++){callParentNew("AxActiveRowNo=",d),m=d<=9?"00"+d:d>9&&d<=99?"0"+d:d;for(var g=0;g<xlGridfieldNames.length;g++){if("axp_formula"==xlGridfieldNames[g].toLowerCase()&&(f=!0),1==d){var x=s.filter(function(e){return e.n===xlGridfieldNames[g]&&("0"==e.v||""==e.v)});x.length>0&&!xlGridfieldNames[g].startsWith("axp_recid")?p.push(xlGridfieldNames[g]):0!=(x=s.filter(function(e){return e.n===xlGridfieldNames[g]})).length||xlGridfieldNames[g].startsWith("axp_recid")||p.push(xlGridfieldNames[g])}var w=xlGridfieldNames[g]+m+"F"+xlDcNo,N=$j.inArray(xlGridfieldNames[g],parent.FNames);if("True"==parent.FFieldHidden[N]||p.indexOf(xlGridfieldNames[g])>-1){parent.EvaluateAxFunction(xlGridfieldNames[g],w,m+"F"+xlDcNo,"ImportFromExcel"),parent.EvaluateExpressions(w);var h=xlGridfieldNames[g],D=parent.GetFieldIndex(xlGridfieldNames[g]);if(void 0!==D&&-1!=D){var v=parent.FldDependents[D].toString();if(""!=v&&(v=v.split(",")),v!=undefined)for(var y=0;y<v.length;y++){var R=(C=v[y].toString()).substring(0,1),F=C.substring(1);"accept"==parent.FMoe[D].toString().toLowerCase()&&F==h&&"e"==R||"e"==R&&parent.EvaluateAxFunction(F,w,"","ImportFromExcel")}}}else{var G=xlGridfieldNames[g],b=parent.GetFieldIndex(xlGridfieldNames[g]);if(void 0!==b&&-1!=b){var I=parent.FldDependents[b].toString();if(""!=I&&(I=I.split(",")),I!=undefined)for(y=0;y<I.length;y++){var C;R=(C=I[y].toString()).substring(0,1),F=C.substring(1);"accept"==parent.FMoe[b].toString().toLowerCase()&&F==G&&"e"==R||"e"==R&&parent.EvaluateAxFunction(F,w,"","ImportFromExcel")}}}}}if(f){m="";var A=parent.GetFieldIndex("axp_formula"),k=parent.FNames[A];for(n=1;n<=u;n++){var P=k+(m=n<=9?"00"+n:n>9&&n<=99?"0"+n:n)+"F"+xlDcNo;parent.ValidateFldValFormula(parent.$("#"+P),A,k)}}}$(function(){$("#excelimport").click(function(){if(callParentNew("gridDummyRowVal").length>0&&callParentNew("gridDummyRowVal").map(function(e){e.split("~")[0]==xlDcNo&&(IsgridummyRow=!0)}),xlRowCount>0&&!IsgridummyRow)var e=$.confirm({theme:"modern",title:appGlobalVarsObject.lcm[155],closeIcon:!0,onContentReady:function(){disableBackDrop("bind")},backgroundDismiss:"false",escapeKey:"buttonB",content:"Do You Want to Append?<br> Yes will Append, No will clear the existing data and import again!",buttons:{buttonA:{text:"Yes",btnClass:"btn btn-primary",action:function(){ImportGridData(),e.close()}},buttonB:{text:"No",btnClass:"btn btn-bg-light btn-color-danger btn-active-light-danger",action:function(){IsgridummyRow=!1,parent.$j("#chkallgridrow"+xlDcNo).prop("checked","checked"),parent.clearDataGrid(xlDcNo,"excelimport"),xlRowCount=0;var e=setInterval(function(){"false"==callParentNew("isExcelImpDelWS")&&(clearInterval(e),ImportGridData())},2e3);disableBackDrop("destroy")}}}});else if(IsgridummyRow){try{callParentNew("gridDummyRowVal").length>0&&callParentNew("gridDummyRowVal").map(function(e){e.split("~")[0]==xlDcNo&&callParentNew("gridDummyRowVal").splice($.inArray(e,callParentNew("gridDummyRowVal")),1)})}catch(r){}IsgridummyRow=!1,parent.$j("#chkallgridrow"+xlDcNo).prop("checked","checked"),parent.clearDataGrid(xlDcNo,"excelimport"),xlRowCount=0;var t=setInterval(function(){"false"==callParentNew("isExcelImpDelWS")&&(clearInterval(t),parent.$j("#chkallgridrow"+xlDcNo).prop("checked",""),ImportGridData())},2e3)}else ImportGridData()})}),$j(document).ready(function(){$("#excelfile").bind({change:function change(e){var filename=$("#excelfile").val(),fName=filename.toString().split("\\");filename=fName[fName.length-1],$("#noFile").text(filename);var file=e.target.files[0],files=e.target.files,f=files[0],FR=new FileReader;FR.onload=function(e){var data=new Uint8Array(e.target.result),workbook=XLSX.read(data,{type:"array",cellDates:!0,dateNF:"dd/mm/yyyy;@"}),firstSheet=workbook.Sheets[workbook.SheetNames[0]],result=XLSX.utils.sheet_to_json(firstSheet,{header:1,raw:!1});if(0!=result.length&&(result=result.filter(function(e){return e.some(function(e){return""!==e&&null!==e})})),0!=result.length){var dcNo=window.location.href.split("=")[1],gridFieldNames=callParentNew("GetGridFields("+dcNo+")","function"),gridRowCount=callParentNew("GetDcRowCount("+dcNo+")","function"),gridFieldAlongwithCap=[];gridFieldNames.forEach(function(e,t){var r=parent.FNames.indexOf(e),l=parent.FCaption[r];gridFieldAlongwithCap.push(l+"("+e+")")});var check=gridFieldNames.some(function(e){return result[0].includes(e)}),checkwithCap=gridFieldAlongwithCap.some(function(e){return result[0].includes(e)});check||checkwithCap?0!=result[1].length?(xlresult=result,xlGridfieldNames=gridFieldNames,xlRowCount=gridRowCount,xlDcNo=dcNo):showAlertDialog("error",eval(callParent("lcm[511]"))):showAlertDialog("error",eval(callParent("lcm[510]")))}else showAlertDialog("error",eval(callParent("lcm[509]")))},FR.readAsArrayBuffer(file)}})});
/*https://web.agile-labs.com/minZIP/*//*version=3.9.1*/function _classCallCheck(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,n){for(var i=0;i<n.length;i++){var e=n[i];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}function _createClass(t,n,i){return n&&_defineProperties(t.prototype,n),i&&_defineProperties(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t}var notifyCount,newNotifications,reversedNotifications,apiUrl,apiSessionId,apiToken,signalrServiceinit,notificationtrigger,notifications=[],clientId=null,loginToken=null,pendingCount=0,_thisClickCount=0,readNotifications=[];$(document).ready(function(){if("undefined"!=typeof signalRNotifications&&"true"==signalRNotifications&&($.ajax({type:"POST",url:"../aspx/Axpeg.aspx/AxGetARMDetails",cache:!1,async:!1,contentType:"application/json;charset=utf-8",dataType:"json",success:function(t){var n=t.d;apiUrl=n.url,apiSessionId=n.sessionId,apiToken=n.token}}),clientId="ARM-"+mainProject+"-"+mainUserName,loginToken=apiToken,(signalrServiceinit=new SignalrService).startConnection(),void 0!==callParentNew("pwdExpDaysAlert")&&callParentNew("pwdExpDaysAlert")>0))var t=setInterval(function(){void 0!==signalrServiceinit&&signalrServiceinit.connectionId&&(clearInterval(t),setTimeout(function(){var t="Your login password will expire within "+callParentNew("pwdExpDaysAlert")+" days";ASB.WebService.GenerateSignalRNotification("Password Expiry",t)},0))},100)});var SignalrService=function(){function t(){_classCallCheck(this,t),this.data=null,this.connectionId=null,this.hubConnection=(new signalR.HubConnectionBuilder).withUrl(apiUrl,{accessTokenFactory:function(){return loginToken}}).build()}return _createClass(t,[{key:"startConnection",value:function(){var t=this;this.hubConnection.start().then(function(){return t.getConnectionId()})["catch"](function(t){return console.log("Error while starting connection: "+t)})}},{key:"getConnectionId",value:function(){var t=this;this.hubConnection.invoke("getconnectionid").then(function(n){t.connectionId=n,t.passConnectionId(clientId,n),t.getMessage()})}},{key:"passConnectionId",value:function(t,n){this.hubConnection.invoke("PassConnectionId",t,n)["catch"](function(t){return console.error(t)})}},{key:"getMessage",value:function(){this.hubConnection.on("ReceiveNotification",function(t){var n=(newNotifications=JSON.parse(t)).length;pendingCount=n;newNotifications.length;notifications=notifications.concat(newNotifications),AxNotifyHistory=JSON.stringify(notifications),(notificationtrigger=document.querySelector("#notificationtrigger")).classList.add("blink"),(notifyCount=document.querySelector("#notifyCountForBlink")).classList.remove("d-none"),notifyCount.classList.add("blink");var i=document.querySelector(".floatnotification");i&&i.remove();var e=document.createElement("div");e.classList.add("floatnotification","d-flex","gap-1");var o=document.createElement("span");o.classList.add("floatnotificationSpan","text-truncate");var a,s=document.createElement("button");if(s.classList.add("notificationClose"),s.innerHTML="&times",(a=document.createElement("span")).classList.add("flotnotificationCount"),pendingCount<=1?a.innerHTML="":(pendingCount-=1,a.innerHTML="+"+pendingCount+"Notifications"),pendingCount>=0){var c=notifications[pendingCount];c!==undefined?(o.textContent=c.title,o.title=c.title):(o.textContent=notifications[0].title,o.title=notifications[0].title)}e.appendChild(o),e.appendChild(s),e.appendChild(a),document.querySelector("body").appendChild(e),setTimeout(function(){document.querySelector(".floatnotification").remove()},5e3),(a=document.querySelector(".flotnotificationCount")).addEventListener("click",function(){var t=document.querySelector(".floatnotification"),n=document.querySelector("#notificationtrigger");t&&t.remove(),signalrServiceinit.onclick();var i=document.querySelector("#notificationtrigger"),e=KTMenu.getInstance(i),o=document.querySelector("#notificationWindowMain");e.show(o),o.style.transform="translate(370%, 45px)",signalrServiceinit.notificationEvent(),n.classList.remove("blink"),notifyCount.classList.remove("blink"),notifyCount.classList.add("d-none")}),document.querySelector(".cardsPageWrapper").addEventListener("click",function(){var t=document.querySelector("#notificationtrigger"),n=KTMenu.getInstance(t),i=document.querySelector("#notificationWindowMain");n.hide(i)}),document.querySelector(".notificationClose").addEventListener("click",function(){document.querySelector(".floatnotification").remove()})})}},{key:"init",value:function(){this.onclick(),this.notificationEvent()}},{key:"onclick",value:function(){0==_thisClickCount&&GetHistoryFromCache(),_thisClickCount++,AxNotifyHistory=JSON.stringify(notifications);var t=document.querySelector("#notificationWindow");if(0===notifications.length){t.innerHTML="";var n=document.createElement("span");t.classList.add("d-flex"),n.innerHTML="No notification available",t.appendChild(n),(notifyCount=document.querySelector("#notifyCountForBlink")).classList.add("d-none")}else{var i;t.innerHTML="",t.classList.remove("d-flex"),(notifyCount=document.querySelector("#notifyCountForBlink")).classList.remove("d-none"),notifyCount.classList.add("blink");for(var e=notifications.length-1;e>=0;e--){i=e;var o=notifications[e],a=!1;readNotifications.indexOf(o.dt)>-1&&(a=!0);var s=document.createElement("div");a?s.classList.add("d-flex","align-items-center","notificationList","col-12","px-4","py-2","border-bottom-dashed","border-1","border-gray-300","min-h-70px","mh-150px","bg-light"):s.classList.add("d-flex","align-items-center","notificationList","col-12","px-4","py-2","border-bottom-dashed","border-1","border-gray-300","min-h-70px","mh-150px"),s.setAttribute("data-index",i);var c=document.createElement("div");c.classList.add("d-flex","justify-content-end","closebtnAppend","col-1");var r=document.createElement("button");r.innerHTML="<span class='material-icons material-icons-style fs-3'>close</span>",r.setAttribute("data-index",i),r.classList.add("btn","btn-sm","btn-icon","btn-white","closeNotification"),r.title="Clear",r.onclick=function(){clearOneNotification()},c.appendChild(r);var l=document.createElement("div");l.classList.add("symbol","symbol-50px","col-2"),"tstruct"==o.type.toLowerCase()?""==o.icon?l.innerHTML='<span class="symbol-label"><img src="../images/NotificationIcons/TstructSave.png" class="w-30px"></span>':l.innerHTML='<span class="symbol-label"><img src="../images/'+o.icon+'" class="w-30px"></span>':"iview"==o.type.toLowerCase()?""==o.icon?l.innerHTML='<span class="symbol-label"><img src="../images/NotificationIcons/Defalut.png" class="w-30px"></span>':l.innerHTML='<span class="symbol-label"><img src="../images/'+o.icon+'" class="w-30px"></span>':"page"==o.type.toLowerCase()?""==o.icon?l.innerHTML='<span class="symbol-label"><img src="../images/NotificationIcons/Defalut.png" class="w-30px"></span>':l.innerHTML='<span class="symbol-label"><img src="../images/'+o.icon+'" class="w-30px"></span>':"export"==o.type.toLowerCase()?""==o.icon?l.innerHTML='<span class="symbol-label"><img src="../images/NotificationIcons/Defalut.png" class="w-30px"></span>':l.innerHTML='<span class="symbol-label"><img src="../images/'+o.icon+'" class="w-30px"></span>':"password expiry"==o.type.toLowerCase()&&(""==o.icon?l.innerHTML='<span class="symbol-label"><img src="../images/NotificationIcons/Notification.png" class="w-30px"></span>':l.innerHTML='<span class="symbol-label"><img src="../images/'+o.icon+'" class="w-30px"></span>');var d=document.createElement("div");d.classList.add("d-flex","notificationText","flex-column","col-9");var f=document.createElement("a");f.classList.add("notificationText-h5","title"),f.title=o.title,f.textContent=o.title;var u=o.link;if(""!==u){if(a?f.classList.add("notificationLinkClick","h5","text-truncate","mb-0","fw-normal","cursor-pointer"):f.classList.add("notificationLinkClick","h5","text-truncate","mb-0","fw-boldest","cursor-pointer"),"t"==u.t){var p="t"+u.name+"&act="+u.act;""!=u.p&&(p+="&"+u.p),f.setAttribute("data-link",p),f.setAttribute("data-axmsgid",u.axmsgid),f.setAttribute("data-tstname",u.name)}else if("i"==u.t){var m="i"+u.name;""!=u.p&&(m+="&"+u.p),f.setAttribute("data-link",m)}else if("p"==u.t){var g="HP"+u.name;""!=u.p&&(g+="&"+u.p),f.setAttribute("data-link",g)}else if("e"==u.t){var v="e"+u.name;f.setAttribute("data-link",v)}i++}var y=document.createElement("span");y.classList.add("notificationText-sapn","message","text-truncate"),y.textContent=o.message,y.title=o.message;var h=document.createElement("span");h.classList.add("notificationText-dt","message"),h.textContent=o.dt,d.appendChild(f),d.appendChild(y),d.appendChild(h),s.appendChild(l),s.appendChild(d),s.appendChild(c),t.appendChild(s)}}}},{key:"notificationEvent",value:function(){var t=document.querySelectorAll(".notificationLinkClick"),n=document.querySelector("#notificationtrigger"),i=KTMenu.getInstance(n),e=document.querySelector("#notificationWindowMain");t.forEach(function(t){t.addEventListener("click",function(){AxNotifyMsgId="";var n=t.getAttribute("data-link");$(t).parents(".notificationList").addClass("bg-light"),$(t).removeClass("fw-boldest").addClass("fw-normal"),readNotifications.push($(t).parent().find(".notificationText-dt").text()),n.startsWith("i")?(n=n.substring(1),LoadIframe("iview.aspx?ivname=".concat(n)),i.hide(e)):n.startsWith("t")?(n=n.substring(1),AxNotifyMsgId=t.getAttribute("data-axmsgid"),LoadIframe("tstruct.aspx?transid=".concat(n)),i.hide(e)):n.startsWith("HP")?(n=n.substring(2),LoadIframe("htmlPages.aspx?load=".concat(n)),i.hide(e)):n.startsWith("e")&&(DownloadExportFile(n=n.substring(1)),i.hide(e))})});var o=document.querySelector("#notificationtrigger");o.addEventListener("mouseover",function(){o.classList.remove("blink"),notifyCount.classList.remove("blink"),notifyCount.classList.add("d-none")}),o.addEventListener("click",function(){o.classList.remove("blink"),notifyCount.classList.remove("blink"),notifyCount.classList.add("d-none")}),document.querySelectorAll(".closeNotification").forEach(function(t){t.addEventListener("click",function(n){var i=t.closest(".notificationList");if(i){var e=i.getAttribute("data-index");e=parseInt(e,10),!isNaN(e)&&e>=0&&e<notifications.length&&notifications.splice(e,1),i.classList.add("d-none")}})})}},{key:"stopConnection",value:function(){var t=this;this.hubConnection.stop().then(function(){t.hubConnection=null})["catch"](function(t){return console.log("Error while stopping connection: "+t)})}}]),t}();function DownloadExportFile(t){if(""!=t&&(t.startsWith("http:")||t.startsWith("https:"))){var n=t,i=t.substring(t.lastIndexOf("/")+1),e=i.lastIndexOf("_"),o=i.substring(0,e)+i.substring(i.lastIndexOf(".")),a=document.createElement("a");a.href=n,a.download=o,document.body.appendChild(a),a.click(),document.body.removeChild(a)}else{var s=t.substring(0,t.lastIndexOf("\\")+1),c=t.substring(t.lastIndexOf("\\")+1);try{ASB.WebService.LoadExportFileToScript(s,c,successfileMoved)}catch(r){}}}function successfileMoved(t,n){if(!CheckSessionTimeout(t)){var i=t,e=t.substring(t.lastIndexOf("/")+1),o=document.createElement("a");o.href=i,o.download=e,document.body.appendChild(o),o.click(),document.body.removeChild(o)}}function clearAll(){var t=document.querySelector("#notificationWindow");t.innerHTML="";var n=document.createElement("span");t.classList.add("d-flex"),n.innerHTML="No notification available",t.appendChild(n),notifications=[],document.querySelector("#notificationtrigger").click()}function GetHistoryFromCache(){$.ajax({type:"POST",url:"../aspx/Axpeg.aspx/AxGetNotifyHistory",cache:!1,async:!1,contentType:"application/json;charset=utf-8",dataType:"json",success:function(t){if(""!=t.d){for(var n=JSON.parse(t.d),i=0;i<n.length;i++)readNotifications.push(n[i].dt);if(notifications.length>0){var e=notifications;notifications=(notifications=(notifications=[]).concat(n)).concat(e)}else notifications=notifications.concat(n)}}})}function removeSavedtranNotify(t,n){try{if(""==n||"0"==n)for(var i=notifications.length-1;i>=0;i--){"cachedsave"==(e=notifications[i]).notifytype&&e.link.name==t&&""==e.link.p&&notifications.splice(i,1)}else for(i=notifications.length-1;i>=0;i--){var e;"cachedsave"==(e=notifications[i]).notifytype&&e.link.name==t&&e.link.p.indexOf(n)>-1&&notifications.splice(i,1)}}catch(o){}}
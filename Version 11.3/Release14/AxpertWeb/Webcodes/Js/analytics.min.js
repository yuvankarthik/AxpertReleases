/*https://web.agile-labs.com/minZIP/*//*version=3.9.1*/function _typeof(e){"@babel/helpers - typeof";return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass(e,t,a){return t&&_defineProperties(e.prototype,t),a&&_defineProperties(e,a),Object.defineProperty(e,"prototype",{writable:!1}),e}var dtCulture=eval(callParent("glCulture")),_entitySummary,_entityCommon,selectedItemsArray=[],EntitySummary=function(){function e(){_classCallCheck(this,e),this.entityName="",this.entityTransId="",this.metaData={},this.listJson={},this.maxPageNumber=1,this.pageSize=50,this.kpiJson=[],this.chartsJson=[],this.chartsMetaData={},this.selectedCharts="",this.selectedChartsObj={},this.fldData={},this.emptyRowsHtml="No data found",this.filter="",this.xAxisFields="",this.yAxisFields="",this.selectedKeyField="",this.entityList=[],this.allEntitiesList=[],this.selectedEntitiesList=[],this.filterObj={},this.globalOrder=[],this.globalYOrder=[]}return _createClass(e,[{key:"init",value:function(){parent.ShowDimmer(!1);var e=JSON.parse(document.querySelector("#hdnAnalyticsPageLoadData").value);if(_entityCommon.inValid(e.result.data.SelectedEntities))this.allEntitiesList=e.result.data.AllEntitiesList,this.constructEntityPopup(this.allEntitiesList),document.querySelector("#Entity_summary_Left").classList.add("d-none"),document.querySelector("#Entity_summary_Right").classList.add("d-none");else{var t=e.result.data.Properties,a=t.xAxisFields,n=t.yAxisFields;this.xAxisFields=a||"All",this.yAxisFields=n||"All",this.metaData=e.result.data.MetaData,this.selectedEntitiesList=e.result.data.SelectedEntitiesList,this.entityTransId=e.result.data.TransId,this.entityName=this.getEntityCaption(this.entityTransId),this.constructXandYAxis(this.metaData,"Page Load"),this.constructSelectedEntityHeader()}}},{key:"getAnalyticsChartsDataWS",value:function(e){$.ajax({url:top.window.location.href.toLowerCase().substring(0,top.window.location.href.toLowerCase().indexOf("/aspx/"))+"/aspx/Analytics.aspx/GetAnalyticsChartsDataWS",type:"POST",cache:!1,async:!0,dataType:"json",data:JSON.stringify(e),contentType:"application/json",success:function(t){try{var a=JSON.parse(t.d);if(a.result.success)var n=JSON.parse(a.result.charts[0].data_json);if(handleValidChartData(),document.querySelector("#Homepage_CardsList_Wrapper").innerHTML="","count"===e.aggField&&"all"===e.groupField){if(n.length>0){var s,i=n[0],r=_entitySummary.generateGeneralKPIHTML(i);document.querySelector("#KPI-2 .row").innerHTML=r,document.querySelector("#Homepage_CardsList_Wrapper").innerHTML="",document.querySelector("#analytics-chart-title #chart-title").innerHTML="".concat(_entitySummary.entityName,"(s)");var o={totrec:"Total records",cyear:"This year",cmonth:"This month",cweek:"This week",cyesterday:"Yesterday",ctoday:"Today"},c=Object.keys(i).filter(function(e){return"cnd"!=e&&"creiteria"!=e&&null!=e&&null!=i[e]&&0!=i[e]}).map(function(e){return{data_label:o[e],value:i[e]}});(m=[]).push({chartsid:"General",charttype:"chart",chartjson:JSON.stringify(c),chartname:"criteria",chart:null===(s=document.querySelector(".chart-selections button.bg-success"))||void 0===s?void 0:s.getAttribute("chart_type")}),_entitySummary.chartsJson=m}}else if(n.length>0){var l,d,u=n,m=[],f=u[0].criteria,h=f.split("~"),y="None";if(""==h[1])y=(null===(d=_this.filterByFldname(_this.metaData,h[2])[0])||void 0===d?void 0:d.fldcap)||"",document.querySelector("#analytics-chart-title #chart-title").innerHTML="".concat(y," (").concat(h[3],")");else document.querySelector("#analytics-chart-title #chart-title").innerHTML=_entitySummary.getChartCaptions(f);var g=u.map(function(e){return{data_label:e.keyname||y,value:e.keyvalue||0}});document.querySelector("#Homepage_CardsList_Wrapper").innerHTML="";r=_entitySummary.generateCustomKPIHTML(u,y);document.querySelector("#KPI-2 .row").innerHTML=r,m.push({chartsid:f,charttype:"chart",chartjson:JSON.stringify(g),chartname:"criteria",chart:null===(l=document.querySelector(".chart-selections button.bg-success"))||void 0===l?void 0:l.getAttribute("chart_type")}),_entitySummary.chartsJson=m,$("#Homepage_CardsList_Wrapper").show()}else handleNoChartData();callParentNew("LoadIframe");var p={},v={},b="",S="",A={dirLeft:!0,enableMasonry:!1,homePageType:"cards",isCardsDashboard:!0,isMobile:isMobileDevice()},C={css:[],js:[]};C.js.push("/ThirdParty/lodash.min.js"),C.js.push("/ThirdParty/deepdash.min.js"),C.js.push("/Js/handlebars.min.js?v=1"),C.js.push("/Js/handleBarsHelpers.min.js"),C.js.push("/ThirdParty/Highcharts/highcharts.js"),C.js.push("/ThirdParty/Highcharts/highcharts-3d.js"),C.js.push("/ThirdParty/Highcharts/highcharts-more.js"),C.js.push("/ThirdParty/Highcharts/highcharts-exporting.js"),C.js.push("/Js/high-charts-functions.min.js?v=20"),C.js.push("/Js/AxInterface.js?v=10"),C.js.push("/ThirdParty/DataTables-1.10.13/media/js/jquery.dataTables.js"),C.js.push("/ThirdParty/DataTables-1.10.13/media/js/dataTables.bootstrap.js"),C.js.push("/ThirdParty/DataTables-1.10.13/extensions/Extras/moment.min.js"),C.css.push("/ThirdParty/fullcalendar/lib/main.min.css"),C.js.push("/ThirdParty/fullcalendar/lib/main.min.js"),A.isMobile&&C.js.push("/ThirdParty/jquery-ui-touch-punch-master/jquery.ui.touch-punch.min.js"),A.enableMasonry&&C.js.push("/ThirdParty/masonry/masonry.pkgd.min.js"),C.js.push("/js/entity-charts.min.js?v=1"),document.getElementsByTagName("body")[0].classList.contains("btextDir-rtl")&&(A.dirLeft=!1),loadAndCall({files:C,callBack:function(){$(function(){ShowDimmer(!0),deepdash(_);if(p.value=JSON.stringify(_entitySummary.chartsJson),v.value=JSON.stringify([]),""!=(b="")){b=b.replace(/'/g,"'");var e=parseXml(b),t=xml2json(e,"");S=JSON.parse(t)}appGlobalVarsObject._CONSTANTS.menuConfiguration=$.extend(!0,{},appGlobalVarsObject._CONSTANTS.menuConfiguration,{menuJson:S}),appGlobalVarsObject._CONSTANTS.cardsPage={setCards:!1,cards:[]},$.axpertUI.options.cardsPage.cards=[],appGlobalVarsObject._CONSTANTS.cardsPage=$.extend(!0,{},appGlobalVarsObject._CONSTANTS.cardsPage,{setCards:!0,cards:(JSON.parse(""!==p.value?ReverseCheckSpecialChars(p.value):"[]",function(e,t){try{return"object"===_typeof(t)||isNaN(t)||""===t.toString().trim()?t:"string"==typeof t&&(t.startsWith("0")||t.startsWith("-"))?parseFloat(t,10):JSON.parse(t)}catch(a){return t}})||[]).map(function(e){return _.mapKeys(e,function(e,t){return t.toString().toLowerCase()})}),design:(JSON.parse(""!==v.value?v.value:"[]",function(e,t){try{return"object"===_typeof(t)||isNaN(t)||""===t.toString().trim()?t:"string"==typeof t&&(t.startsWith("0")||t.startsWith("-"))?parseFloat(t,10):JSON.parse(t)}catch(a){return t}})||[]).map(function(e){return _.mapKeys(e,function(e,t){return t.toString().toLowerCase()})}),enableMasonry:A.enableMasonry,staging:{iframes:".splitter-wrapper",cardsFrame:{div:".cardsPageWrapper",cardsDiv:"#Homepage_CardsList_Wrapper",cardsDesigner:".cardsDesigner",cardsDesignerToolbar:".designer",editSaveButton:".editSaveCardDesign",icon:"span.material-icons",divControl:"#arrangeCards"}}});appGlobalVarsObject.lcm;var a=$.axpertUI.init({isHybrid:appGlobalVarsObject._CONSTANTS.isHybrid,isMobile:A.isMobile,compressedMode:appGlobalVarsObject._CONSTANTS.compressedMode,dirLeft:A.dirLeft,axpertUserSettings:{settings:appGlobalVarsObject._CONSTANTS.axpertUserSettings},cardsPage:appGlobalVarsObject._CONSTANTS.cardsPage});appGlobalVarsObject._CONSTANTS.cardsPage=a.cardsPage,ShowDimmer(!1)}),$.axpertUI.cardsPage._addCardHeader=function(e,t){e.find(".card-header").addClass("d-none")}}})}catch(E){console.error("Error processing summary data:",E)}}})}},{key:"getEntityCaption",value:function(e){for(var t=this.selectedEntitiesList,a=0;a<t.length;a++)if(t[a].name===e)return t[a].caption;return""}},{key:"constructSelectedEntityHeader",value:function(){var e='<label id="selectedLabel" class="selected-name">Selected Entities</label>',t="";this.selectedEntitiesList.forEach(function(t,a){_entityCommon.getInitials(t.caption);e+=' <div data-cardname="'.concat(t.caption,'" onclick="toggleSelection(').concat(a,')" class="EntityData_Select-lists col-lg-3 col-md-3 col-sm-12 col-xs-3">\n                                    <div class="EntityData_Select-Items selected">\n                                        <div class="symbol symbol-40px symbol-circle me-2">\n                                            <img alt="" class="w-40px cardsIcons" src="../images/homepageicon/').concat(t.caption,'.png" \n                                                onerror="this.onerror=null;this.src=\'../images/homepageicon/default.png\';">\n                                        </div>\n                                        <h6 class="Entity-title" title="').concat(t.caption,'" value="').concat(t.name,'">\n                                            ').concat(t.caption,"(").concat(t.name,")\n                                        </h6>\n                                    </div>\n\n                                </div>")}),$("#selectedEntitiesContainer").html(e),$.each(this.selectedEntitiesList,function(e,a){var n=0===e?"active":"";_entityCommon.getInitials(a.caption);t+='<li class="nav-item" onclick="selectEntity(this, \''.concat(a.name,'\')" data-cardname="').concat(a.caption,'" dt_transid="').concat(a.name,'">\n                                <div class="symbol symbol-40px symbol-circle me-2">\n                                    <img alt="" class="w-40px cardsIcons" src="../images/homepageicon/').concat(a.caption,'.png" \n                                        onerror="this.onerror=null;this.src=\'../images/homepageicon/default.png\';">\n                                </div>\n                                <a class="nav-link ').concat(n,'" href="#">').concat(a.caption,"</a>\n                            </li>")}),$("#dv_EntityContainer").html(t);var a=$("#Data-Group-container .Data-Group_Items:first a"),n=$(a).parent();$(".Data-Group_Items").removeClass("selected"),$(n).addClass("selected");var s=$(".Aggregation-item:first");$(".Aggregation-item").removeClass("selected"),$(s).addClass("selected"),$("#entityModal").modal("hide")}},{key:"constructEntityPopup",value:function(e){var t="";$.each(e,function(e,a){if(!selectedItemsArray.map(function(e){return e.toLowerCase()}).includes(a.name.toLowerCase())){_entityCommon.getInitials(a.caption);t+='<div data-cardname="'.concat(a.caption,'" onclick="selectEntityToAdd(\'').concat(a.caption,"', '").concat(a.name,'\', this)" \n                                class="EntityData_Select-lists col-lg-3 col-md-3 col-sm-12 col-xs-3">\n                                    <div class="EntityData_Select-Items">\n                                        <div class="symbol symbol-40px symbol-circle me-2">\n                                            <img alt="" class="w-40px cardsIcons" src="../images/homepageicon/').concat(a.caption,'.png" \n                                                onerror="this.onerror=null;this.src=\'../images/homepageicon/default.png\';">\n                                        </div>\n                                        <h6 class="Entity-title" title="').concat(a.caption,'" value="').concat(a.name,'">\n                                            ').concat(a.caption,"(").concat(a.name,")\n                                        </h6>\n                                    </div>\n                                    \n                            </div>")}}),$("#entityDataContainer").html(t),$("#entityModal").modal("show"),$("#entityDataContainer .EntityData_Select-lists").each(function(){var e=$(this).find(".Entity-title").attr("value").toLowerCase();selectedItemsArray.map(function(e){return e.toLowerCase()}).includes(e)&&$(this).hide()})}},{key:"constructXandYAxis",value:function(e,t){var a=this;$("#Data-Group-container").html(""),$("#Aggregation_Wrapper").html("");var n="",s="";s+='<div class="col-lg-3 col-sm-4 Aggregation-Item-wrap agg-count" data-dcname="Count">\n                        <a href="#" class="Aggregation-item" onclick="selectAggField(this)">\n                            <div class="Aggregation-icon">\n                                <span class="material-icons material-icons-style material-icons-2">bar_chart</span>\n                            </div>\n                            <div class="Aggregation-content">\n                                <h6 class="subtitle"  data-fldname="Count">Count</h6>\n                            </div>\n                        </a>\n                    </div>',n+='<div class="Data-Group_Items group-all" data-dcname="All">\n                        <a href="#" class="group-item" onclick="selectGroupField(this)">\n                            <div class="d-flex">\n                                <div class="symbol symbol-40px symbol-circle me-5" style="margin-left:5px !important;">\n                                    <div class="symbol-label bgs1">\n                                        <span class="material-icons material-icons-style material-icons-2">date_range</span>\n                                    </div>\n                                </div>\n                                <div class="d-flex flex-column y-axis-caption">\n                                    <span class="Data-Group-name" nonmandatory="F" normalized="F" data-fldname="All" srctbl="All" srcfld="All">All</span>\n                                </div>\n                            </div>\n                        </a>\n                      </div>';var i=this.xAxisFields&&""!==this.xAxisFields.trim()&&"All"!==this.xAxisFields.trim()?this.xAxisFields.split(","):[],r=this.yAxisFields&&""!==this.yAxisFields.trim()&&"All"!==this.yAxisFields.trim()?this.yAxisFields.split(","):[];function o(e){return i.includes(e)?i.indexOf(e):r.includes(e)?r.indexOf(e)+i.length:-1}if(i.length>0){var c=e.filter(function(e){return i.includes(e.fldname)}).sort(function(e,t){return o(e.fldname)-o(t.fldname)});$.each(c,function(e,t){"T"===t.aggfield&&(s+=a.getAggFldHtml(t))})}else $.each(e,function(e,t){"T"===t.aggfield&&"F"===t.hide&&(s+=a.getAggFldHtml(t))});if(r.length>0){var l=e.filter(function(e){return r.includes(e.fldname)}).sort(function(e,t){return o(e.fldname)-o(t.fldname)});$.each(l,function(e,t){"T"!==t.grpfield||"DropDown"!==t.cdatatype&&"c"!==t.fdatatype&&"d"!==t.fdatatype||(n+=a.getGroupFldHtml(t))})}else $.each(e,function(e,t){"T"!==t.grpfield||"F"!==t.hide||"DropDown"!==t.cdatatype&&"c"!==t.fdatatype&&"d"!==t.fdatatype||(n+=a.getGroupFldHtml(t))});if($("#Data-Group-container").html(n),$("#Aggregation_Wrapper").html(s),"Entity Selection"===t||"Page Load"===t){var d=e.find(function(e){return e.ftransid}),u=d?d.ftransid:"default";_entitySummary.getAnalyticsChartsDataWS({page:"Analytics",transId:u,aggField:"count",aggTransId:u,groupField:"all",groupTransId:u,aggFunc:"count"});var m=$("#Data-Group-container .Data-Group_Items:first a"),f=$(m).parent();$(".Data-Group_Items").removeClass("selected"),$(f).addClass("selected");var h=$(".Aggregation-item:first");$(".Aggregation-item").removeClass("selected"),$(h).addClass("selected")}"Entity Selection"===t&&$("#entityModal").modal("hide")}},{key:"getGroupFldHtml",value:function(e){return'\n        <div class="Data-Group_Items" data-fldname="'.concat(e.fldname,'" data-dcname="').concat(e.dcname,'" data-griddc="').concat(e.griddc,'">\n            <a href="#" class="group-item" onclick="selectGroupField(this)" >\n                <div class="d-flex ">\n                    <div class="symbol symbol-40px symbol-circle me-5" style="margin-left:5px !important;">\n                        <div class="symbol-label bgs1">\n                            <span class="material-icons material-icons-style material-icons-2">date_range</span>\n                        </div>\n                    </div>\n                    <div class="d-flex flex-column y-axis-caption">\n                        <span class="Data-Group-name" data-fldname="').concat(e.fldname,'">').concat(e.fldcap||e.fldname,"</span>\n                    </div>\n                </div>\n            </a>\n        </div>")}},{key:"getAggFldHtml",value:function(e){return'\n        <div class="col-lg-3 col-sm-4 Aggregation-Item-wrap" data-fldname="'.concat(e.fldname,'" data-dcname="').concat(e.dcname,'" data-griddc="').concat(e.griddc,'">\n            <a href="#" class="Aggregation-item" onclick="selectAggField(this)">\n                <div class="Aggregation-icon">\n                    <span class="material-icons material-icons-style material-icons-2">bar_chart</span>\n                </div>\n                <div class="Aggregation-content">\n                    <h6 class="subtitle"  data-fldname="').concat(e.fldname,'" >').concat(e.fldcap||e.fldname,'</h6>\n                </div>\n                <div class="Aggregation-icon2">\n                    <button type="button" onclick="handleFuncSelection(event,this)" class="btn btn-icon btn-white btn-color-gray-600 btn-active-primary shadow-sm tb-btn btn-sm bg-success" agg_function="sum" title="Sum">\n                        <span class="material-icons material-icons-style material-icons-2">functions</span>\n                    </button>\n                    <button type="button" onclick="handleFuncSelection(event,this)" class="btn btn-icon btn-white btn-color-gray-600 btn-active-primary shadow-sm tb-btn btn-sm" agg_function="avg" title="Average">\n                        <span class="material-icons material-icons-style material-icons-2">percent</span>\n                    </button>\n                </div>\n            </a>\n        </div>')}},{key:"getUrlParams",value:function(){var e=window.location.search,t=new URLSearchParams(e);this.entityName=t.get("ename")}},{key:"getAllEntities",value:function(){var e=this,t=this;this.callAPI("../aspx/Analytics.aspx/GetEntityListWS",{},!0,function(a){if(a.success){var n=JSON.parse(JSON.parse(a.response).d);t.allEntitiesList=n.result.list,t.constructEntityPopup(e.allEntitiesList)}else console.log("Error fetching all entity list")})}},{key:"reloadAnalyticsPage",value:function(){parent.ShowDimmer(!0),parent.LoadIframe("../aspx/Analytics.aspx")}},{key:"callAPI",value:function(e,t,a,n){var s=this,i=new XMLHttpRequest;i.open("POST",e,a),i.setRequestHeader("Content-Type","application/json;charset=UTF-8"),s.isAxpertFlutter&&(i.setRequestHeader("Authorization","Bearer ".concat(armToken)),t.armSessionId=armSessionId),i.onreadystatechange=function(){4==this.readyState&&(200==this.status?n({success:!0,response:this.responseText}):(s.catchError(this.responseText),n({success:!1,response:this.responseText})))},i.send(JSON.stringify(t))}},{key:"catchError",value:function(e){showAlertDialog("error",e)}},{key:"showSuccess",value:function(e){showAlertDialog("success",e)}},{key:"dataConvert",value:function(e,t){if("AXPERT"==t)try{if("undefined"!=typeof(e=JSON.parse(e.d)).result[0].result.row)return e.result[0].result.row;if("undefined"!=typeof e.result[0].result)return e.result[0].result}catch(a){ShowDimmer(!1),this.catchError(a.message)}else if("ARM"==t)try{if(this.isAxpertFlutter||(e=JSON.parse(e.d)),e.result&&e.result.success){if(!_entityCommon.isUndefined(e.result.data))return e.result.data}else _entityCommon.isUndefined(e.result.message)||this.catchError(e.result.message)}catch(a){ShowDimmer(!1),this.catchError(a.message)}return e}},{key:"generateCustomKPIHTML",value:function(e,t){var a="";return e.forEach(function(e){var n,s=(e.criteria||"").split("~"),i=s[1].trim(),r=s[2].trim();a+='\n           <div class="col-xl-12 col-lg-12 col-sm-12 Invoice-content-wrap">\n    <a href="#" class="Invoice-item" >\n        <div class="Invoice-icon">\n            <span class="material-icons material-icons-style material-icons-2">bar_chart</span>\n        </div>\n        <div class="Invoice-content" >\n            <h6 class="subtitle" data-keyname="'.concat(e.keyname||t,'" onclick="navigateToListPage(\'').concat(i,"', '").concat(r,"', this)\">").concat(e.keyname||t,'</h6>\n            <h3 class="title">').concat((null===(n=e.keyvalue)||void 0===n?void 0:n.toLocaleString())||0,'</h3>\n        </div>\n        <div class="Invoice-icon2"></div>\n    </a>\n</div>\n\n        ')}),a}},{key:"generateGeneralKPIHTML",value:function(e){var t="";return t+='\n        <div class="col-xl-12 col-lg-12 col-sm-12 Invoice-content-wrap">\n            <a href="#" class="Invoice-item">\n                <div class="Invoice-icon">\n                    <span class="material-icons material-icons-style material-icons-2">bar_chart</span>\n                </div>\n                <div class="Invoice-content">\n                    <h6 class="subtitle" onclick="navigateToPeriod(\'total\')">Total</h6>\n                    <h3 class="title">'.concat(e.totrec||0,'</h3>\n                </div>\n                <div class="Invoice-icon2"></div>\n            </a>\n        </div>\n    '),0!==e.cyear&&(t+='\n            <div class="col-xl-12 col-lg-12 col-sm-12 Invoice-content-wrap">\n                <a href="#" class="Invoice-item">\n                    <div class="Invoice-icon">\n                        <span class="material-icons material-icons-style material-icons-2">bar_chart</span>\n                    </div>\n                    <div class="Invoice-content">\n                        <h6 class="subtitle" onclick="navigateToPeriod(\'year\')">This year</h6>\n                        <h3 class="title">'.concat(e.cyear||0,'</h3>\n                    </div>\n                    <div class="Invoice-icon2"></div>\n                </a>\n            </div>\n        ')),0!==e.cmonth&&(t+='\n            <div class="col-xl-12 col-lg-12 col-sm-12 Invoice-content-wrap">\n                <a href="#" class="Invoice-item">\n                    <div class="Invoice-icon">\n                        <span class="material-icons material-icons-style material-icons-2">bar_chart</span>\n                    </div>\n                    <div class="Invoice-content">\n                        <h6 class="subtitle" onclick="navigateToPeriod(\'month\')">This month</h6>\n                        <h3 class="title">'.concat(e.cmonth||0,'</h3>\n                    </div>\n                    <div class="Invoice-icon2"></div>\n                </a>\n            </div>\n        ')),0!==e.cweek&&(t+='\n            <div class="col-xl-12 col-lg-12 col-sm-12 Invoice-content-wrap">\n                <a href="#" class="Invoice-item">\n                    <div class="Invoice-icon">\n                        <span class="material-icons material-icons-style material-icons-2">bar_chart</span>\n                    </div>\n                    <div class="Invoice-content">\n                        <h6 class="subtitle" onclick="navigateToPeriod(\'week\')">This week</h6>\n                        <h3 class="title">'.concat(e.cweek||0,'</h3>\n                    </div>\n                    <div class="Invoice-icon2"></div>\n                </a>\n            </div>\n        ')),0!==e.cyesterday&&(t+='\n            <div class="col-xl-12 col-lg-12 col-sm-12 Invoice-content-wrap">\n                <a href="#" class="Invoice-item">\n                    <div class="Invoice-icon">\n                        <span class="material-icons material-icons-style material-icons-2">bar_chart</span>\n                    </div>\n                    <div class="Invoice-content">\n                        <h6 class="subtitle" onclick="navigateToPeriod(\'yesterday\')">Yesterday</h6>\n                        <h3 class="title">'.concat(e.cyesterday||0,'</h3>\n                    </div>\n                    <div class="Invoice-icon2"></div>\n                </a>\n            </div>\n        ')),0!==e.ctoday&&(t+='\n            <div class="col-xl-12 col-lg-12 col-sm-12 Invoice-content-wrap">\n                <a href="#" class="Invoice-item">\n                    <div class="Invoice-icon">\n                        <span class="material-icons material-icons-style material-icons-2">bar_chart</span>\n                    </div>\n                    <div class="Invoice-content">\n                        <h6 class="subtitle" onclick="navigateToPeriod(\'today\')">Today</h6>\n                        <h3 class="title">'.concat(e.ctoday||0,'</h3>\n                    </div>\n                    <div class="Invoice-icon2"></div>\n                </a>\n            </div>\n        ')),t}},{key:"filterByFldname",value:function(e,t){return e.filter(function(e){return e.fldname===t})}},{key:"getChartCriteria",value:function(e){return e.split("~~").slice(0,4).join("~~")}},{key:"getChartCaptions",value:function(e){if(!this.selectedChartsObj[e]){var t=e.split("~"),a=this.filterByFldname(this.metaData,t[2]),n=this.filterByFldname(this.metaData,t[9]),s=t[0],i="";i=0===a.length||""==t[2]?"count"===s?"".concat(this.entityName," (Count)"):"".concat(n[0].fldcap||""," (").concat(s,")"):"count"===s?"".concat(a[0].fldcap||""," wise ").concat(s):"".concat(a[0].fldcap||""," wise ").concat(n[0].fldcap||""," (").concat(s,")"),this.selectedChartsObj[e]=i}return this.selectedChartsObj[e]}},{key:"checkAppmanagerAccess",value:function(){_entityCommon.isAppManager()||(document.querySelector("#Entity_Summary_Wrapper .card-header .Tkts-toolbar-Right").innerHTML="")}}]),e}();function applyEntitySearch(){var e=$("#searchEntity").val().trim().toLowerCase();""===e?$("#entityDataContainer .EntityData_Select-lists, #selectedEntitiesContainer .EntityData_Select-lists").removeClass("d-none"):($("#entityDataContainer .EntityData_Select-lists").addClass("d-none"),$("#entityDataContainer").find(".EntityData_Select-lists").filter(function(){return $(this).text().toLowerCase().indexOf(e)>-1}).removeClass("d-none"),$("#selectedEntitiesContainer .EntityData_Select-lists").addClass("d-none"),$("#selectedEntitiesContainer").find(".EntityData_Select-lists").filter(function(){return $(this).text().toLowerCase().indexOf(e)>-1}).removeClass("d-none"))}function selectGroupField(e){var t=$(e).parent();$(".Data-Group_Items").removeClass("selected"),$(t).addClass("selected");var a=$(e).find(".Data-Group-name").attr("data-fldname").toLowerCase(),n=$(".Aggregation-item.selected").find(".subtitle").attr("data-fldname").toLowerCase(),s=_entitySummary.metaData.find(function(e){return e.fldname===a}),i="all"===a?"all":a,r=n||"count",o=$(".Aggregation-item.selected").find("button.bg-success").attr("agg_function")||"count",c="all"===a?_entitySummary.entityTransId:s?s.ftransid:null;i&&r&&c?("all"===i||s&&"F"===s.griddc?showAllXAxis():constructXandYAxisForSelectedGroup(i),_entitySummary.getAnalyticsChartsDataWS({page:"Analytics",transId:c,aggField:r,aggTransId:c,groupField:i,groupTransId:c,aggFunc:o})):console.error("One or more required fields are missing from the selected item.")}function constructXandYAxisForSelectedGroup(e){document.querySelectorAll(".Aggregation-Item-wrap").forEach(function(t){t.classList.add("d-none");var a=t.dataset.dcname;"Count"!=a&&a!=e||t.classList.remove("d-none")});var t=document.querySelector(".Aggregation-item.selected");t.closest(".Aggregation-Item-wrap").classList.contains("d-none")&&(t.classList.remove("selected"),document.querySelector(".agg-count .Aggregation-item").classList.add("selected"))}function showAllXAxis(){document.querySelectorAll(".Aggregation-Item-wrap.d-none").forEach(function(e){e.classList.remove("d-none")})}function selectEntityToAdd(e,t,a){var n=$(a).find(".EntityData_Select-Items");n.hasClass("selected")?(n.removeClass("selected"),selectedItemsArray.includes(t)&&(selectedItemsArray=selectedItemsArray.filter(function(e){return e!==t}))):(n.addClass("selected"),selectedItemsArray.includes(t)||selectedItemsArray.push(t))}function selectAggField(e,t){$(".Aggregation-item").removeClass("selected"),$(e).addClass("selected");var a=$(e).find(".subtitle").attr("data-fldname"),n=$(".Data-Group_Items.selected").attr("data-fldname"),s=_entitySummary.metaData.find(function(e){return e.fldname===a}),i="all",r="count",o="count",c=null;"Count"===a?(i=n||"all",r="count",o="count",c=_entitySummary.entityTransId):s&&(o=$(e).find("button.bg-success").attr("agg_function"),i=n||"all",r=a,c=s.ftransid),i&&r&&o&&("count"===a||c)?_entitySummary.getAnalyticsChartsDataWS({page:"Analytics",transId:c,aggField:r,aggTransId:c,groupField:i,groupTransId:c,aggFunc:o,chartType:t}):console.error("One or more required fields are missing from the selected item.")}function handleFuncSelection(e,t){e.stopPropagation(),t.closest(".Aggregation-icon2").querySelectorAll("button").forEach(function(e){e.classList.remove("bg-success")}),t.classList.add("bg-success"),t.closest(".Aggregation-item").click()}function chartSelectionClick(e,t){e.stopPropagation(),t.closest(".chart-selections").querySelectorAll("button").forEach(function(e){e.classList.remove("bg-success")}),t.classList.add("bg-success");var a=t.getAttribute("chart_type"),n=$(".Aggregation-item.selected").get(0);n?selectAggField(n,a):console.error("No aggregation field is selected.")}function entityModelClose(){$("#entityModal").modal("hide")}function resetSelection(){$("#entityDataContainer .selected").removeClass("selected");_entityCommon.setAnalyticsDataWS({page:"Analytics",transId:"",properties:{Entities:""},allUsers:!1},successCB=function(){window.location.reload()},errorCB=function(e){showAlertDialog("error",e.status+" "+e.statusText)})}function saveSelectedEntities(){var e=_entitySummary.selectedEntitiesList.filter(function(e){return!e.toBeRemoved});_entitySummary.selectedEntitiesList.forEach(function(e){e.toBeRemoved=!1});var t=e.map(function(e){return e.name}).concat(selectedItemsArray);if(t.length>0){selectedItemsArray=t,$("#entityDataContainer .EntityData_Select-lists").each(function(){var e=$(this).find(".Entity-title").attr("value").toLowerCase();t.map(function(e){return e.toLowerCase()}).includes(e)&&$(this).hide()});var a={page:"Analytics",transId:"",properties:{Entities:t.join(",")},allUsers:!1};_entityCommon.setAnalyticsDataWS(a,successCB=function(){window.location.reload()},errorCB=function(e){showAlertDialog("error",e.status+" "+e.statusText)})}else showAlertDialog("error","Please select at least one entity to proceed.")}function selectEntity(e,t){document.querySelectorAll("#dv_EntityContainer .nav-link.active").forEach(function(e){return e.classList.remove("active")}),e.querySelector(".nav-link").classList.add("active"),_entitySummary.entityTransId=t,_entitySummary.entityName=_entitySummary.getEntityCaption(t),fetchEntityData(t)}function moveselection(e){switch(e){case"up":var t=$(".Data-Group_Items.selected");if((s=$(t).prev(".Data-Group_Items")).length>0)$(".Data-Group_Items").removeClass("selected"),$(s).addClass("selected"),$(s).find(".group-item").click();else{var a=$(".Data-Group_Items").last();$(".Data-Group_Items").removeClass("selected"),$(a).addClass("selected"),$(a).find(".group-item").click()}break;case"down":t=$(".Data-Group_Items.selected");if((r=$(t).next(".Data-Group_Items")).length>0)$(".Data-Group_Items").removeClass("selected"),$(r).addClass("selected"),$(r).find(".group-item").click();else{var n=$(".Data-Group_Items").first();$(".Data-Group_Items").removeClass("selected"),$(n).addClass("selected"),$(n).find(".group-item").click()}break;case"left":t=$(".Aggregation-item.selected");var s,i=$(t).closest(".Aggregation-Item-wrap");0===(s=$(i).prev().find(".Aggregation-item").last()).length&&(s=$(i).siblings().last().find(".Aggregation-item").last()),s.length>0&&($(".Aggregation-item").removeClass("selected"),$(s).addClass("selected"),$(s).click());break;case"right":var r;t=$(".Aggregation-item.selected"),i=$(t).closest(".Aggregation-Item-wrap");0===(r=$(i).next().find(".Aggregation-item").first()).length&&(r=$(i).siblings().first().find(".Aggregation-item").first(),moveselection("down")),r.length>0&&($(".Aggregation-item").removeClass("selected"),$(r).addClass("selected"),$(r).click())}}function reloadPage(){window.location.reload()}function ShowDimmer(e){DimmerCalled=!0;var t=$("#waitDiv");if(t.length>0&&t!=undefined)if(1==e){var a=$("#middle1",parent.document);a&&t.width(a.width()),t.show(),document.onkeydown=function(){return!1}}else t.hide(),document.onkeydown=function(){if(1==DimmerCalled)return!0};else window.opener!=undefined&&(t=$("#waitDiv",window.opener.document)).length>0&&(1==e?t.show():t.hide());DimmerCalled=!1}function openEntitySelection(){""==$("#entityDataContainer").html()?_entitySummary.getAllEntities():$("#entityModal").modal("show")}function openFieldSelection(){$("#fieldsModal").modal("show"),createFieldsLayout()}function createFieldsLayout(){var e=document.getElementById("fields-selection"),t=_entitySummary.xAxisFields||"All",a=_entitySummary.yAxisFields||"All",n="All"===t?[]:t.split(","),s="All"===a?[]:a.split(","),i=_entitySummary.metaData.filter(function(e){return"T"===e.grpfield&&("DropDown"===e.cdatatype||"c"===e.fdatatype||"d"===e.fdatatype)});function r(e,t){return e.sort(function(e,a){var n=t.includes(e.fldname),s=t.includes(a.fldname);return n&&!s?-1:!n&&s?1:t.indexOf(e.fldname)-t.indexOf(a.fldname)})}var o=r(_entitySummary.metaData.filter(function(e){return"T"===e.aggfield}),n),c=r(i,s),l="";o.length&&(l+='\n        <div class="card KC_Items">\n            <div class="card-header collapsible cursor-pointer rotate" data-bs-toggle="collapse" aria-expanded="true" data-bs-target="#fields-aggFields">\n                <h3 class="card-title">Aggregate Fields (X-axis)</h3>\n                <div class="card-toolbar rotate-180">\n                    <span class="material-icons material-icons-style material-icons-2">expand_circle_down</span>\n                </div>\n            </div>\n            <div class="KC_Items_Content collapse show heightControl pt-0---" id="fields-aggFields">\n            <table class="table table-hover">\n                <tbody id="fields-table-body">',o.forEach(function(e){var t="".concat(e.fldcap||"","  (").concat(e.fldname,") (").concat(e.dcname,") ").concat("T"==e.hide?"(Hidden)":"");l+='<tr><td><input type="checkbox" id="chk_'.concat(e.fldname,'" class="chk-fields chk-relateddataflds" value="').concat(e.fldname,'" data-fldcap="').concat(e.fldcap||"",'"></td>\n            <td><label for="chk_').concat(e.fldname,'">').concat(t,"</label></td></tr>")}),l+="</tbody></table></div></div>"),c.length&&(l+='\n        <div class="card KC_Items">\n            <div class="card-header collapsible cursor-pointer rotate" data-bs-toggle="collapse" aria-expanded="true" data-bs-target="#fields-grpFields">\n                <h3 class="card-title">Group Fields (Y-axis)</h3>\n                <div class="card-toolbar rotate-180">\n                    <span class="material-icons material-icons-style material-icons-2">expand_circle_down</span>\n                </div>\n            </div>\n            <div class="KC_Items_Content collapse show heightControl pt-0---" id="fields-grpFields">\n            <table class="table table-hover">\n                <tbody id="fields-table-body">',c.forEach(function(e){var t="".concat(e.fldcap||"","  (").concat(e.fldname,")  (").concat(e.dcname,") ").concat("T"==e.hide?"(Hidden)":"");l+='<tr><td><input type="checkbox" id="chk_'.concat(e.fldname,'" class="chk-fields chk-relateddataflds" value="').concat(e.fldname,'" data-fldcap="').concat(e.fldcap||"",'"></td>\n            <td><label for="chk_').concat(e.fldname,'">').concat(t,"</label></td></tr>")}),l+="</tbody></table></div></div>"),e.innerHTML=l;var d=document.querySelectorAll(".chk-fields");"All"===t&&d.forEach(function(e){o.some(function(t){return e.id==="chk_".concat(t.fldname)})&&(e.checked=!0)}),"All"===a&&d.forEach(function(e){c.some(function(t){return e.id==="chk_".concat(t.fldname)})&&(e.checked=!0)}),n.forEach(function(e){if("All"!==e){var t=document.querySelector("#chk_".concat(e));t?t.checked=!0:console.warn("Checkbox with ID #chk_".concat(e," not found."))}}),s.forEach(function(e){if("All"!==e){var t=document.querySelector("#chk_".concat(e));t?t.checked=!0:console.warn("Checkbox with ID #chk_".concat(e," not found."))}}),d.forEach(function(e){e.addEventListener("change",function(){var e=d.length===document.querySelectorAll(".chk-fields:checked").length;document.querySelector("#check-all").checked=e})});var u=document.getElementById("check-all");u.addEventListener("change",function(){var e=u.checked;d.forEach(function(t){t.checked=e})})}function applyFields(){var e=document.querySelectorAll(".chk-fields:checked");if(0!==e.length){var t=document.getElementById("fields-aggFields"),a=document.getElementById("fields-grpFields"),n=[],s=[];e.forEach(function(e){var i=e.value;e.closest(".card")&&(t&&t.contains(e.closest("div"))?n.push(i):a&&a.contains(e.closest("div"))&&s.push(i))}),n=n.join(","),s=s.join(",");var i={page:"Analytics",transId:_entitySummary.entityTransId,properties:{xAxisFields:n,yAxisFields:s},allUsers:!1};_entityCommon.setAnalyticsDataWS(i,successCB=function(){var e=_entitySummary.entityTransId,t=document.querySelector('[dt_transid="'.concat(e,'"]'));t?(fieldsModelClose(),selectEntity(t,e)):console.error('Element with dt_transid="'.concat(e,'" not found'))},errorCB=function(e){showAlertDialog("error",e.status+" "+e.statusText)})}else showAlertDialog("error","Error: No fields are selected.")}function resetFields(){document.querySelectorAll(".chk-fields , #check-all").forEach(function(e){e.checked=!0}),_entitySummary.fields="All",_entitySummary.setSelectedFields()}function fieldsModelClose(){$("#fieldsModal").modal("hide")}function toggleSelection(e){var t=_entitySummary.selectedEntitiesList[e];t.toBeRemoved=!t.toBeRemoved,$("#selectedEntitiesContainer .EntityData_Select-lists:eq(".concat(e,")")).find(".EntityData_Select-Items").toggleClass("selected");var a=_entitySummary.selectedEntitiesList.some(function(e){return!e.toBeRemoved});$(".selcted").toggle(a),t.toBeRemoved||$("#entityDataContainer .EntityData_Select-lists").each(function(){var e=$(this).find(".EntityData_Select-Items").text().trim().toLowerCase();console.log("Showing entity: ".concat(e)),e===t.name.toLowerCase()&&$(this).show()})}function navigateToListPage(e,t,a){if(_entityCommon.inValid(t)){var n=_entitySummary.selectedEntitiesList.find(function(t){return t.name===e}).caption;loadEntityPage("../aspx/Entity.aspx?ename=".concat(n,"&tstid=").concat(e))}else{var s=a.getAttribute("data-keyname");if(_entitySummary.selectedEntitiesList&&t){var i=_entitySummary.selectedEntitiesList.find(function(t){return t.name===e});if(i){var r=i.caption;loadEntityPage("../aspx/Entity.aspx?ename=".concat(r,"&tstid=").concat(e,"&filterval=").concat(s,"&filterfld=").concat(t,"&applyfilter=true"))}else console.error("Entity not found for transid: ".concat(e))}else console.error("selectedEntitiesList or fldname is undefined")}}function navigateToPeriod(e){var t=_entitySummary.entityTransId;if(_entitySummary.selectedEntitiesList){var a=_entitySummary.selectedEntitiesList.find(function(e){return e.name===t});if(a){var n=a.caption,s="../aspx/Entity.aspx?ename=".concat(n,"&tstid=").concat(t,"&filterval=").concat(e,"&filterfld=modifiedon");"total"!==e.trim().toLowerCase()&&(s+="&applyfilter=true"),loadEntityPage(s)}else console.error("Entity not found for transid: ".concat(t))}else console.error("selectedEntitiesList is undefined")}function loadEntityPage(e){parent.ShowDimmer(!0),parent.LoadIframe(e)}function handleNoChartData(){document.querySelectorAll(".analytics-container").forEach(function(e){e.classList.add("d-none")}),document.querySelector(".nodata").classList.remove("d-none")}function handleValidChartData(){document.querySelectorAll(".analytics-container").forEach(function(e){e.classList.remove("d-none")}),document.querySelector(".nodata").classList.add("d-none")}function fetchEntityData(e,t){$.ajax({url:top.window.location.href.toLowerCase().substring(0,top.window.location.href.toLowerCase().indexOf("/aspx/"))+"/aspx/Analytics.aspx/GetAnalyticsEntityWS",type:"POST",cache:!1,async:!0,dataType:"json",data:JSON.stringify({page:"Analytics",transId:e}),contentType:"application/json",success:function(e){if(e&&e.d){var t=JSON.parse(e.d),a=t.result.data.Properties,n=a.xAxisFields,s=a.yAxisFields;_entitySummary.xAxisFields=n||"All",_entitySummary.yAxisFields=s||"All",_entitySummary.metaData=t.result.data.MetaData,_entitySummary.entityTransId=t.result.data.TransId,_entitySummary.entityName=_entitySummary.getEntityCaption(_entitySummary.entityTransId),_entitySummary.constructXandYAxis(_entitySummary.metaData,"Page Load")}},error:function(e){console.error("Error fetching entity data:",e)}})}$(document).ready(function(){_entityCommon=new EntityCommon,(_entitySummary=new EntitySummary).init(),$("#searchEntity").keyup(function(e){applyEntitySearch()}).change(function(e){applyEntitySearch()}),$(document).keydown(function(e){switch(e.which){case 37:moveselection("left");break;case 38:moveselection("up");break;case 39:moveselection("right");break;case 40:moveselection("down");break;default:return}e.preventDefault()})}),document.addEventListener("DOMContentLoaded",function(){var e=document.getElementById("dv_EntityContainer"),t="",a="";function n(e){(a=(t=this).cloneNode(!0)).classList.add("drag-image"),document.body.appendChild(a),e.dataTransfer.effectAllowed="move",e.dataTransfer.setDragImage(a,0,0),e.dataTransfer.setData("text/html",this.innerHTML),this.classList.add("dragging")}function s(e){return e.preventDefault&&e.preventDefault(),e.dataTransfer.dropEffect="move",!1}function i(e){this!==t&&this.classList.add("over")}function r(e){this.classList.remove("over")}function o(n){if(n.stopPropagation&&n.stopPropagation(),t!==this){var s=Array.from(e.querySelectorAll(".nav-item"));s.indexOf(t)<s.indexOf(this)?this.after(t):this.before(t)}a&&a.parentNode&&a.parentNode.removeChild(a);var i={page:"Analytics",transId:"",properties:{Entities:Array.from(e.querySelectorAll(".nav-item")).map(function(e){return e.getAttribute("dt_transid")}).join(",")},allUsers:!1};return _entityCommon.setAnalyticsDataWS(i,successCB=function(){},errorCB=function(e){showAlertDialog("error",e.status+" "+e.statusText)}),!1}function c(e){this.classList.remove("dragging"),d.forEach(function(e){e.classList.remove("over")}),a&&a.parentNode&&a.parentNode.removeChild(a)}function l(e){e.addEventListener("dragstart",n,!1),e.addEventListener("dragenter",i,!1),e.addEventListener("dragover",s,!1),e.addEventListener("dragleave",r,!1),e.addEventListener("drop",o,!1),e.addEventListener("dragend",c,!1)}var d=e.querySelectorAll(".nav-item");d.forEach(function(e){e.setAttribute("draggable","true"),l(e)}),new MutationObserver(function(e){e.forEach(function(e){e.addedNodes.length&&e.addedNodes.forEach(function(e){1===e.nodeType&&e.classList.contains("nav-item")&&(e.setAttribute("draggable","true"),l(e))})})}).observe(e,{childList:!0})}),document.addEventListener("DOMContentLoaded",function(){var e=document.getElementById("Data-Group-container"),t="",a=null;function n(e){t=this,e.dataTransfer.effectAllowed="move",(a=this.cloneNode(!0)).style.position="absolute",a.style.top="-1000px",document.body.appendChild(a),e.dataTransfer.setDragImage(a,e.offsetX,e.offsetY),this.classList.add("dragging")}function s(e){return e.preventDefault&&e.preventDefault(),e.dataTransfer.dropEffect="move",!1}function i(e){this!==t&&this.classList.add("over")}function r(e){this.classList.remove("over")}function o(a){if(a.stopPropagation&&a.stopPropagation(),t!==this){var n=Array.from(e.querySelectorAll(".Data-Group_Items:not(.first-item):not(.selected)"));n.indexOf(t)<n.indexOf(this)?this.after(t):this.before(t),n.forEach(function(e){var t=e.querySelector(".material-icons");t&&(t.style.color=e.dataset.initialColor)});var s=Array.from(e.querySelectorAll(".Data-Group_Items:not(.first-item):not(.selected)")).map(function(e){return e.getAttribute("data-fldname")});console.log("Updated yOrder:",s);var i=t.getAttribute("data-fldname");console.log("Selected fldname:",i);var r=_entitySummary.metaData.find(function(e){return e.fldname===i});if(r){var o=r.ftransid;console.log("Found ftransid:",o);var c={page:"Analytics",transId:o,properties:{yAxisFields:s.join(",")},allUsers:!1};_entityCommon.setAnalyticsDataWS(c,successCB=function(){},errorCB=function(e){showAlertDialog("error",e.status+" "+e.statusText)})}else console.warn("Metadata item not found for selected fldname:",i)}return!1}function c(t){this.classList.remove("dragging"),Array.from(e.querySelectorAll(".Data-Group_Items:not(.first-item):not(.selected)")).forEach(function(e){e.classList.remove("over")}),a&&(document.body.removeChild(a),a=null)}function l(e){e.addEventListener("dragstart",n,!1),e.addEventListener("dragenter",i,!1),e.addEventListener("dragover",s,!1),e.addEventListener("dragleave",r,!1),e.addEventListener("drop",o,!1),e.addEventListener("dragend",c,!1)}var d=e.querySelector(".Data-Group_Items:first-child");d&&d.classList.add("first-item"),e.querySelectorAll(".Data-Group_Items:not(.first-item):not(.selected)").forEach(function(e){e.setAttribute("draggable","true");var t=e.querySelector(".material-icons");t&&(e.dataset.initialColor=window.getComputedStyle(t).color),l(e)}),new MutationObserver(function(e){e.forEach(function(e){e.addedNodes.length&&e.addedNodes.forEach(function(e){if(e.classList&&e.classList.contains("Data-Group_Items")&&!e.classList.contains("selected")&&!e.classList.contains("first-item")){e.setAttribute("draggable","true");var t=e.querySelector(".material-icons");t&&(e.dataset.initialColor=window.getComputedStyle(t).color),l(e)}})})}).observe(e,{childList:!0})}),document.addEventListener("DOMContentLoaded",function(){var e=document.getElementById("Aggregation_Wrapper"),t="",a=null;function n(e){"false"!==this.getAttribute("draggable")&&(t=this,e.dataTransfer.effectAllowed="move",(a=this.cloneNode(!0)).style.position="absolute",a.style.top="-1000px",document.body.appendChild(a),e.dataTransfer.setDragImage(a,e.offsetX,e.offsetY),this.classList.add("dragging"))}function s(e){return e.preventDefault&&e.preventDefault(),e.dataTransfer.dropEffect="move",!1}function i(e){this!==t&&this.classList.add("over")}function r(e){this.classList.remove("over")}function o(a){if(a.stopPropagation&&a.stopPropagation(),t!==this){var n=Array.from(e.querySelectorAll(".Aggregation-Item-wrap"));n.indexOf(t)<n.indexOf(this)?this.after(t):this.before(t);var s=Array.from(e.querySelectorAll(".Aggregation-Item-wrap")).map(function(e){return e.getAttribute("data-fldname")});console.log("Updated xOrder:",s);var i=t.getAttribute("data-fldname");console.log("Selected fldname:",i);var r=_entitySummary.metaData.find(function(e){return e.fldname===i});if(r){var o=r.ftransid;console.log("Found ftransid:",o);var c={page:"Analytics",transId:o,properties:{xAxisFields:s.join(",")},allUsers:!1};_entityCommon.setAnalyticsDataWS(c,successCB=function(){},errorCB=function(e){showAlertDialog("error",e.status+" "+e.statusText)})}else console.warn("Metadata item not found for selected fldname:",i)}return!1}function c(t){this.classList.remove("dragging"),Array.from(e.querySelectorAll(".Aggregation-Item-wrap:not(.selected)")).forEach(function(e){e.classList.remove("over")}),a&&(document.body.removeChild(a),a=null)}function l(e){e.addEventListener("dragstart",n,!1),e.addEventListener("dragenter",i,!1),e.addEventListener("dragover",s,!1),e.addEventListener("dragleave",r,!1),e.addEventListener("drop",o,!1),e.addEventListener("dragend",c,!1)}e.querySelectorAll(".Aggregation-Item-wrap").forEach(function(e,t){0!==t?(e.setAttribute("draggable","true"),l(e)):e.setAttribute("draggable","false")}),new MutationObserver(function(t){t.forEach(function(t){t.addedNodes.length&&t.addedNodes.forEach(function(t){t.classList&&t.classList.contains("Aggregation-Item-wrap")&&(0!==Array.from(e.children).indexOf(t)&&(t.setAttribute("draggable","true"),l(t)))})})}).observe(e,{childList:!0})});
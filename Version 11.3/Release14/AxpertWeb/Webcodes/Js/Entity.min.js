/*https://web.agile-labs.com/minZIP/*//*version=3.9.1*/function _createForOfIteratorHelper(e,t){var a="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!a){if(Array.isArray(e)||(a=_unsupportedIterableToArray(e))||t&&e&&"number"==typeof e.length){a&&(e=a);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,o=!0,l=!1;return{s:function(){a=a.call(e)},n:function(){var e=a.next();return o=e.done,e},e:function(e){l=!0,r=e},f:function(){try{o||null==a["return"]||a["return"]()}finally{if(l)throw r}}}}function ownKeys(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),a.push.apply(a,n)}return a}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(a),!0).forEach(function(t){_defineProperty(e,t,a[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):ownKeys(Object(a)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))})}return e}function _defineProperty(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function _typeof(e){"@babel/helpers - typeof";return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArray(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_unsupportedIterableToArray(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=new Array(t);a<t;a++)n[a]=e[a];return n}function _iterableToArrayLimit(e,t){var a=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=a){var n,i,r=[],o=!0,l=!1;try{for(a=a.call(e);!(o=(n=a.next()).done)&&(r.push(n.value),!t||r.length!==t);o=!0);}catch(c){l=!0,i=c}finally{try{o||null==a["return"]||a["return"]()}finally{if(l)throw i}}return r}}function _arrayWithHoles(e){if(Array.isArray(e))return e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass(e,t,a){return t&&_defineProperties(e.prototype,t),a&&_defineProperties(e,a),Object.defineProperty(e,"prototype",{writable:!1}),e}var tableViewFlag="",removedKeys=new Set,isEditMode="",isFetching=!1,lastScrollTop=0,lastScrollLeft=0,dtCulture=eval(callParent("glCulture")),_entity,_entityCommon,appliedFilterObj={},currentEditFieldId=null,filterChanged=!1,rowData,pageNo=1,Entity=function(){function e(){_classCallCheck(this,e),this.entityName="",this.entityTransId="",this.metaData={},this.listJson={},this.maxPageNumber=1,this.pageSize=50,this.kpiJson=[],this.chartsJson=[],this.chartsMetaData={},this.selectedCharts="",this.selectedChartsObj={},this.fldData={},this.emptyRowsHtml="No data found",this.nullRowsHtml="Configure the fields properly in the 'Select Field(s)' option",this.filter="",this.fields="All",this.keyField="",this.filterObj={},this.applyFilter=!1,this.applyFilterStr="",this.applyFilterId="",this.allowCreate=!0,this.isLastPage=!1}return _createClass(e,[{key:"init",value:function(){var e=this;if(parent.ShowDimmer(!1),this.getUrlParams(),this.inValid(this.entityName))this.catchError("Invalid Entity details");else{this.applyTheme(),document.querySelector("#EntityTitle").innerHTML=this.entityName,document.title=this.entityName;var t=document.getElementById("body_Container");try{var a={page:"Entity",transId:_entity.entityTransId,propertiesList:["tableView"]};_entityCommon.getAnalyticsDataWS(a,function(a){var n,i,r,o,l="string"==typeof a?JSON.parse(a):a;tableViewFlag="string"==typeof l.result.data.tableView?"TRUE"===l.result.data.tableView.toUpperCase():!!l.result.data.tableView,entityListDataJson=entityListDataJson.replaceAll('"{',"{").replaceAll('}"',"}").replaceAll('"[',"[").replaceAll(']"',"]"),entityListDataJson=JSON.parse(entityListDataJson),e.metaData=entityListDataJson.result.metadata;var c=e.metaData.find(function(e){return"dc1"===e.dcname}),s=c?c.tablename:null;if(e.metaData.push({ftransid:e.entityTransId,fcaption:e.entityName,fldname:"modifiedon",fldcap:"Modified on",cdatatype:"Date",fdatatype:"d",fmodeofentry:"calculate",hide:"F",props:null,normalized:"F",allowempty:"T",filtertype:"Text",tablename:s,dcname:"dc1"}),e.metaData.push({ftransid:e.entityTransId,fcaption:e.entityName,fldname:"modifiedby",fldcap:"Modified by",cdatatype:"DropDown",fdatatype:"c",fmodeofentry:"calculate",hide:"F",props:null,normalized:"F",allowempty:"T",filtertype:"Text",tablename:s,dcname:"dc1"}),e.listJson=null!==(n=null===(i=entityListDataJson.result.list)||void 0===i?void 0:null===(r=i[0])||void 0===r?void 0:r.data_json)&&void 0!==n?n:[],e.fields=entitySelectedFlds||"All",e.keyField=entityKeyField||"",e.maxPageNumber=getMaxPageNumber(e.listJson),e.applyFilter){var d,u,p,m,f,h,y,v,g=_slicedToArray(e.applyFilterStr.split("^^^"),2),b=g[0],T=g[1],D=e.metaData.find(function(e){return e.fldname==b});e.applyFilterId=getCurrentTimestamp();var S,w={},_=T;if("DROPDOWN"==(null===(d=D.cdatatype)||void 0===d?void 0:d.toUpperCase())||"SELECT"==(null===(u=D.fmodeofentry)||void 0===u?void 0:u.toUpperCase()))w[e.applyFilterId]={pillText:_,isChecked:!1},w[e.applyFilterId][b]="DROPDOWN,".concat(T);else if("DATE"==(null===(p=D.cdatatype)||void 0===p?void 0:p.toUpperCase())&&"modifiedon"==D.fldname){switch(T){case"year":S="this_yearOption",_="This year";break;case"month":S="this_monthOption",_="This month";break;case"week":S="this_weekOption",_="This week";break;case"day":S="todayOption",_="Today";break;case"yesterday":S="yesterdayOption",_="Yesterday"}w[e.applyFilterId]={pillText:_,isChecked:!1},w[e.applyFilterId][b]="DATE,".concat(S)}else"SIMPLE TEXT"==(null===(m=D.cdatatype)||void 0===m?void 0:m.toUpperCase())?(w[e.applyFilterId]={pillText:_||T,isChecked:!1},w[e.applyFilterId][b]="SIMPLE TEXT,".concat(T)):"AUTO GENERATE"==(null===(f=D.cdatatype)||void 0===f?void 0:f.toUpperCase())?(w[e.applyFilterId]={pillText:_||"Auto-generated",isChecked:!1},w[e.applyFilterId][b]="AUTOGENERATE,".concat(T)):"CHECK BOX"==(null===(h=D.cdatatype)||void 0===h?void 0:h.toUpperCase())?(w[e.applyFilterId]={pillText:_||(T?"Checked":"Unchecked"),isChecked:T},w[e.applyFilterId][b]="CHECKBOX,".concat(T)):"SHORT TEXT"==(null===(y=D.cdatatype)||void 0===y?void 0:y.toUpperCase())?(w[e.applyFilterId]={pillText:_||T,isChecked:!1},w[e.applyFilterId][b]="SHORT TEXT,".concat(T)):"LARGE TEXT"==(null===(v=D.cdatatype)||void 0===v?void 0:v.toUpperCase())&&(w[e.applyFilterId]={pillText:_||(T?T.substring(0,50)+"...":"No Text"),isChecked:!1},w[e.applyFilterId][b]="LARGE TEXT,".concat(T));entityFilters,entityFilters=JSON.stringify(w)}entityFilters&&(e.filterObj=JSON.parse(entityFilters),createPill(e.filterObj)),(null===(o=e.listJson)||void 0===o?void 0:o.length)>0?(t.addEventListener("scroll",function(){if(isScrollAtBottomWithinDiv(t)){var e=_entity.maxPageNumber+1;_entity.getEntityListData(e)}}),e.populateInitialView(),e.bindEvents(),e.initCharts(),parent.ShowDimmer(!1)):e.applyFilter&&document.querySelector(".".concat(e.applyFilterId))&&document.querySelector(".".concat(e.applyFilterId)).click()},function(e){showAlertDialog("error","Error occurred while fetching Entity data. Please check with administrator."),console.error(e)})}catch(n){showAlertDialog("error","Error occurred. Please check with administrator."),console.error(n)}}}},{key:"populateInitialView",value:function(){var e=document.getElementById("body_Container");e.removeEventListener("scroll",scrollListener),tableViewFlag?toggleView():(createListHTML(this.listJson,pageNo),e.addEventListener("scroll",scrollListener)),$('[data-toggle="tooltip"]').tooltip(),initReadMore()}},{key:"getEntityListData",value:function(e){var t=this,a={transId:t.entityTransId,fields:t.fields,pageNo:e,pageSize:t.pageSize,filter:t.filter};t.isLastPage?parent.ShowDimmer(!1):this.callAPI("../aspx/Entity.aspx/GetEntityListDataWS",a,!1,function(a){if(setTimeout(function(){filterModelClose()},1),a.success){var n,i,r;parent.ShowDimmer(!1);var o,l=JSON.parse(JSON.parse(a.response).d);l=null!==(n=null===(i=l.result.list)||void 0===i?void 0:null===(r=i[0])||void 0===r?void 0:r.data_json)&&void 0!==n?n:"[]";try{l.constructor!=Array&&(l=JSON.parse(l))}catch(c){return void showAlertDialog("error","Error occurred in data fetch.")}if(0===l.length)return void(1===e?(t.listJson=[],document.querySelector("#body_Container").innerHTML=t.emptyRowsHtml,document.querySelector("#table-body_Container").innerHTML=t.emptyRowsHtml):(t.isLastPage=!0,noMoreRecordsMessage.style.display="block",setTimeout(function(){noMoreRecordsMessage.style.display="none"},3e3)));1===e&&(t.listJson=[],document.querySelector("#body_Container").innerHTML="",document.querySelector("#table-body_Container").innerHTML=""),(o=t.listJson).push.apply(o,_toConsumableArray(l)),t.maxPageNumber=e,("table"===_entity.viewMode?createTableViewHTML:createListHTML)(t.listJson,e),$('[data-toggle="tooltip"]').tooltip(),initReadMore()}else parent.ShowDimmer(!1)})}},{key:"hideChartsMenu",value:function(){var e;null===(e=document.querySelector("#add_chart"))||void 0===e||e.click()}},{key:"openEntityForm",value:function(e,t,a,n,i){this.updateRelatedData(t,i);var r="../aspx/EntityForm.aspx?ename=".concat(e,"&tstid=").concat(t,"&recid=").concat(a,"&keyval=").concat(n);parent.LoadIframe(r)}},{key:"updateRelatedData",value:function(e,t){window.top.entityNavList||(window.top.entityNavList={}),window.top.entityNavList[e]=this.getNearestRecords(t),window.top.entityNavList.lastTransId=e,window.top.entityNavList.lastCaption="Other ".concat(this.entityName)}},{key:"getSelectedChartsCriteria",value:function(){var e=this,t=[];return e.selectedCharts.split("^").forEach(function(a){var n=a.split("~"),i=n[1],r=n[2];if(""!=i){var o=e.chartsMetaData.GroupFld[i];t.push("".concat(a,"~").concat(o.normalized,"~").concat(o.srctable||"","~").concat(o.srcfield||"","~").concat(o.allowempty,"~").concat(o.tablename,"~~"))}else{var l=e.chartsMetaData.AggFld[r];t.push("".concat(a,"~").concat(l.normalized,"~").concat(l.srctable||"","~").concat(l.srcfield||"","~").concat(l.allowempty,"~").concat(l.tablename,"~~"))}}),t.join("^")}},{key:"getChartCriteria",value:function(e){return e.split("~").slice(0,4).join("~")}},{key:"getEntityChartsData",value:function(e){var t=this,a="";a="General"==e?"":t.getSelectedChartsCriteria();var n={entityName:t.entityName,transId:t.entityTransId,condition:e,criteria:a};this.callAPI("../aspx/Entity.aspx/GetEntityChartsDataWS",n,!0,function(a){if(a.success){if("General"==e){t.kpiJson=JSON.parse(JSON.parse(a.response).d);var n=JSON.parse(t.kpiJson.result.charts[0].data_json)[0],i=t.generateGeneralKPIHTML(n);return void(document.querySelector("#KPI-2 .row").innerHTML=i)}document.querySelector("#Homepage_CardsList_Wrapper").innerHTML="",t.chartsJson=JSON.parse(JSON.parse(a.response).d);try{var r=[];t.chartsJson.result.charts.forEach(function(e){var a=JSON.parse(e.data_json),n=t.getChartCriteria(a[0].criteria),i=JSON.parse(e.data_json).map(function(e){return{data_label:e.keyname,value:e.keyvalue}});r.push({chartsid:n,charttype:"chart",chartjson:JSON.stringify(i),chartname:"".concat(t.selectedChartsObj[n])})}),t.chartsJson=r}catch(p){return void console.log("Error in charts"+p)}callParentNew("LoadIframe");var o={},l={},c="",s="",d={dirLeft:!0,enableMasonry:!1,homePageType:"cards",isCardsDashboard:!0,isMobile:isMobileDevice()},u={css:[],js:[]};u.js.push("/ThirdParty/lodash.min.js"),u.js.push("/ThirdParty/deepdash.min.js"),u.js.push("/Js/handlebars.min.js?v=1"),u.js.push("/Js/handleBarsHelpers.min.js"),u.js.push("/ThirdParty/Highcharts/highcharts.js"),u.js.push("/ThirdParty/Highcharts/highcharts-3d.js"),u.js.push("/ThirdParty/Highcharts/highcharts-more.js"),u.js.push("/ThirdParty/Highcharts/highcharts-exporting.js"),u.js.push("/Js/high-charts-functions.min.js?v=20"),u.js.push("/Js/AxInterface.js?v=10"),u.js.push("/ThirdParty/DataTables-1.10.13/media/js/jquery.dataTables.js"),u.js.push("/ThirdParty/DataTables-1.10.13/media/js/dataTables.bootstrap.js"),u.js.push("/ThirdParty/DataTables-1.10.13/extensions/Extras/moment.min.js"),u.css.push("/ThirdParty/fullcalendar/lib/main.min.css"),u.js.push("/ThirdParty/fullcalendar/lib/main.min.js"),d.isMobile&&u.js.push("/ThirdParty/jquery-ui-touch-punch-master/jquery.ui.touch-punch.min.js"),d.enableMasonry&&u.js.push("/ThirdParty/masonry/masonry.pkgd.min.js"),u.js.push("/js/entity-charts.min.js?v=1"),document.getElementsByTagName("body")[0].classList.contains("btextDir-rtl")&&(d.dirLeft=!1),loadAndCall({files:u,callBack:function(){$(function(){ShowDimmer(!0),deepdash(_);if(o.value=JSON.stringify(t.chartsJson),l.value=JSON.stringify([]),""!=(c="")){c=c.replace(/'/g,"'");var e=parseXml(c),a=xml2json(e,"");s=JSON.parse(a)}appGlobalVarsObject._CONSTANTS.menuConfiguration=$.extend(!0,{},appGlobalVarsObject._CONSTANTS.menuConfiguration,{menuJson:s}),appGlobalVarsObject._CONSTANTS.cardsPage={setCards:!1,cards:[]},$.axpertUI.options.cardsPage.cards=[],appGlobalVarsObject._CONSTANTS.cardsPage=$.extend(!0,{},appGlobalVarsObject._CONSTANTS.cardsPage,{setCards:!0,cards:(JSON.parse(""!==o.value?ReverseCheckSpecialChars(o.value):"[]",function(e,t){try{return"object"===_typeof(t)||isNaN(t)||""===t.toString().trim()?t:"string"==typeof t&&(t.startsWith("0")||t.startsWith("-"))?parseFloat(t,10):JSON.parse(t)}catch(a){return t}})||[]).map(function(e){return _.mapKeys(e,function(e,t){return t.toString().toLowerCase()})}),design:(JSON.parse(""!==l.value?l.value:"[]",function(e,t){try{return"object"===_typeof(t)||isNaN(t)||""===t.toString().trim()?t:"string"==typeof t&&(t.startsWith("0")||t.startsWith("-"))?parseFloat(t,10):JSON.parse(t)}catch(a){return t}})||[]).map(function(e){return _.mapKeys(e,function(e,t){return t.toString().toLowerCase()})}),enableMasonry:d.enableMasonry,staging:{iframes:".splitter-wrapper",cardsFrame:{div:".cardsPageWrapper",cardsDiv:"#Homepage_CardsList_Wrapper",cardsDesigner:".cardsDesigner",cardsDesignerToolbar:".designer",editSaveButton:".editSaveCardDesign",icon:"span.material-icons",divControl:"#arrangeCards"}}});appGlobalVarsObject.lcm;var n=$.axpertUI.init({isHybrid:appGlobalVarsObject._CONSTANTS.isHybrid,isMobile:d.isMobile,compressedMode:appGlobalVarsObject._CONSTANTS.compressedMode,dirLeft:d.dirLeft,axpertUserSettings:{settings:appGlobalVarsObject._CONSTANTS.axpertUserSettings},cardsPage:appGlobalVarsObject._CONSTANTS.cardsPage});appGlobalVarsObject._CONSTANTS.cardsPage=n.cardsPage,ShowDimmer(!1)}),$.axpertUI.cardsPage._addCardHeader=function(e,t){e.find(".card-title").attr("title",t.chartname||"").find("headerContent").replaceWith(t.chartname||""),e.find(".card-header").attr("data-bs-target","#".concat(t.chartsid.replaceAll("~",""))),e.find(".KC_Items_Content").attr("id","".concat(t.chartsid.replaceAll("~",""))),e.attr("title",t.chartname||"");var a='<span class="material-icons material-icons-style" onclick="_entity.deleteChart(\''.concat(t.chartsid,"')\">close</span>");e.find("toolbarContent").replaceWith(a)}}})}})}},{key:"getEntityChartsMetaData",value:function(){var e=this,t={entityName:e.entityName,transId:e.entityTransId};this.callAPI("../aspx/Entity.aspx/GetEntityChartsMetaDataWS",t,!0,function(t){if(t.success){JSON.parse(JSON.parse(t.response).d);e.createChartsFieldsForSelection(),e.getSelectedCharts()}})}},{key:"createChartsFieldsForSelection",value:function(){var e={GroupFld:{},AggFld:{}},t=document.querySelector("select#grpFld");this.metaData.filter(function(e){return"T"===e.grpfield&&"T"===e.listingfld}).forEach(function(a){var n=document.createElement("option");n.value=a.fldname,n.textContent="".concat(a.fldcap||"","(").concat(a.fldname,")"),t.appendChild(n),e.GroupFld[a.fldname]={cnd:a.cnd,fldcap:a.fldcap||"",fldname:a.fldname,normalized:a.normalized,allowempty:a.allowempty,srctable:a.srctable,srcfield:a.srcfield,tablename:a.tablename}});var a=document.querySelector("select#subEnt");if(a){var n=document.createElement("option");n.value=this.entityTransId,n.textContent="".concat(this.entityName,"(").concat(this.entityTransId,")"),a.appendChild(n)}var i=document.querySelector("select#aggFld");this.metaData.filter(function(e){return"T"===e.aggfield&&"T"===e.listingfld}).forEach(function(t){var a=document.createElement("option");a.value=t.fldname,a.textContent="".concat(t.fldcap||"","(").concat(t.fldname,")"),i.appendChild(a),e.AggFld[t.fldname]={cnd:t.cnd,fldcap:t.fldcap||"",fldname:t.fldname,normalized:t.normalized,allowempty:t.allowempty,srctable:t.srctable,srcfield:t.srcfield,tablename:t.tablename}}),document.getElementById("aggFld").addEventListener("change",function(){var e=document.getElementById("aggCond");"count"===this.value?(e.value=0,e.disabled=!0):(e.value="sum",e.disabled=!1)}),this.chartsMetaData=e}},{key:"getSelectedCharts",value:function(){var e=this,t={transId:e.entityTransId};this.callAPI("../aspx/Entity.aspx/GetSelectedEntityChartsWS",t,!0,function(t){t.success?(e.selectedCharts=JSON.parse(t.response).d,""!=e.selectedCharts?(e.getEntityChartsData("Custom"),e.getChartCaptions(),document.querySelector(".NO-KPI-Items").classList.add("d-none")):document.querySelector(".NO-KPI-Items").classList.remove("d-none"),ShowDimmer(!1)):ShowDimmer(!1)})}},{key:"setSelectedCharts",value:function(e){var t=this;if(e)if(t.selectedCharts){var a=t.selectedCharts.split("^");a.push(e),a=_toConsumableArray(new Set(a)),t.selectedCharts=a.join("^")}else this.selectedCharts=e;var n={transId:t.entityTransId,charts:t.selectedCharts};this.callAPI("../aspx/Entity.aspx/SetSelectedEntityChartsWS",n,!0,function(e){e.success?(t.getEntityChartsData("Custom"),t.getChartCaptions(),t.hideChartsMenu(),ShowDimmer(!1)):(t.hideChartsMenu(),ShowDimmer(!1))})}},{key:"clearChartSelection",value:function(){if(confirm("Clear all Charts?")){var e=this;e.selectedCharts="",e.selectedChartsObj={};var t={transId:e.entityTransId,charts:""};this.callAPI("../aspx/Entity.aspx/SetSelectedEntityChartsWS",t,!0,function(t){e.hideChartsMenu()}),document.querySelector("#Homepage_CardsList_Wrapper").innerHTML="",document.querySelector(".NO-KPI-Items").classList.remove("d-none")}}},{key:"applyChartSelection",value:function(){var e=document.getElementById("grpFld").value,t=(this.chartsMetaData.GroupFld[e],document.getElementById("aggCond").value),a=document.getElementById("aggFld").value;if("count"==a)t="count";else if(0==t)return showAlertDialog("error","Select a valid Display function"),void document.getElementById("aggCond").focus();0==e&&(e="");var n="".concat(this.entityTransId,"~").concat(e,"~").concat(a,"~").concat(t);this.setSelectedCharts(n),document.querySelector(".NO-KPI-Items").classList.add("d-none")}},{key:"getChartCaptions",value:function(){var e=this;e.selectedCharts.split("^").forEach(function(t){var a=t.split("~"),n=a[1],i=e.chartsMetaData.GroupFld[n],r=a[3],o=a[2],l=e.chartsMetaData.AggFld[o],c="";c="count"==r?"".concat(i.fldcap||""," wise ").concat(r):""!=n?"".concat(i.fldcap||""," wise ").concat(l.fldcap||"","(").concat(r,")"):"".concat(l.fldcap||"","(").concat(r,")"),e.selectedChartsObj[t]=c})}},{key:"setSelectedFields",value:function(){var e=this,t={transId:e.entityTransId,fields:e.fields,keyField:e.keyField};this.callAPI("../aspx/Entity.aspx/SetSelectedEntityFieldsWS",t,!0,function(t){t.success?(e.reloadEntityPage(),ShowDimmer(!1)):ShowDimmer(!1)})}},{key:"reloadPage",value:function(){window.location.reload()}},{key:"deleteChart",value:function(e){if(confirm("Delete this chart?")){var t=this;if(t.selectedCharts){var a=t.selectedCharts.split("^");a=a.filter(function(t){return t!==e}),t.selectedCharts=a.join("^")}else t.selectedCharts="";if(""==t.selectedCharts){t.selectedChartsObj={};var n={transId:t.entityTransId,charts:""};this.callAPI("../aspx/Entity.aspx/SetSelectedEntityChartsWS",n,!0,function(e){t.hideChartsMenu()}),document.querySelector("#Homepage_CardsList_Wrapper").innerHTML="",document.querySelector(".NO-KPI-Items").classList.remove("d-none")}else t.setSelectedCharts(),document.querySelector(".NO-KPI-Items").classList.add("d-none")}}},{key:"generateGeneralKPIHTML",value:function(e){var t="";return t+='\n            <div class="col-xl-12 col-lg-12 col-sm-12 Invoice-content-wrap">\n                <a href="#" class="Invoice-item">\n                    <div class="Invoice-icon">\n                        <span class="material-icons material-icons-style material-icons-2">bar_chart</span><i class="fas fa-signal"></i>\n                    </div>\n                    <div class="Invoice-content">\n                        <h6 class="subtitle">Total</h6>\n                        <h3 class="title">'.concat(e.totrec,'</h3>\n                    </div>\n                    <div class="Invoice-icon2"></div>\n                </a>\n            </div>\n        '),0!==e.cyear&&(t+='\n                <div class="col-xl-12 col-lg-12 col-sm-12 Invoice-content-wrap">\n                    <a href="#" class="Invoice-item">\n                        <div class="Invoice-icon">\n                            <span class="material-icons material-icons-style material-icons-2">bar_chart</span>\n                        </div>\n                        <div class="Invoice-content">\n                            <h6 class="subtitle">This year</h6>\n                            <h3 class="title">'.concat(e.cyear,'</h3>\n                        </div>\n                        <div class="Invoice-icon2"></div>\n                    </a>\n                </div>\n            ')),0!==e.cmonth&&(t+='\n                <div class="col-xl-12 col-lg-12 col-sm-12 Invoice-content-wrap">\n                    <a href="#" class="Invoice-item">\n                        <div class="Invoice-icon">\n                            <span class="material-icons material-icons-style material-icons-2">bar_chart</span>\n                        </div>\n                        <div class="Invoice-content">\n                            <h6 class="subtitle">This month</h6>\n                            <h3 class="title">'.concat(e.cmonth,'</h3>\n                        </div>\n                        <div class="Invoice-icon2"></div>\n                    </a>\n                </div>\n            ')),0!==e.cweek&&(t+='\n                <div class="col-xl-12 col-lg-12 col-sm-12 Invoice-content-wrap">\n                    <a href="#" class="Invoice-item">\n                        <div class="Invoice-icon">\n                            <span class="material-icons material-icons-style material-icons-2">bar_chart</span>\n                        </div>\n                        <div class="Invoice-content">\n                            <h6 class="subtitle">This week</h6>\n                            <h3 class="title">'.concat(e.cweek,'</h3>\n                        </div>\n                        <div class="Invoice-icon2"></div>\n                    </a>\n                </div>\n            ')),0!==e.cyesterday&&(t+='\n                <div class="col-xl-12 col-lg-12 col-sm-12 Invoice-content-wrap">\n                    <a href="#" class="Invoice-item">\n                        <div class="Invoice-icon">\n                            <span class="material-icons material-icons-style material-icons-2">bar_chart</span>\n                        </div>\n                        <div class="Invoice-content">\n                            <h6 class="subtitle">Yesterday</h6>\n                            <h3 class="title">'.concat(e.cyesterday,'</h3>\n                        </div>\n                        <div class="Invoice-icon2"></div>\n                    </a>\n                </div>\n            ')),0!==e.ctoday&&(t+='\n                <div class="col-xl-12 col-lg-12 col-sm-12 Invoice-content-wrap">\n                    <a href="#" class="Invoice-item">\n                        <div class="Invoice-icon">\n                            <span class="material-icons material-icons-style material-icons-2">bar_chart</span>\n                        </div>\n                        <div class="Invoice-content">\n                            <h6 class="subtitle">Today</h6>\n                            <h3 class="title">'.concat(e.ctoday,'</h3>\n                        </div>\n                        <div class="Invoice-icon2"></div>\n                    </a>\n                </div>\n            ')),t}},{key:"showTimeLine",value:function(e,t){(axTimeLineObj=new ProcessTimeLine).keyvalue=t,axTimeLineObj.processName=e,this.inValid(axTimeLineObj.keyvalue)||"NA"==axTimeLineObj.keyvalue||axTimeLineObj.getTimeLineData()}},{key:"initCharts",value:function(){this.getEntityChartsData("General"),this.createChartsFieldsForSelection(),this.getSelectedCharts()}},{key:"getUrlParams",value:function(){var e=window.location.search,t=new URLSearchParams(e);this.entityName=t.get("ename"),this.entityTransId=t.get("tstid"),"true"==t.get("applyfilter")&&t.get("filterval")&&t.get("filterfld")&&(this.applyFilter=!0,this.applyFilterStr=t.get("filterfld")+"^^^"+t.get("filterval"))}},{key:"bindEvents",value:function(){this.bindThemeEvent(),this.bindUtilityEvent()}},{key:"openNewTstruct",value:function(){parent.LoadIframe("../aspx/tstruct.aspx?transid=".concat(this.entityTransId))}},{key:"editEntity",value:function(e){parent.LoadIframe("../aspx/tstruct.aspx?transid=".concat(this.entityTransId,"&act=load&recordid=").concat(e))}},{key:"reloadEntityPage",value:function(){parent.LoadIframe("../aspx/Entity.aspx?ename=".concat(this.entityName,"&tstid=").concat(this.entityTransId))}},{key:"bindThemeEvent",value:function(){var e=this;document.querySelectorAll("#selectThemes .menu-link").forEach(function(t){t.addEventListener("click",function(a){a.preventDefault();var n=this.getAttribute("data-target");e.updateTheme(n),e.updateActiveClass(t),localStorage.setItem("selectedTheme-".concat(e.entityName),n)})})}},{key:"bindUtilityEvent",value:function(){var e=this;document.querySelectorAll("#selectUtilities .menu-link").forEach(function(t){t.addEventListener("click",function(t){t.preventDefault();var a=this.getAttribute("data-target");e.handleUtilityAction(a)})})}},{key:"handleUtilityAction",value:function(e){handleExport(e,"#table-body_Container .table")}},{key:"applyTheme",value:function(){var e=localStorage.getItem("selectedTheme-".concat(this.entityName));if(e){this.updateTheme(e);var t=document.querySelector('#selectThemes .menu-link[data-target="'.concat(e,'"]'));t&&this.updateActiveClass(t)}}},{key:"updateActiveClass",value:function(e){document.querySelectorAll("#selectThemes .menu-link").forEach(function(e){e.classList.remove("active")}),e.classList.add("active")}},{key:"updateTheme",value:function(e){var t=document.body;t.classList.remove("lightTheme","blackTheme","gradTheme","compactTheme"),"lightTheme"===e||"light"===e?t.classList.add("lightTheme"):"blackTheme"===e||"dark"===e?t.classList.add("blackTheme"):"gradTheme"===e||"gradient"===e||"system"===e?t.classList.add("gradTheme"):"compactTheme"!==e&&"pattern"!==e||t.classList.add("compactTheme")}},{key:"getNearestRecords",value:function(e){var t=this,a=t.listJson.filter(function(e){return!1===t.inValid(e[e.keycol])}),n=a.findIndex(function(t){return t.rno===e});if(-1===n)return[];var i=[];if(n>0){var r=_objectSpread(_objectSpread({},a[n-1]),{},{navtype:"prev"});i.push(r)}var o=_objectSpread(_objectSpread({},a[n]),{},{navtype:"current"});if(i.push(o),n<a.length-1){var l=_objectSpread(_objectSpread({},a[n+1]),{},{navtype:"next"});i.push(l)}return i}},{key:"setSelectedFilters",value:function(e){console.log("Received Filters:",e);var t,a=JSON.parse(e);for(var n in a)!1===a[n].isChecked&&delete a[n];e=JSON.stringify(a);var i={transId:this.entityTransId,filters:e};return this.callAPI("../aspx/Entity.aspx/SetSelectedEntityFiltersWS",i,!0,function(e){t=!!e.success}),t}},{key:"callAPI",value:function(e,t,a,n){var i=this,r=new XMLHttpRequest;r.open("POST",e,a),r.setRequestHeader("Content-Type","application/json;charset=UTF-8"),i.isAxpertFlutter&&(r.setRequestHeader("Authorization","Bearer ".concat(armToken)),t.armSessionId=armSessionId),r.onreadystatechange=function(){4==this.readyState&&(200==this.status?n({success:!0,response:this.responseText}):(i.catchError(this.responseText),n({success:!1,response:this.responseText})))},r.send(JSON.stringify(t))}},{key:"catchError",value:function(e){showAlertDialog("error",e)}},{key:"showSuccess",value:function(e){showAlertDialog("success",e)}},{key:"dataConvert",value:function(e,t){if("AXPERT"==t)try{if("undefined"!=typeof(e=JSON.parse(e.d)).result[0].result.row)return e.result[0].result.row;if("undefined"!=typeof e.result[0].result)return e.result[0].result}catch(a){ShowDimmer(!1),this.catchError(a.message)}else if("ARM"==t)try{if(this.isAxpertFlutter||(e=JSON.parse(e.d)),e.result&&e.result.success){if(!this.isUndefined(e.result.data))return e.result.data}else this.isUndefined(e.result.message)||this.catchError(e.result.message)}catch(a){ShowDimmer(!1),this.catchError(a.message)}return e}},{key:"generateFldId",value:function(){return"fid".concat(Date.now()).concat(Math.floor(9e4*Math.random())+1e4)}},{key:"isEmpty",value:function(e){return""==e}},{key:"isNull",value:function(e){return null==e}},{key:"isNullOrEmpty",value:function(e){return null==e||""==e}},{key:"inValid",value:function(e){return null==e||void 0===e||""==e}},{key:"isUndefined",value:function(e){return void 0===e}}]),e}(),Field=_createClass(function e(t){_classCallCheck(this,e),this.fldcap=t.fldcap||"",this.fldname=t.fldname,this.cdatatype=t.cdatatype,this.fdatatype=t.fdatatype,this.moe=t.moe,this.hide=t.hide,this.props=t.props}),EntityMetaData=_createClass(function t(e){if(_classCallCheck(this,t),!e||!Array.isArray(e))throw new Error("Invalid JSON data");this.metadata=e.map(function(e){return new Field(e)})});function createListHTML(e,t){var a=$("#body_Container");isCardView||a.html("");var n="",i=filterRowsByPage(e,t),r=[],o=[],l=[],c=[];$.each(_entity.metaData,function(e,t){if("T"===t.hide)return!0;var a=getFieldDataType(t).toUpperCase();"BUTTON"===a?c.push(t):"ATTACHMENTS"===a?o.push(t):"LARGE TEXT"===a?r.push(t):l.push(t)});var s,d=_entity.keyField,u=!1,p=_createForOfIteratorHelper(i);try{for(p.s();!(s=p.n()).done;){var m=s.value;if(m.hasOwnProperty(d)||(d=getKeyField(_entity.metaData.filter(function(e){return"T"===e.listingfld})).fldname),m.keycol=d,!_entity.inValid(m[d])&&"--"!=m[d]){if(u=!0,Object.entries(m).forEach(function(e){var t=_slicedToArray(e,2),a=t[0],n=t[1];_entity.inValid(_entity.fldData[a])&&(_entity.fldData[a]=[]),_entity.fldData[a].push(n||"")}),n+='<div class="Project_items" id="row_'.concat(m.recordid,'">\n                <div class="card">\n                    <div class="col-xl-12 col-md-12 d-flex flex-column flex-column-fluid">'),n+=' <div class="page-Header">\n                        <h3 class="card-title collapsible cursor-pointer rotate" data-bs-toggle="collapse"\n                            aria-expanded="true" data-bs-target="#Sub-Entity_wrapper" >\n                            <input class="Select-Project" type="checkbox" id="checkbox_'.concat(m.recordid,'" data-recordid="').concat(m.recordid,'" value="">\n                            <span class="Project_title" onclick="_entity.openEntityForm(\'').concat(_entity.entityName,"', '").concat(m.transid,"', '").concat(m.recordid,"', '").concat(m[d],"', ").concat(m.rno,')">').concat(m[d],'</span>\n                            <input type="hidden" class="transid" id="transid_').concat(m.recordid,'" value="').concat(m.transid,'"/>\n                            <input type="hidden" class="recid" id="recid_').concat(m.recordid,'" value="').concat(m.recordid,'"/>\n                            <div class="Project_updates">\n                            </div>\n                        </h3>\n                        <div id="" class="card-toolbar">\n                            <div class="d-flex">\n                                <div class="edit-container">\n                                    <button type="button" id=""\n                                        class="btn btn-icon btn-white btn-color-gray-600 btn-active-primary shadow-sm tb-btn btn-sm me-3"\n                                        data-bs-toggle="tooltip" title="Edit" data-bs-original-title="Edit"\n                                        onclick="_entity.editEntity(\'').concat(m.recordid,'\')">\n                                        <span class="material-icons material-icons-style material-icons-2" style="color: red;">\n                                            edit_note\n                                        </span>\n                                    </button>\n                                </div>\n                                <button type="submit" id=""\n                                    class="btn btn-icon btn-white btn-color-gray-600 btn-active-primary shadow-sm tb-btn btn-sm me-3 d-none"\n                                    data-bs-toggle="tooltip" title="" data-bs-original-title="Options">\n                                    <span class="material-icons material-icons-style material-icons-2" style="color: #47BE7D;">\n                                        more_vert\n                                    </span>\n                                </button>\n                            </div>\n                        </div>\n                    </div>'),!_entity.inValid(m.modifiedby)&&!_entity.inValid(m.modifiedon)){var f=moment(m.modifiedon).format("DD/MM/YYYY"),h=moment(m.modifiedon).format("HH:mm:ss"),y=moment(m.modifiedon).fromNow();n+='<div class="workflow-row">\n        <div class="workflow-items">\n            <div class="symbol symbol-25px symbol-circle initialized" data-bs-toggle="tooltip" title="" data-bs-original-title="'.concat(m.modifiedby,'">\n                <span class="symbol-label bg-warning text-inverse-warning fw-bold">').concat(m.modifiedby[0],'</span>\n            </div>\n            <span data-toggle="tooltip" title="Modified by: ').concat(m.modifiedby,'" class="Project_updates-value">').concat(m.modifiedby.split("@")[0],'</span>\n            <span class="Project_updates-value" data-toggle="tooltip" data-placement="top" title="Modified on: ').concat(f," ").concat(h,'" data-name="').concat(f," ").concat(h,'">last modified ').concat(y,"</span>\n        </div>\n    </div>")}m.axpeg_status&&""!=m.axpeg_status.toString()&&"0"!=m.axpeg_status.toString()&&(n+='<span class="material-icons material-icons-style material-icons-2">people</span>'.concat(m.axpeg_status,'\n                    <button id="pd_timeline" class="btn btn-icon btn-white btn-color-gray-600 btn-active-primary shadow-sm tb-btn btn-sm entity-timelines" data-kt-menu-trigger="click" data-kt-menu-placement="bottom-end" data-kt-menu-flip="top-end" data-kt-menu-attach="parent" title="Timeline">\n                        <span class="material-icons material-icons-style material-icons-2">history</span>\n                    </button>\n\n                    <div class="menu menu-sub menu-sub-dropdown menu-column menu-rounded menu-gray-600 menu-state-bg-light fw-bolder w-400px py-3" data-kt-menu="true" data-id="pd_timeline" data-processname="').concat(m.axpeg_processname,'" data-keyvalue="').concat(m.axpeg_keyvalue,'">\n                    </div>')),n+=generateRowElements(l,r,o,m),n+=generateRowButtonHTML(c,m),n+="</div></div></div>"}}}catch(v){p.e(v)}finally{p.f()}i.length&&!u?a.append(this.nullRowsHtml):""!==n?(a.append(n),initReadMore(),KTMenu.init(),document.querySelectorAll(".entity-timelines").forEach(function(e){KTMenu.getInstance(e).on("kt.menu.dropdown.show",function(e){var t=KTMenu.getInstance(e).element;t.innerHTML='<div id="TimeLine_overall" class="content">\n                    <div class="card" id="Timeline-wrap">\n                        <h1 class="Timeline-heading">Timeline</h1>\n                        <ul class="Timel-sessions full-session d-none"></ul>\n                        <span id="nodata" class="p-5">No Timeline data available.</span>\n                    </div>\n                </div>';var a=t.dataset;_entity.showTimeLine(a.processname,a.keyvalue)}),KTMenu.getInstance(e).on("kt.menu.dropdown.hide",function(e){KTMenu.getInstance(e).element.innerHTML=""})})):a.append(this.emptyRowsHtml)}function generateRowElements(e,t,a,n){var i,r='<div class="Data-fields-row">',o=_createForOfIteratorHelper(e);try{for(o.s();!(i=o.n()).done;){var l=i.value;l.fldname!=n.keycol&&(r+=generateHTMLBasedOnDataType(l,n))}}catch(m){o.e(m)}finally{o.f()}var c,s=_createForOfIteratorHelper(t);try{for(s.s();!(c=s.n()).done;){var d=c.value;d.fldname!=n.keycol&&(r+=generateHTMLBasedOnDataType(d,n))}}catch(m){s.e(m)}finally{s.f()}var u,p=_createForOfIteratorHelper(a);try{for(p.s();!(u=p.n()).done;){r+=generateHTMLBasedOnDataType(u.value,n)}}catch(m){p.e(m)}finally{p.f()}return r+="</div>"}function generateRowButtonHTML(e,t){var a,n='<div class="Action-Btns-row ">\n                                            <div class="d-flex align-items-center ">\n                                                <a href="javascript:void(0)" title="Approve"\n                                                   onclick="axTasksObj.doApprove(\'1409660000003\', this);"\n                                                   class="btn btn-white btn-sm btn-color-gray-700 btn-active-primary d-inline-flex align-items-center  btn-sm  me-2  ">\n                                                    <span class="material-icons material-icons-style material-icons-2"\n                                                          style="color: #47BE7D;">visibility</span>View form\n                                                </a>\n                                                <a href="javascript:void(0)" title="Reject"\n                                                   class="btn btn-white btn-color-gray-700 btn-active-primary d-inline-flex align-items-center  me-2  btn-sm"\n                                                   onclick="axTasksObj.doReject(\'1409660000003\', this)">\n                                                    <span class="material-icons material-icons-style material-icons-2"\n                                                          style="color: red;">edit_note</span>Edit Form\n                                                </a>',i=_createForOfIteratorHelper(e);try{for(i.s();!(a=i.n()).done;){n+=generateHTMLBasedOnDataType(a.value,t)}}catch(r){i.e(r)}finally{i.f()}return n+=" </div>\n                                        </div>"}var dateFormat="DD/MM/YYYY",axTimeLineObj;function formatDate(e,t){var a=(e=e.split("T")[0]).split("-"),n=a[0],i=a[1],r=a[2];return"DD/MM/YYYY"===t?"".concat(r,"/").concat(i,"/").concat(n):"MM/DD/YYYY"===t?"".concat(i,"/").concat(r,"/").concat(n):e}function generateHTMLBasedOnDataType(e,t){var a=e.fldname,n=getFieldDataType(e),i=e.fldcap||"",r=e.props,o=t[a];if("modifiedon"===a.toLowerCase()||"modifiedby"===a.toLowerCase())return"";if(_entity.inValid(o)&&"BUTTON"!=n.toUpperCase())return"";var l="";switch(n.toUpperCase()){case"LARGE TEXT":l='<div class="Data-fields-items Department-field" data-toggle="tooltip" data-placement="top" title="'.concat(i,'" data-name="').concat(i.toLowerCase().replaceAll("*","").replaceAll(" ",""),'">\n                        <p class="task-description moretext" style="margin-bottom:0px !important;">').concat(o,'</p>\n                        <a class="moreless-button" href="#">Read more</a>\n                    </div>');break;case"SHORT TEXT":l='<div class="Data-fields-items Department-field" data-toggle="tooltip" data-placement="top" title="'.concat(i,'" data-name="').concat(i.toLowerCase().replaceAll("*","").replaceAll(" ",""),'">\n                        <span class="material-icons material-icons-style material-icons-2">description</span><span class="txt-bold Data-field-value">').concat(o,"</span>\n                    </div>");break;case"CURRENCY":l='<div class="Data-fields-items Department-field" data-toggle="tooltip" data-placement="top" title="'.concat(i,'" data-name="').concat(i.toLowerCase().replaceAll("*","").replaceAll(" ",""),'">\n                        <span class="material-icons material-icons-style material-icons-2">payments</span><span class="txt-bold Data-field-value">').concat(o,"</span>\n                    </div>");break;case"DATE":var c=formatDate(o.replace("T00:00:00",""),dateFormat);l='<div class="Data-fields-items Date-field" data-toggle="tooltip" data-placement="top" title="'.concat(i,'" data-name="').concat(i.toLowerCase().replaceAll("*","").replaceAll(" ",""),'">\n                            <span class="material-icons material-icons-style material-icons-2">today</span><span class="txt-bold Data-field-value">').concat(c,"</span>\n                        </div>");break;case"TIME":l='<div class="Data-fields-items Time-field" data-toggle="tooltip" data-placement="top" title="'.concat(i,'" data-name="').concat(i.toLowerCase().replaceAll("*","").replaceAll(" ",""),'">\n                        <span class="material-icons material-icons-style material-icons-2">schedule</span><span class="txt-bold Data-field-value">').concat(o,"</span>\n                    </div>");break;case"LINK":l='<div class="Data-fields-items link-field" data-toggle="tooltip" data-placement="top" title="'.concat(i,'" data-name="').concat(i.toLowerCase().replaceAll("*","").replaceAll(" ",""),'">\n                        <span class="material-icons material-icons-style material-icons-2">link</span><span class="txt-bold Data-field-value">').concat(o,"</span>\n                    </div>");break;case"MOBILE":case"PHONE":l='<div class="Data-fields-items Email-field" data-toggle="tooltip" data-placement="top" title="'.concat(i,'" data-name="').concat(i.toLowerCase().replaceAll("*","").replaceAll(" ",""),'">\n                        <span class="material-icons material-icons-style material-icons-2">phone</span><span class="txt-bold Data-field-value">').concat(o,"</span>\n                    </div>");break;case"PINCODE":case"ZIPCODE":l='<div class="Data-fields-items Email-field" data-toggle="tooltip" data-placement="top" title="'.concat(i,'" data-name="').concat(i.toLowerCase().replaceAll("*","").replaceAll(" ",""),'">\n                        <span class="material-icons material-icons-style material-icons-2">location_on</span><span class="txt-bold Data-field-value">').concat(o,"</span>\n                    </div>");break;case"EMAIL":l='<div class="Data-fields-items Email-field truncate" data-toggle="tooltip" data-placement="top" title="'.concat(i,'" data-name="').concat(i.toLowerCase().replaceAll("*","").replaceAll(" ",""),'">\n                        <span class="material-icons material-icons-style material-icons-2">mail</span><span class="txt-bold Data-field-value" data-text="').concat(o,'" onclick="showPopup(this)">').concat(o,"</span>\n                    </div>");break;case"BOOL":l="T"===o||"F"===o?'<div class="Data-fields-items Email-field" data-toggle="tooltip" data-placement="top" title="'.concat(i,'" data-name="').concat(i.toLowerCase().replaceAll("*","").replaceAll(" ",""),'">\n                                <div class="form-check form-switch">\n                                    <input class="form-check-input" type="checkbox" role="switch" ').concat("T"===o?"checked":"",' readonly>\n                                    <span class="txt-bold Data-field-value">').concat(i,"</span>\n                                </div>\n                            </div>"):'<div class="Data-fields-items Department-field" data-toggle="tooltip" data-placement="top" title="'.concat(i,'" data-name="').concat(i.toLowerCase().replaceAll("*","").replaceAll(" ",""),'">\n                                <span class="txt-bold Data-field-value">').concat(o,"</span>\n                            </div>");break;case"BUTTON":var s=r.split("|")[0].split("~")[1];l='<a href="javascript:void(0)" title="View form"\n                       class="btn btn-white btn-color-gray-700 btn-active-primary d-inline-flex align-items-center  btn-sm  me-2 ">\n                        <span class="material-icons material-icons-style material-icons-2" style="color: darkmagenta;">'.concat(s,"</span>").concat(i,"\n                    </a>");break;case"ATTACHMENTS":if((null==o?void 0:o.length)>0){var d,u=parseFilePath(o);if((null===(d=u.filename)||void 0===d?void 0:d.length)>0){var p=getIconClass(getFileType(o));l='<div class="Files-Attached" data-toggle="tooltip" data-placement="top" title="'.concat(u.filename,".").concat(u.ext,'">\n                                ').concat(p,'\n                                <div class="ms-1 fw-semibold">\n                                    <a class="attached-filename" onclick="downloadFileFromPath(\'').concat(u.folder.replaceAll("\\","\\\\"),"','").concat(u.filename,".").concat(u.ext,"')\">").concat(u.filename,"</a>\n                                </div>\n                            </div>")}}break;default:l="T"===o||"F"===o?'<div class="Data-fields-items Department-field" data-toggle="tooltip" data-placement="top" title="'.concat(i,'" data-name="').concat(i.toLowerCase().replaceAll("*","").replaceAll(" ",""),'">\n                                <div class="d-flex align-items-center">\n                                    \n                                    <div class="form-check ms-1">\n                                        <input class="form-check-input" type="checkbox" ').concat("T"===o?"checked":""," readonly disabled>\n                                    </div>\n                                </div>\n                            </div>"):'<div class="Data-fields-items Department-field" data-toggle="tooltip" data-placement="top" title="'.concat(i,'" data-name="').concat(i.toLowerCase().replaceAll("*","").replaceAll(" ",""),'">\n                                <span class="txt-bold Data-field-value">').concat(o,"</span>\n                            </div>")}return l}function parseFilePath(e){var t=/^(.*[\\\/])([^\\\/]+)\.(\w+)$/.exec(e),a={folder:"",ext:"",filename:""};return t?(a.folder=t[1],a.filename=t[2],a.ext=t[3]):a.folder=e,a}function downloadFileFromPath(e,t){$.ajax({type:"POST",url:top.window.location.href.toLowerCase().substring(0,top.window.location.href.indexOf("/aspx/"))+"/customwebservice.asmx/GetAttachments",cache:!1,async:!1,contentType:"application/json;charset=utf-8",data:JSON.stringify({filePath:e,fileName:t}),dataType:"json",success:function(e){if("File not exists"!==e.d){var a=e.d.split(".").pop().toLowerCase();downloadAttachment(e.d,t,a)}else parent.showAlertDialog("error",e.d)},error:function(e){parent.showAlertDialog("error",e.d)}})}function isScrollAtBottomWithinDiv(e){return e.scrollHeight-(e.scrollTop+e.clientHeight)<=1}function isScrollAtTopWithinDiv(e){return e.scrollTop<=1}function filterRowsByPage(e,t){return e.filter(function(e){return e.pageno===t})}function getMaxPageNumber(e){var t=-Infinity;return e.forEach(function(e){e.pageno>t&&(t=e.pageno)}),t}function initReadMore(){document.querySelectorAll(".moretext").forEach(function(e,t){var a=e.clientHeight,n=e.nextElementSibling;e.scrollHeight>e.clientHeight?(n.style.display="inline-block",e.style.maxHeight=a+"px"):n.style.display="none",n.addEventListener("click",function(){var t=window.getComputedStyle(e);"none"===t.maxHeight||t.maxHeight===a+"px"?(e.style.maxHeight=e.scrollHeight+"px",n.textContent="Read less"):(e.style.maxHeight=a+"px",n.textContent="Read more")})})}function getFilesHtml(e){var t="",a=e.axpfile_file.split(",");return $.each(a,function(a,n){var i=getFileType(n),r=getIconClass(i),o=e.axpfilepath_file+n;o=o.replace(/\\/g,"\\\\"),""!=n&&(t+='<div class="Files-Attached ">\n\t\t\t\t\t\t   \x3c!--begin::Icon--\x3e\t\n\t\t\t\t\t\t   '.concat(r,'\t\t\t\t\t\t   \n\t\t\t\t\t\t   \x3c!--end::Icon--\x3e                     \n\t\t\t\t\t\t   \x3c!--begin::Info--\x3e\n\t\t\t\t\t\t   <div class="ms-1 fw-semibold">\n\t\t\t\t\t\t\t  \x3c!--begin::Desc--\x3e\t\t\t\t\t\t\t  \n\t\t\t\t\t\t\t  <a class="attached-filename" onclick="downloadFileFromPath(\'').concat(o,"','").concat(n,"')\">").concat(n,'</a>\n\t\t\t\t\t\t\t  \x3c!--end::Desc--\x3e                     \n\t\t\t\t\t\t\t  \x3c!--begin::Number--\x3e\n\t\t\t\t\t\t\t  <div class="attached-filedetails">\n\t\t\t\t\t\t\t\t <span class="doctype">').concat(i,'</span>\n\t\t\t\t\t\t\t\t \x3c!--<span class="docsize">1.9mb</span>--\x3e\n\t\t\t\t\t\t\t  </div>\n\t\t\t\t\t\t\t  \x3c!--end::Number--\x3e\n\t\t\t\t\t\t   </div>\n\t\t\t\t\t\t   <a class="attached-filename" onclick="downloadFileFromPath(\'').concat(o,"','").concat(n,'\')">\n\t\t\t\t\t\t\t   <span\n\t\t\t\t\t\t\t\t  class="material-icons material-icons-style material-icons-2 text-danger">cloud_download</span>\n\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t   \x3c!--begin::Info--\x3e\n\t\t\t\t\t\t</div>'))}),t}function getIconClass(e){switch(e){case"pdf":return'<img src="../images/pdf.svg" class="file-img" />';case"jpeg":case"jpg":case"png":return'<img src="../images/images.svg" class="file-img" />';case"doc":case"docx":return'<img src="../images/word.svg" class="file-img" />';case"txt":return'<i style="margin:0px !important; font-size: 40px !important; " class="material-icons">description</i>';case"xls":case"xlsx":return'<img src="../images/xl.svg" class="file-img"/>';case"ppt":case"pptx":return'<img src="../images/ppt.svg" class="file-img"/>';case"zip":return'<i style="margin:0px !important; font-size: 40px !important; " class="material-icons">archive</i>';case"mp3":return'<i style="margin:0px !important; font-size: 40px !important; " class="material-icons">audiotrack</i>';case"mp4":return'<i style="margin:0px !important; font-size: 40px !important; " class="material-icons">videocam</i>';default:return'<i style="margin:0px !important; font-size: 40px !important; " class="material-icons">insert_drive_file</i>'}}function getFileType(e){var t=e.split(".");return t[t.length-1].toLowerCase()}function scrollToTopOfDiv(e){e.scrollTop=0}$(document).ready(function(){_entityCommon=new EntityCommon,(_entity=new Entity).init()});var ProcessTimeLine=function(){function e(){_classCallCheck(this,e),this.keyvalue="",this.processName="",this.make='<li class="make">                                   \n                    <p class="T-Desc">{{taskname}}#{{keyvalue}}</p>\n \t\t    <p class="T-Heading">{{taskfromuser}}</p>\n \t\t    <div class="time">{{tasktime}}</div>\n                </li>',this.check='<li class="check">\n                    <p class="T-Desc">{{taskname}}#{{keyvalue}} - {{taskstatus}}</p>\n                    <p class="T-Heading">{{taskfromuser}}</p>                    \n\t\t    <div class="time">{{tasktime}}</div>\n                </li>',this.approve='<li class="approve">\n                   <p class="T-Desc">{{taskname}}#{{keyvalue}} - {{taskstatus}}</p>\n                    <p class="T-Heading">{{taskfromuser}}</p>                    \n\t\t    <div class="time">{{tasktime}}</div>\n                </li>'}return _createClass(e,[{key:"getTimeLineData",value:function(){ShowDimmer(!0);var e=this,t={keyValue:e.keyvalue,processName:e.processName};this.callAPI("../aspx/AxPEG.aspx/AxGetTimelineData",t,!1,function(t){if(t.success){var a=JSON.parse(t.response),n=e.dataConvert(a,"ARM");e.constructTimeline(n),ShowDimmer(!1)}else ShowDimmer(!1)})}},{key:"constructTimeline",value:function(e){var t=this;if(this.isUndefined(e)||0==e.length)document.querySelector(".Timel-sessions").classList.add("d-none"),document.querySelector("#nodata").classList.remove("d-none");else{document.querySelector("#nodata").classList.add("d-none"),document.querySelector(".Timel-sessions").classList.remove("d-none");var a="";document.querySelector(".Timel-sessions").innerHTML="",e.forEach(function(e){a+=Handlebars.compile(t[e.tasktype.toLowerCase()])(e)}),document.querySelector(".Timel-sessions").insertAdjacentHTML("beforeend",a)}}},{key:"callAPI",value:function(e,t,a,n){var i=this,r=new XMLHttpRequest;r.open("POST",e,a),r.setRequestHeader("Content-Type","application/json;charset=UTF-8"),i.isAxpertFlutter&&(r.setRequestHeader("Authorization","Bearer ".concat(armToken)),t.armSessionId=armSessionId),r.onreadystatechange=function(){4==this.readyState&&(200==this.status?n({success:!0,response:this.responseText}):(i.catchError(this.responseText),n({success:!1,response:this.responseText})))},r.send(JSON.stringify(t))}},{key:"catchError",value:function(e){showAlertDialog("error",e)}},{key:"showSuccess",value:function(e){showAlertDialog("success",e)}},{key:"dataConvert",value:function(e,t){if("AXPERT"==t)try{if("undefined"!=typeof(e=JSON.parse(e.d)).result[0].result.row)return e.result[0].result.row;if("undefined"!=typeof e.result[0].result)return e.result[0].result}catch(a){this.catchError(a.message)}else if("ARM"==t)try{if(this.isAxpertFlutter||(e=JSON.parse(e.d)),e.result&&e.result.success){if(!this.isUndefined(e.result.data))return e.result.data}else this.isUndefined(e.result.message)||this.catchError(e.result.message)}catch(a){this.catchError(a.message)}return e}},{key:"generateFldId",value:function(){return"fid".concat(Date.now()).concat(Math.floor(9e4*Math.random())+1e4)}},{key:"isEmpty",value:function(e){return""==e}},{key:"isNull",value:function(e){return null==e}},{key:"isNullOrEmpty",value:function(e){return null==e||""==e}},{key:"isUndefined",value:function(e){return void 0===e}},{key:"inValid",value:function(e){return null==e||void 0===e||""==e}}]),e}();function showPopup(e){var t=e.getAttribute("data-text");document.getElementById("popupText").textContent=t,$("#myModal").modal("show")}function openFilters(){$("#filterModal").modal("show"),document.getElementById("filterGroupName").disabled=!0,""===$("#dvModalFilter").html()&&createFilterLayout()}function updateFilterLayout(e,t){filterChanged=!0,$("#dvModalFilter").children().each(function(){for(var t=$(this).attr("data-type"),a=$(this).find("div select"),n=a.attr("id"),i=a.attr("data-field"),r=$(this).find("div input"),o=r.attr("id"),l=0,c=Object.entries(e);l<c.length;l++){var s=_slicedToArray(c[l],2),d=s[0],u=s[1];if(n===d||i===d||o===d){var p=u.split(",")[1],m=$("#".concat(n));switch(t){case"DropDown":if(m.prop("multiple")){var f=p.split(";");m.val(f).trigger("change")}else m.val(p).trigger("change");break;case"Simple Text":r.val(p);break;case"Date":if("modifiedon_dateoption"===n){var h=$("#modifiedon_from"),y=$("#modifiedon_to"),v=getDatesBasedonSelection(p);h.val(v.from),y.val(v.to),m.val(p).trigger("change"),"customOption"===p?(h.prop("disabled",!1).addClass("disabledDate"),y.prop("disabled",!1).addClass("disabledDate")):(h.prop("disabled",!0).removeClass("disabledDate"),y.prop("disabled",!0).removeClass("disabledDate"))}break;case"Numeric":case"Auto Generate":r.val(p)}break}}}),e.pillText&&$("#filterGroupName").val(e.pillText)}function getCurrentTimestamp(){return"Filter-"+(new Date).toISOString().replace(/[-:TZ.]/g,"")}function handleApply(){var e=getCurrentTimestamp(),t="",a=!1;$("#filterGroupCheckbox").is(":checked")?(a=!0,$("#filterGroupModalWrapper").modal("show"),(t=$("#filterGroupName").val())?applyFilters(t,e,a):handleApply()):(a=!1,$("#filterGroupModalWrapper").modal("hide"),applyFilters(t=readFilterInput(),e,a))}function readFilterInput(){var e="",t="en-us"==dtCulture?"MM/DD/YYYY":"DD/MM/YYYY";return document.querySelectorAll("#dvModalFilter .filter-fld").forEach(function(a){var n=a.value,i=a.dataset.type;if(_entity.inValid(i))return"Invalid Input";switch(i=i.toUpperCase()){case"DROPDOWN":if(_entity.inValid(n)||0==n)return;n=$(a).val().join(","),e=e+","+n;break;case"DATE":var r=a.querySelectorAll("input"),o=r[0],l=r[1];if("customOption"===$("#".concat(a.id,"_dateoption")).val()){if(""==o.value&&""==l.value)return;""!=o.value&&""==l.value?(n=moment(o.value,t).format("DD-MMM-YYYY"),e=e+",FROM:"+n):""!=l.value&&""==o.value?(n=moment(l.value,t).format("DD-MMM-YYYY"),e=e+",TO:"+n):(n=moment(o.value,t).format("DD-MMM-YYYY")+"~~"+moment(l.value,t).format("DD-MMM-YYYY"),e=e+","+n)}else e=e+","+$("#".concat(a.id,"_dateoption option:selected")).text();break;case"NUMERIC":var c=a.querySelectorAll("input"),s=c[0],d=c[1];if(""==s.value&&""==d.value)return;""!=s.value&&""==d.value?(n=s.value,e=e+",FROM:"+n):""!=d.value&&""==s.value?(n=d.value,e=e+", TO:"+n):(n=s.value+" - "+d.value,e=e+", Custom Range: "+n);break;default:if(_entity.inValid(n))return;var u=document.querySelector("#".concat(a.id,"_searchoption")).value||"CONTAINS";e=e+","+u+" : "+n}}),e=e.replace(/(^,)|(,$)/g,"")}function createPill(e){for(var t in console.log("appliedFilterObj: ",e),0===Object.keys(e).length?$(".secondary_card_header").css("display","none"):$(".secondary_card_header").css("display","flex"),isEditMode&&removePill(isEditMode,!1),e)if(!$(".secondary_card_header .".concat(t)).length){var a='<div class="'.concat(t,' filterGroupBadge badge rounded-pill bg-primary d-flex align-items-center gap-2 py-2 px-6" role="button" style="max-width: fit-content;" data-toggle="tooltip" data-placement="top" data-html="true" onclick="handlePillClick(\'').concat(t,"')\">\n                ").concat(e[t].pillText," \n                <span title='edit' class=\"pillEditButton material-icons btn btn-primary px-2 py-1\" onclick=\"editPill('").concat(t,'\'); event.stopPropagation();">edit</span> \n                <span title="remove" class="pillRemoveButton material-icons btn btn-primary px-2 py-1" onclick="removePill(\'').concat(t,"'); event.stopPropagation();\" >close</span> \n                </div>");$(".secondary_card_header").append(a)}isEditMode=""}function editPill(e){_entity.filterObj[e]&&_entity.filterObj[e].pillText&&(document.getElementById("filterGroupName").value=_entity.filterObj[e].pillText),isEditMode=e,$("#filterModal").modal("show"),document.getElementById("filterGroupName").disabled=!0,""===$("#dvModalFilter").html()&&createFilterLayout(),_entity.filterObj[e]&&updateFilterLayout(_entity.filterObj[e])}function removePill(e){var t=!(arguments.length>1&&arguments[1]!==undefined)||arguments[1];$("div.".concat(e)).remove(),delete _entity.filterObj[e],_entity.setSelectedFilters(JSON.stringify(_entity.filterObj)),t&&$(".secondary_card_header .filterGroupBadge").length<2&&($(".secondary_card_header").css("display","none"),resetFilters()),$(".secondary_card_header .".concat(e)).remove(),removedKeys.add(e),console.log("Updated global entityfilters: ",_entity.filterObj)}function handlePillClick(e){console.log("Key of Pill clicked: ",e),console.log("Object matching key from global _entity.filterObj: ",_entity.filterObj["".concat(e)]),$(".".concat(e)).click(function(){$(".selected").removeClass("selected"),$(this).addClass("selected")});var t=[],a=[],n="en-us"==dtCulture?"MM/DD/YYYY":"DD/MM/YYYY";Object.keys(_entity.filterObj["".concat(e)]).slice(2).forEach(function(i){console.log("Selected Pill Data: ",_entity.filterObj["".concat(e)]["".concat(i)]);var r=_entity.filterObj["".concat(e)]["".concat(i)].split(",");console.log("objProp: ",r);var o=r[0],l="",c=_entity.metaData.find(function(e){return e.fldname===i});switch(o){case"DROPDOWN":l=r.slice(1).join(","),console.log("Dropdown Data: ",l),t.push("".concat(i,"~").concat(c.normalized,"~").concat(c.srctable||"","~").concat(c.srcfield||"","~").concat(c.fdatatype||"","~").concat(c.listingfld||"","~").concat(c.tablename||"")),a.push(generateFilterString(o,l.toLowerCase()));break;case"DATE":if(t.push("".concat(i,"~").concat(c.normalized,"~").concat(c.srctable||"","~").concat(c.srcfield||"","~").concat(c.fdatatype||"","~").concat(c.listingfld||"","~").concat(c.tablename||"")),-1!==jQuery.inArray("customOption",r)){if(console.log("It is customOption!"),-1===jQuery.inArray("FROMDATE",r)&&-1===jQuery.inArray("TODATE",r))return;-1!==jQuery.inArray("FROMDATE",r)&&-1===jQuery.inArray("TODATE",r)?(l=moment(r[3],n).format("DD-MMM-YYYY"),a.push(generateFilterString(o,l,"FROMDATE")),console.log("Filter string on pill click: ",generateFilterString(o,l,"FROMDATE"))):-1===jQuery.inArray("FROMDATE",r)&&-1!==jQuery.inArray("TODATE",r)?(l=moment(r[3],n).format("DD-MMM-YYYY"),a.push(generateFilterString(o,l,"TODATE")),console.log("Filter string on pill click: ",generateFilterString(o,l,"TODATE"))):(l=moment(r[3],n).format("DD-MMM-YYYY")+"~~"+moment(r[5],n).format("DD-MMM-YYYY"),a.push(generateFilterString(o,l)),console.log("Filter string on pill click: ",generateFilterString(o,l)))}else{console.log("It is not customOption: ",r[1]);var s=getDatesBasedonSelection(r[1]);if(console.log("From date: ",s.from," To date: ",s.to),""===s.from&&""===s.to)return;""!==s.from&&""===s.to?(l=moment(s.from,n).format("DD-MMM-YYYY"),a.push(generateFilterString(o,l,"FROMDATE")),console.log("Filter string on pill click: ",generateFilterString(o,l,"FROMDATE"))):""===s.from&&""!==s.to?(l=moment(s.to,n).format("DD-MMM-YYYY"),a.push(generateFilterString(o,l,"TODATE")),console.log("Filter string on pill click: ",generateFilterString(o,l,"TODATE"))):(l=moment(s.from,n).format("DD-MMM-YYYY")+"~~"+moment(s.to,n).format("DD-MMM-YYYY"),a.push(generateFilterString(o,l)),console.log("Filter string on pill click: ",generateFilterString(o,l)))}break;case"NUMERIC":t.push("".concat(i,"~").concat(c.normalized,"~").concat(c.srctable||"","~").concat(c.srcfield||"","~").concat(c.fdatatype||"","~").concat(c.listingfld||"","~").concat(c.tablename||"")),-1!==jQuery.inArray("FROM",r)&&-1===jQuery.inArray("TO",r)?(l=r[2],a.push(generateFilterString(o,l,"FROM"))):-1===jQuery.inArray("FROM",r)&&-1!==jQuery.inArray("TO",r)?(l=r[2],a.push(generateFilterString(o,l,"TO"))):-1!==jQuery.inArray("FROM",r)&&-1!==jQuery.inArray("TO",r)?(l=r[2]+"~~"+r[4],a.push(generateFilterString(o,l))):console.log("Invalid number range: ",r);break;default:l=r[1],searchOption=r[2]||"CONTAINS",console.log("Text Field value: ",l," SearchOption: ",searchOption),t.push("".concat(i,"~").concat(c.normalized,"~").concat(c.srctable||"","~").concat(c.srcfield||"","~").concat(c.fdatatype||"","~").concat(c.listingfld||"","~").concat(c.tablename||"")),a.push(generateFilterString("TEXT",l.toLowerCase(),searchOption))}});var i="";t.forEach(function(e,t){i+="".concat(e,"|").concat(a[t],"^^")}),i.endsWith("^^")&&(i=i.substr(0,i.length-2)),console.log("Final pill click string: ",i),i.startsWith("modifiedby~")&&(i=i.replace("modifiedby~","username~")),_entity.filter=i,_entity.getEntityListData(1),$("#filterGroupName").val(e),_entity.filter=_entity.filterObj[e].filter,_entity.filter=a.join("##"),parent.ShowDimmer(!1)}function createFilterLayout(){$("#dvModalFilter").html(""),$.each(_entity.metaData,function(e,t){if("T"===t.hide)return!0;generateFilterHTML(t),_entity.filterObj[t.fldname]&&updateFilterLayout(t.fldname,_entity.filterObj[t.fldname])}),document.querySelectorAll("#dvModalFilter .filter-fld[data-type=DropDown]").forEach(function(e){var t=e.id,a=_toConsumableArray(new Set(_entity.fldData[t]));$(e).append($("<option></option>").val("0").html("--Select--")),a.forEach(function(t){_entity.inValid(t)||e.insertAdjacentHTML("beforeend",'<option value="'.concat(t,'">').concat(t,"</option>"))}),$(e).select2({multiple:!0}).on("select2:unselect select2:select",function(e){$(this).attr("id");var t=$(this).val();t=t.filter(function(e){return"0"!==e}),$(this).val(t),$(this).trigger("change")})});var glCulture=eval(callParent("glCulture")),dtFormat="d/m/Y";"en-us"==glCulture&&(dtFormat="m/d/Y"),$(".flatpickr-input").flatpickr({dateFormat:dtFormat})}function getFirstDayOfWeek(e){var t=(e=new Date(e)).getDay(),a=e.getDate()-t+(0==t?-6:1);return new Date(e.setDate(a))}function generateFilterHTML(e){var t=getFieldDataType(e),a=e.fldcap||"",n=e.fldname,i="";if("BUTTON"!=t.toUpperCase()&&"ATTACHMENTS"!=t.toUpperCase()){switch("n"==e.fdatatype&&(t="Numeric"),t){case"DropDown":i='<div class="row" data-type="'.concat(t,'"><div class="col-md-3 fldCaption"><p class="form-group ">').concat(a,'</p> </div>\n                          <div class="col-md-9 fldCaption">\n                            <select class="form-control filter-fld"  data-type="').concat(t,'" id="').concat(n,'" name="').concat(t,'">\n                            </select>\n                          </div>');break;case"Numeric":i='<div class="row filter-fld" data-type="'.concat(t,'" id="').concat(n,'" data-type="').concat(t,'">\n            <div class="col-md-3 fldCaption">\n            <p class="form-group ">').concat(a,'</p>\n            </div> \n            <div class="col-md-9">\n            <div class="form-group form-row fldCaption">\n            <div class="col-md-6 col">\n            <label>From</label>           \n            <input type="number" id="').concat(n,'_from" class="form-control" data-type="').concat(t,'"/>\n            </div>\n            <div class="col-md-6 col">\n            <label>To</label>           \n            <input type="number" id="').concat(n,'_to" class="form-control" data-type="').concat(t,'"/>\n            </div></div></div>');break;case"Date":var r=["Custom","Today","Yesterday","Tomorrow","This week","Last week","Next week","This month","Last month","Next month","This quarter","Last quarter","Next quarter","This year","Last year","Next year"],o=["customOption","todayOption","yesterdayOption","tomorrowOption","this_weekOption","last_weekOption","next_weekOption","this_monthOption","last_monthOption","next_monthOption","this_quarterOption","last_quarterOption","next_quarterOption","this_yearOption","last_yearOption","next_yearOption"];i+='<div class="row filter-fld" data-type="'.concat(t,'" id="').concat(n,'"><div class="col-md-3 fldCaption"><p class="form-group ">').concat(a,'</p></div>\n                            <div class="col-md-4 fldCaption">\n                            <select class="form-select dateFilter" type="text" id="').concat(n,'_dateoption" name="').concat(n,'" data-field="').concat(n,'" onchange="generateAdvFilterDates(\'').concat(n,"');\">");for(var l=0;l<r.length;l++)i+="<option value=".concat(o[l],">").concat(r[l],"</option>");i+='</select> \n                            </div>\n                            <div class="col-md-5">\n<div class="form-group form-row fldCaption">\n<div class="col-md-6 col">\n<label>From</label>           \n <input id="'.concat(n,'_from" name="').concat(n,'_from" value="" maxlength="10" type="date" class="form-control flatpickr-input" data-input="" onchange="validateDateRange(\'').concat(n,'\');">\n</div>\n<div class="col-md-6 col">\n<label>To</label>           \n<input id="').concat(n,'_to" name="').concat(n,'_to" value="" maxlength="10" type="date" class="form-control flatpickr-input" data-input="" onchange="validateDateRange(\'').concat(n,"');\">\n</div></div></div>   \n                            </div>");break;default:i='<div class="row" data-type="'.concat(t,'">\n            <div class="col-md-3 fldCaption">\n            <p class="form-group ">').concat(a,'</p> \n            </div>\n            <div class="col-md-4 fldValue"> \n            <select class="form-select" type="text" id="').concat(n,'_searchoption" class="form-control">\n            <option value="STARTSWITH">Starts with</option>\n            <option value="CONTAINS">Contains</option>\n            <option value="ENDSWITH">Ends with</option>\n            </select></div>\n            <div class="col-md-5 fldValue"> <input type="text" id="').concat(n,'" class="form-control filter-fld" data-type="').concat(t,'"/></div>\n            </div>')}$("#dvModalFilter").append(i)}}function filterModelClose(){$("#filterGroupName").val(""),$("#filterGroupModalWrapper").modal("hide"),document.getElementById("filterGroupCheckbox").checked=!1,document.getElementById("filterGroupName").disabled=!0,$("#dvModalFilter").html(""),$("#filterModal").modal("hide")}function validateDateRange(e){var t=document.getElementById(e+"_from"),a=document.getElementById(e+"_to"),n=t.value,i=a.value;if(n&&i){var r=parseDate(n),o=parseDate(i);if(!r||!o)return void alert("Invalid date format.");o<r&&(alert('The "To" date cannot be earlier than the "From" date.'),a.value="")}}function formatDateString(e){var t=new Date(e);if(isNaN(t))return"";var a=String(t.getDate()).padStart(2,"0"),n=String(t.getMonth()+1).padStart(2,"0"),i=t.getFullYear(),r=t.getHours(),o=t.getMinutes(),l=t.getSeconds(),c=isDDMMYYYY?"".concat(a,"/").concat(n,"/").concat(i):"".concat(n,"/").concat(a,"/").concat(i);if(0!==r||0!==o||0!==l){var s="".concat(String(r).padStart(2,"0"),":").concat(String(o).padStart(2,"0"),":").concat(String(l).padStart(2,"0"));return"".concat(c," ").concat(s)}return c}var isDDMMYYYY=!0;function parseDate(e){var t,a,n,i=e.split("/");return 3!==i.length?null:(isDDMMYYYY?(t=parseInt(i[0],10),a=parseInt(i[1],10)-1,n=parseInt(i[2],10)):(a=parseInt(i[0],10)-1,t=parseInt(i[1],10),n=parseInt(i[2],10)),new Date(n,a,t))}function getLastWeek(){var e=new Date,t=e.getDay(),a=new Date(e);a.setDate(e.getDate()-t);var n=new Date(a);return n.setDate(a.getDate()-6),{start:a.toISOString().split("T")[0],end:n.toISOString().split("T")[0]}}function getCurrentWeek(){var e=new Date,t=e.getDay(),a=new Date(e);a.setDate(e.getDate()-t);var n=new Date(a);return n.setDate(a.getDate()+6),{start:a.toISOString().split("T")[0],end:n.toISOString().split("T")[0]}}function getNextWeek(){var e=new Date,t=e.getDay(),a=new Date(e);a.setDate(e.getDate()-t+7);var n=new Date(a);return n.setDate(a.getDate()+6),{start:a.toISOString().split("T")[0],end:n.toISOString().split("T")[0]}}function getLastMonth(){var e=new Date,t=e.getFullYear(),a=e.getMonth();return{start:new Date(t,a-1,2).toISOString().split("T")[0],end:new Date(t,a,1).toISOString().split("T")[0]}}function getCurrentMonth(){var e=new Date,t=e.getFullYear(),a=e.getMonth()+1;return{start:t+"-"+("0"+a).slice(-2)+"-01",end:new Date(t,a,1).toISOString().split("T")[0]}}function getNextMonth(){var e=new Date,t=e.getFullYear(),a=e.getMonth()+2;return{start:t+"-"+("0"+a).slice(-2)+"-01",end:new Date(t,a,1).toISOString().split("T")[0]}}function getCurrentQuarter(){var e=new Date,t=e.getFullYear(),a=e.getMonth()+1,n=Math.ceil(a/3);return{start:t+"-"+("0"+(3*(n-1)+1)).slice(-2)+"-01",end:new Date(t,3*n,1).toISOString().split("T")[0]}}function getNextQuarter(){var e=new Date,t=e.getFullYear(),a=e.getMonth()+1,n=Math.ceil(a/3),i=3*n+1;return i>12&&(i=1,t++),{start:t+"-"+("0"+i).slice(-2)+"-01",end:new Date(t,3*n+3,1).toISOString().split("T")[0]}}function getCurrentYear(){var e=(new Date).getFullYear();return{start:e+"-01-01",end:e+"-12-31"}}function getLastYear(){var e=(new Date).getFullYear()-1;return{start:e+"-01-01",end:e+"-12-31"}}function getNextYear(){var e=(new Date).getFullYear()+1;return{start:e+"-01-01",end:e+"-12-31"}}function getDatesBasedonSelection(e){var t={from:"",to:""},a="en-us"==dtCulture?"MM/DD/YYYY":"DD/MM/YYYY";switch(e){case"customOption":break;case"todayOption":var n=new Date;t.from=t.to=moment(n).format(a);break;case"yesterdayOption":(n=new Date).setDate(n.getDate()-1),t.from=t.to=moment(n).format(a);break;case"tomorrowOption":(n=new Date).setDate(n.getDate()+1),t.from=t.to=moment(n).format(a);break;case"this_weekOption":n=getFirstDayOfWeek(new Date);t.from=moment(n).format(a),n.setDate(n.getDate()+6),t.to=moment(n).format(a);break;case"last_weekOption":(n=getFirstDayOfWeek(new Date)).setDate(n.getDate()-7),t.from=moment(n).format(a),n.setDate(n.getDate()+6),t.to=moment(n).format(a);break;case"next_weekOption":(n=getFirstDayOfWeek(new Date)).setDate(n.getDate()+7),t.from=moment(n).format(a),n.setDate(n.getDate()+6),t.to=moment(n).format(a);break;case"this_monthOption":(n=getFirstDayOfWeek(new Date)).setDate(1),t.from=moment(n).format(a),n.setMonth(n.getMonth()+1),n.setDate(0),t.to=moment(n).format(a);break;case"last_monthOption":(n=getFirstDayOfWeek(new Date)).setDate(1),n.setMonth(n.getMonth()-1),t.from=moment(n).format(a),n.setMonth(n.getMonth()+1),n.setDate(0),t.to=moment(n).format(a);break;case"next_monthOption":(n=getFirstDayOfWeek(new Date)).setDate(1),n.setMonth(n.getMonth()+1),t.from=moment(n).format(a),n.setMonth(n.getMonth()+1),n.setDate(0),t.to=moment(n).format(a);break;case"this_quarterOption":n=new Date;var i=Math.floor((n.getMonth()+3)/3);n.setDate(1),n.setMonth(3*i-3),t.from=moment(n).format(a),n.setMonth(n.getMonth()+3),n.setDate(0),t.to=moment(n).format(a);break;case"last_quarterOption":n=new Date;0==(i=Math.floor((n.getMonth()+3)/3)-1)&&(i=4,n.setFullYear(n.getFullYear()-1)),n.setDate(1),n.setMonth(3*i-3),t.from=moment(n).format(a),n.setMonth(n.getMonth()+3),n.setDate(0),t.to=moment(n).format(a);break;case"next_quarterOption":n=new Date;5==(i=Math.floor((n.getMonth()+3)/3)+1)&&(i=1,n.setFullYear(n.getFullYear()+1)),n.setDate(1),n.setMonth(3*i-3),t.from=moment(n).format(a),n.setMonth(n.getMonth()+3),n.setDate(0),t.to=moment(n).format(a);break;case"this_yearOption":(n=new Date).setDate(1),n.setMonth(0),t.from=moment(n).format(a),n.setFullYear(n.getFullYear()+1),n.setMonth(0),n.setDate(0),t.to=moment(n).format(a);break;case"last_yearOption":(n=new Date).setFullYear(n.getFullYear()-1),n.setDate(1),n.setMonth(0),t.from=moment(n).format(a),n.setFullYear(n.getFullYear()+1),n.setMonth(0),n.setDate(0),t.to=moment(n).format(a);break;case"next_yearOption":(n=new Date).setFullYear(n.getFullYear()+1),n.setDate(1),n.setMonth(0),t.from=moment(n).format(a),n.setFullYear(n.getFullYear()+1),n.setMonth(0),n.setDate(0),t.to=moment(n).format(a)}return t}function generateAdvFilterDates(e){var t=document.querySelector("#".concat(e,"_dateoption")).value,a=(new Date,document.querySelector("#".concat(e,"_from"))),n=document.querySelector("#".concat(e,"_to")),i=getDatesBasedonSelection(t);a.value=i.from,n.value=i.to,"customOption"==t?(a.disabled=!1,n.disabled=!1,a.classList.add("disabledDate"),n.classList.add("disabledDate")):(a.disabled=!0,n.disabled=!0,a.classList.remove("disabledDate"),n.classList.remove("disabledDate"))}function getDateBasedOnCulture(e){if(""!=e){var t,a=e.split(" ");if(e=a[0],"en-us"==dtCulture)(t=e.split("/")).length>2&&(e=isPerf&&4==t[0].length?t[2]+"/"+t[0]+"/"+t[1]:t[1]+"/"+t[0]+"/"+t[2]);else(t=e.split("-")).length>2&&isPerf&&4==t[0].length&&(e=t[2]+"/"+t[1]+"/"+t[0]);a[1]&&(e="".concat(e," ").concat(a[1]))}return e}function generateFilterString(e,t,a){var n="";switch(e){case"DROPDOWN":1==(i=t.split(",")).length?n="= '".concat(t,"'"):(n="in (",i.forEach(function(e){n+="'".concat(e,"',")}),n.endsWith(",")&&(n=n.substr(0,n.length-1)),n+=")");break;case"DATE":var i=t.split("~~");n="FROMDATE"==a?">= '".concat(i[0],"'"):"TODATE"==a?"<= '".concat(i[0],"'"):"between '".concat(i[0],"' and '").concat(i[1],"'");break;case"NUMERIC":i=t.split("~~");n="FROM"==a?">= ".concat(i[0]):"TO"==a?"<= ".concat(i[0]):"between ".concat(i[0]," and ").concat(i[1]);break;case"TEXT":n="STARTSWITH"==a?"like '".concat(t,"%'"):"like '%".concat(t,"CONTAINS"==a?"%'":"ENDSWITH"==a?"'":"%'");break;default:n="= '".concat(t,"'")}return n}function applyFilters(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"",t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"",a=arguments.length>2&&arguments[2]!==undefined&&arguments[2];arguments.length>3?arguments[3]:undefined,arguments.length>4?arguments[4]:undefined;JSON.stringify(_entity.filterObj).includes(t)&&console.log("Pill already present, just need to filter"),parent.ShowDimmer(!0);var n=[],i=[],r=document.getElementById("filterGroupName").value;document.getElementById("filterGroupCheckbox").checked&&r&&(_entity.filterObj[t]=_objectSpread(_objectSpread({},_entity.filterObj[t]),{},{customFilterName:r})),null===_entity.filterObj?_entity.filterObj=_defineProperty({},t,{pillText:e,isChecked:a}):_entity.filterObj=_objectSpread(_objectSpread({},_entity.filterObj),{},_defineProperty({},t,{pillText:e,isChecked:a}));var o="en-us"==dtCulture?"MM/DD/YYYY":"DD/MM/YYYY";document.querySelectorAll("#dvModalFilter .filter-fld").forEach(function(e){var a=e.value,r=e.dataset.type;if(!_entity.inValid(r)){r=r.toUpperCase();var l=_entity.metaData.find(function(t){return t.fldname===e.id}),c=r;switch(r){case"DROPDOWN":if(_entity.inValid(a)||0==a)return;a=$(e).val().join(","),n.push("".concat(e.id,"~").concat(l.normalized,"~").concat(l.srctable||"","~").concat(l.srcfield||"","~").concat(l.fdatatype||"","~").concat(l.listingfld||"","~").concat(l.tablename||"")),i.push(generateFilterString(r,a.toLowerCase())),c=c+","+a,_entity.filterObj[t]=_objectSpread(_objectSpread({},_entity.filterObj[t]),{},_defineProperty({},e.id,c));break;case"DATE":var s=e.querySelectorAll("input"),d=s[0],u=s[1];if(""==d.value&&""==u.value)return;n.push("".concat(e.id,"~").concat(l.normalized,"~").concat(l.srctable||"","~").concat(l.srcfield||"","~").concat(l.fdatatype||"","~").concat(l.listingfld||"","~").concat(l.tablename||"")),""!=d.value&&""==u.value?(a=moment(d.value,o).format("DD-MMM-YYYY"),i.push(generateFilterString(r,a,"FROMDATE")),console.log("Applied filter string: ",generateFilterString(r,a,"FROMDATE")),c="customOption"===$("#".concat(e.id,"_dateoption")).val()?c+",customOption,FROMDATE,"+d.value:c+","+$("#".concat(e.id,"_dateoption")).val()):""!=u.value&&""==d.value?(a=moment(u.value,o).format("DD-MMM-YYYY"),i.push(generateFilterString(r,a,"TODATE")),console.log("Applied filter string: ",generateFilterString(r,a,"TODATE")),c="customOption"===$("#".concat(e.id,"_dateoption")).val()?c+",customOption,TODATE,"+u.value:c+","+$("#".concat(e.id,"_dateoption")).val()):(a=moment(d.value,o).format("DD-MMM-YYYY")+"~~"+moment(u.value,o).format("DD-MMM-YYYY"),i.push(generateFilterString(r,a)),console.log("Applied filter string: ",generateFilterString(r,a)),c="customOption"===$("#".concat(e.id,"_dateoption")).val()?c+",customOption,FROMDATE,"+d.value+",TODATE,"+u.value:c+","+$("#".concat(e.id,"_dateoption")).val()),_entity.filterObj[t]=_objectSpread(_objectSpread({},_entity.filterObj[t]),{},_defineProperty({},e.id,c));break;case"NUMERIC":var p=e.querySelectorAll("input"),m=p[0],f=p[1];if(""==m.value&&""==f.value)return;n.push("".concat(e.id,"~").concat(l.normalized,"~").concat(l.srctable||"","~").concat(l.srcfield||"","~").concat(l.fdatatype||"","~").concat(l.listingfld||"","~").concat(l.tablename||"")),""!=m.value&&""==f.value?(a=m.value,i.push(generateFilterString(r,a,"FROM")),console.log("Applied Filter String: ",generateFilterString(r,a,"FROM")),c=c+",FROM,"+m.value):""!=f.value&&""==m.value?(a=f.value,i.push(generateFilterString(r,a,"TO")),console.log("Applied Filter String: ",generateFilterString(r,a,"TO")),c=c+",TO,"+f.value):(a=m.value+"~~"+f.value,i.push(generateFilterString(r,a)),console.log("Applied Filter String: ",generateFilterString(r,a)),c=c+",FROM,"+m.value+",TO,"+f.value),_entity.filterObj[t]=_objectSpread(_objectSpread({},_entity.filterObj[t]),{},_defineProperty({},e.id,c));break;default:if(_entity.inValid(a))return;n.push("".concat(e.id,"~").concat(l.normalized,"~").concat(l.srctable||"","~").concat(l.srcfield||"","~").concat(l.fdatatype||"","~").concat(l.listingfld||"","~").concat(l.tablename||""));var h=document.querySelector("#".concat(e.id,"_searchoption")).value||"CONTAINS";i.push(generateFilterString("TEXT",a.toLowerCase(),h)),c="TEXT,"+a+","+h,_entity.filterObj[t]=_objectSpread(_objectSpread({},_entity.filterObj[t]),{},_defineProperty({},e.id,c))}}});var l="";l="";n.forEach(function(e,t){l+="".concat(e,"|").concat(i[t],"^^")}),l.endsWith("^^")&&(l=l.substr(0,l.length-2)),console.log("Final filter applied string: ",l),t&&(a&&_entity.setSelectedFilters(JSON.stringify(_entity.filterObj)),createPill(_entity.filterObj)),console.log("Filter Object: ",_entity.filterObj),l.startsWith("modifiedby~")&&(l=l.replace("modifiedby~","username~")),_entity.filter=l,_entity.getEntityListData(1),$("#filterModal").modal("hide"),parent.ShowDimmer(!1)}function resetFilters(){parent.ShowDimmer(!0),document.querySelectorAll("#dvModalFilter .filter-fld").forEach(function(e){var t=e.dataset.type;if(!_entity.inValid(t))switch(t=t.toUpperCase()){case"DROPDOWN":$(e).val(""),$(e).trigger("change");break;case"NUMERIC":var a=e.querySelectorAll("input"),n=a[0],i=a[1];n.value="",i.value="";break;case"DATE":var r=e.querySelectorAll("input"),o=r[0],l=r[1];o.value="",l.value="";break;default:e.value=""}}),_entity.filter="",_entity.getEntityListData(1),document.getElementById("customCheckBox").checked=!1,document.getElementById("filterGroupName").disabled=!0}function openFieldSelection(){$("#fieldsModal").modal("show"),""==$("#fields-selection").html()&&createFieldsLayout()}function createFieldsLayout(){var e=document.getElementById("fields-selection"),t=["transid","modifiedby","modifiedon","createdby","createdon"],a=_entity.metaData.filter(function(e){return e.ftransid===_entity.entityTransId&&"F"===e.hide&&"F"==e.griddc&&("DropDown"===e.cdatatype||"c"==e.fdatatype||"d"==e.fdatatype)&&-1==t.indexOf(e.fldname)}),n={};a.forEach(function(e){e.dcname&&(n[e.dcname]||(n[e.dcname]=[]),n[e.dcname].push(e))});var i="";Object.entries(n).forEach(function(e){var t=_slicedToArray(e,2),a=t[0],n=t[1],r=_entity.metaData.find(function(e){return e.dcname==a}).dccaption||a,o=!0;"dc1"==a&&(o=!1),i+='\n        <div class="card KC_Items">\n            <div class="card-header collapsible cursor-pointer rotate '.concat(o?"collapsed":"",'" data-bs-toggle="collapse" aria-expanded="true" data-bs-target="#fields-').concat(a,'">\n                <h3 class="card-title">').concat(r," (").concat(a,')</h3>\n                <div class="card-toolbar rotate-180">\n                    <span class="material-icons material-icons-style material-icons-2">\n                        expand_circle_down\n                    </span>\n                </div>\n            </div>\n            <div class="KC_Items_Content collapse ').concat(o?"":"show",' heightControl pt-0---" id="fields-').concat(a,'">\n            <table class="table table-hover">\n                <tbody id="fields-table-body">'),n.forEach(function(e){i+='<tr><td><input type="checkbox" id="chk_'.concat(e.fldname,'" class="chk-fields chk-relateddataflds" value="').concat(e.fldname,'" data-fldcap="').concat(e.fldcap,'" data-dcname="').concat(a,'"></td>\n          <td><label for="chk_').concat(e.fldname,'">').concat(e.fldcap||"","  (").concat(e.fldname,")</label></td></tr>")}),i+="</tbody></table></div></div>"}),e.innerHTML=i;var r=document.querySelectorAll(".chk-fields");"All"!=_entity.fields?(_entity.fields.split("^").forEach(function(e){e.split("|").forEach(function(e){var t=e.indexOf("=")>-1?e.split("~")[0].split("=")[1]:e.split("~")[0];document.querySelector("#chk_".concat(t))&&(document.querySelector("#chk_".concat(t)).checked=!0)})}),r.length==_entity.fields.split("|").length&&(document.querySelector("#check-all").checked=!0)):(r.forEach(function(e){"dc1"==e.dataset.dcname&&(e.checked=!0)}),_entity.keyField=r[0].value),updateSelectOptions(),r.forEach(function(e){e.addEventListener("change",function(){r.length==document.querySelectorAll(".chk-fields:checked").length?document.querySelector("#check-all").checked=!0:document.querySelector("#check-all").checked=!1,updateSelectOptions()})});var o=document.getElementById("check-all");o.addEventListener("change",function(){var e=o.checked;r.forEach(function(t){t.checked=e}),updateSelectOptions()}),selectField.addEventListener("change",function(){_entity.keyField="";var e=selectField.value;"0"!==e&&""!==e&&(document.querySelector("#chk_".concat(e)).checked=!0,_entity.keyField=e,updateSelectOptions())})}function updateSelectOptions(){var e=document.getElementById("selectField");e.innerHTML="";var t=document.querySelectorAll(".chk-fields");t.forEach(function(t){if(t.checked){var a=t.dataset.fldcap||"",n=document.createElement("option");n.textContent=a,n.value=t.value,e.appendChild(n)}}),e.disabled=!_toConsumableArray(t).some(function(e){return e.checked}),e.value=_entity.keyField}function applyFields(){var e=document.querySelectorAll(".chk-fields:checked");if(0!==e.length){var t=document.getElementById("selectField");if(0!==t.value&&""!==t.value){var a="",n={};e.forEach(function(e){var t=e.dataset.dcname;n[t]||(n[t]=[]);var a=e.value;n[t].push(a)}),Object.entries(n).forEach(function(e){var t=_slicedToArray(e,2),n=(t[0],t[1]),i=_entity.metaData.find(function(e){return e.fldname===n[0]});a+="".concat(i.tablename,"="),n.forEach(function(e){var t=_entity.metaData.find(function(t){return t.fldname===e});a+="".concat(t.fldname,"~").concat(t.normalized,"~").concat(t.srctable||"","~").concat(t.srcfield||"","~").concat(t.allowempty,"|")}),a.endsWith("|")&&(a=a.substr(0,a.length-1)),a+="^"}),a.endsWith("^")&&(a=a.substr(0,a.length-1)),_entity.fields=a,_entity.keyField=t.value,_entity.setSelectedFields()}else showAlertDialog("error","Error: Key Field is not selected.")}else showAlertDialog("error","Error: No fields are selected.")}function resetFields(){var e=document.querySelectorAll(".chk-fields , #check-all");e.forEach(function(e){e.checked=!0}),_entity.fields="All",_entity.keyField=e[0].value,updateSelectOptions(),_entity.setSelectedFields()}function fieldsModelClose(){$("#fieldsModal").modal("hide")}function getFieldDataType(e){return _entity.inValid(e.cdatatype)?"n"==e.fdatatype?"Number":"d"==e.fdatatype?"Date":"c"==e.fdatatype?"Text":"i"==e.fdatatype?"Image":"t"==e.fdatatype?"Large Text":"Text":e.cdatatype}function getKeyField(e){if("All"!=_entity.fields){var t,a,n=_createForOfIteratorHelper(_entity.fields.split("^"));try{for(n.s();!(a=n.n()).done;){var i=a.value.split("~");"T"===i[4]&&(t=i[0].split("=")[1])}}catch(d){n.e(d)}finally{n.f()}if(t){var r=e.find(function(e){return e.fldname===t});if(r)return r}}var o=e.find(function(e){return"Auto Generate"===e.cdatatype});if(o)return o;var l=e.find(function(e){return"F"===e.hide&&"F"===e.allowempty&&"F"===e.allowduplicate});if(l)return l;var c=e.find(function(e){return"F"===e.hide&&"F"===e.allowempty});if(c)return c;var s=e.find(function(e){return"F"===e.hide});return s||e[0]}function getARMLogs(){var e=document.getElementById("logs-table-container");e.innerHTML="Loading logs...",$("#logsModal").modal("show");_entity.callAPI("../aspx/Entity.aspx/GetARMLogsWS",{},!0,function(t){if(t.success)try{var a=JSON.parse(JSON.parse(t.response).d);e.innerHTML=createARMLogsTable(a)}catch(n){e.innerHTML="No Logs available"}})}function createARMLogsTable(e){var t=document.createElement("table");t.className="table table-striped table-bordered";var a=document.createElement("tbody");return e.forEach(function(e){var t=document.createElement("tr"),n=document.createElement("td");n.innerText=e,t.appendChild(n),a.appendChild(t)}),t.appendChild(a),t.outerHTML}function debounce(e,t){var a;return function(){for(var n=this,i=arguments.length,r=new Array(i),o=0;o<i;o++)r[o]=arguments[o];clearTimeout(a),a=setTimeout(function(){e.apply(n,r)},t)}}var searchInput=document.getElementById("searchBox"),liveSearchDebounced=debounce(liveSearch,500);function handleSearchInput(){""===searchInput.value?liveSearch():liveSearchDebounced()}function liveSearch(){var e=document.querySelectorAll(".Project_items"),t=document.querySelectorAll("tbody tr"),a=searchInput.value.toLowerCase();e.forEach(function(e){e.innerText.toLowerCase().includes(a)?e.classList.remove("d-none"):e.classList.add("d-none")}),t.forEach(function(e){e.innerText.toLowerCase().includes(a)?e.classList.remove("d-none"):e.classList.add("d-none")})}searchInput.addEventListener("keyup",handleSearchInput),searchInput.addEventListener("input",handleSearchInput);var isCardView=!0;function toggleView(){var e=arguments.length>0&&arguments[0]!==undefined&&arguments[0];if(pageNo=1,isCardView=!isCardView,_entity.viewMode=isCardView?"card":"table",e){var t={page:"Entity",transId:_entity.entityTransId,properties:{tableView:!isCardView},confirmNeeded:!0,storeData:e,allUsers:!1};_entityCommon.setAnalyticsDataWS(t,successCB=function(){console.log("View state saved successfully")},errorCB=function(e){showAlertDialog("error",e.status+" "+e.statusText)})}if(isCardView)$("#table-body_Container").hide(),$("#body_Container").show(),createCardViewHTML(),$("#viewIcon").text("view_module");else if($("#body_Container").hide(),$("#table-body_Container").show(),_entity.listJson.length>0){$("#table-body_Container").html(createTableViewHTML(_entity.listJson));var a=document.querySelector(".table-responsive");a.removeEventListener("scroll",scrollListener),a.addEventListener("scroll",scrollListener),$("#viewIcon").text("view_list")}else{_entity.listJson=[],document.querySelector("#table-body_Container").innerHTML=_entity.emptyRowsHtml,$("#viewIcon").text("view_module");var n=document.createElement("div");n.classList.add("no-records-message"),n.textContent="No more records",$("#table-body_Container").append(n),setTimeout(function(){$(n).remove()},3e3)}}function onToggleButtonClick(){toggleView(!0)}function createTableViewHTML(e,t){var a=$("#table-body_Container"),n=a.find("table").length>0,i=_entity.keyField||"",r="",o=new Set(["transid","ftransid"]),l=!e.some(function(e){return e[i]});if(!i||!_entity.metaData.some(function(e){return e.fldname===i})){var c=getKeyField(_entity.metaData.filter(function(e){return"T"===e.listingfld}));i=c?c.fldname:_entity.keyField}var s=new Set;if(e.forEach(function(e){for(var t in e)null===e[t]||e[t]===undefined||o.has(t)||s.add(t);Object.entries(e).forEach(function(e){var t=_slicedToArray(e,2),a=t[0],n=t[1];_entity.inValid(_entity.fldData[a])&&(_entity.fldData[a]=[]),_entity.fldData[a].push(n||"")})}),n)a.find("tbody").empty();else{if(r+='<div class="table-responsive"><table class="table table-striped">',r+='<thead class="sticky-header"><tr>',r+='<th><input type="checkbox" id="selectAllCheckbox" onclick="toggleSelectAll(this)"></th>',r+="<th>Edit Form</th>",s.has(i)){var d=_entity.metaData.find(function(e){return e.fldname===i});d&&(r+="<th>".concat(d.fldcap,"</th>"))}var u=new Set;_entity.metaData.forEach(function(e){e.fldname===i||!s.has(e.fldname)||o.has(e.fldname)||l&&"transid"===e.fldname||u.has(e.fldname)||(r+="<th>".concat(e.fldcap,"</th>"),u.add(e.fldname))}),r+="</tr></thead><tbody>"}e.forEach(function(e,t){if(r+="<tr>",r+='<td><input type="checkbox" class="rowCheckbox" data-index="'.concat(t,'" data-recordid="').concat(e.recordid,'"></td>'),r+='<td><button type="button" class="btn btn-icon btn-white btn-color-gray-600 btn-active-primary shadow-sm tb-btn btn-sm me-3" data-bs-toggle="tooltip" title="Edit" data-bs-original-title="Edit" onclick="_entity.editEntity(\''.concat(e.recordid,'\')"><span class="material-icons material-icons-style material-icons-2" style="color: red;">edit_note</span></button></td>'),s.has(i)){var a=_entity.entityName,n=_entity.entityTransId,c=e.recordid,d=e[i],u=e.rno;r+='<td><a href="#" onclick="_entity.openEntityForm(\''.concat(a,"','").concat(n,"', '").concat(c,"', '").concat(d,"', ").concat(u,')">').concat(d,"</a></td>")}else r+="<td></td>";_entity.metaData.forEach(function(t){if(t.fldname!==i&&s.has(t.fldname)&&!o.has(t.fldname)&&(!l||"transid"!==t.fldname)){var a=e[t.fldname],n="";n="T"===a||"F"===a?'\n                        <div class="form-check">\n                            <input class="form-check-input" type="checkbox" '.concat("T"===a?"checked":""," disabled>\n                        </div>"):"docdate"===t.fldname||"modifiedon"===t.fldname&&a?formatDateString(a):"".concat(a||""),r+="<td>".concat(n,"</td>")}}),r+="</tr>"}),n?(a.find("tbody").append(r),updateDataTableOrdering(document.querySelector("#selectAllCheckbox").checked)):(r+="</tbody></table></div>",a.append(r),initializeDataTable())}function initializeDataTable(){$("#table-body_Container .table").DataTable({dom:"Bfrtip",paging:!1,searching:!1,ordering:!0,columnDefs:[{targets:0,orderable:!1}]})}function handleExport(e,t){var a=_entity.entityName,n="en-us"===dtCulture?"MM/DD/YYYY":"DD/MM/YYYY";function i(e,t){if(e.buttons)switch(t){case"Print":e.button(".buttons-print").trigger();break;case"PDF":e.button(".buttons-pdf").trigger();break;case"Excel":e.button(".buttons-excel").trigger();break;default:console.error("Unsupported export action: "+t)}else console.error("Buttons are not initialized for the table")}var r=_entity.listJson.length,o=_entity.entityTransId,l=function(e){switch(e){case"PDF":return"pdf";case"Excel":return"xlsx";case"Print":default:return"pdf"}}(e),c="".concat(a,".").concat(l);r>49?ASB.WebService.ARMExportPushToQueue(o,"list",c,"Entity",n,function(){$("#confirmationModal").modal("show")},function(e){$("#confirmationModal").modal("show"),console.error("Export request failed: ",e)}):isCardView?(createHiddenTableFromMetadata(),$.fn.dataTable.isDataTable("#hiddenTable")&&$("#hiddenTable").DataTable().destroy(),i($("#hiddenTable").DataTable({dom:"Bfrtip",buttons:[{extend:"print"},{extend:"pdf"},{extend:"excel"}],searching:!1,paging:!1,info:!1}),e)):($.fn.dataTable.isDataTable(t)&&$(t).DataTable().destroy(),i($(t).DataTable({dom:"Bfrtip",buttons:[{extend:"print",exportOptions:{columns:":not(:eq(1))"}},{extend:"pdf",exportOptions:{columns:":not(:eq(1))"}},{extend:"excel",exportOptions:{columns:":not(:eq(1))"}}],searching:!1,paging:!1,info:!1}),e))}function createHiddenTableFromMetadata(){$("#hiddenTableContainer").empty();var e='<table id="hiddenTable" class="display nowrap" style="width:100%">\n        <thead><tr>',t=[];_entity.metaData.forEach(function(a){"T"!==a.hide&&(_entity.listJson.some(function(e){return e[a.fldname]&&""!==e[a.fldname].trim()})&&(t.push(a),e+="<th>".concat(a.fldcap,"</th>")))}),e+="</tr></thead><tbody>",_entity.listJson.forEach(function(a){var n=!1,i="<tr>";t.forEach(function(e){var t=a[e.fldname]||"";if(""!==t){if(n=!0,isDateField(e)){var r=new Date(t);if(!isNaN(r))if("modifiedon"===e.fldname.toLowerCase()){var o=r.toLocaleDateString("en-GB",{day:"2-digit",month:"2-digit",year:"numeric"}),l=r.toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit",second:"2-digit"});t="".concat(o," ").concat(l)}else t=r.toLocaleDateString("en-GB",{day:"2-digit",month:"2-digit",year:"numeric"})}else t=t.replace("T"," ").replace(/Z$/,"");i+="<td>".concat(t,"</td>")}else i+="<td></td>"}),i+="</tr>",n&&(e+=i)}),e+="</tbody></table>",$("#hiddenTableContainer").append(e),$("#hiddenTable").DataTable({dom:"Bfrtip",buttons:["excel","pdf","print"]})}function isDateField(e){return"Date"===e.cdatatype||"d"===e.fdatatype||"modifiedon"===e.fldname.toLowerCase()}function toggleSelectAll(e){var t=document.querySelectorAll(".rowCheckbox");t.forEach(function(t){t.checked=e.checked}),updateDataTableOrdering(e.checked);var a=Array.from(t).filter(function(e){return e.checked}).map(function(e){return e.closest("tr").querySelector("td:nth-child(3) a").textContent.trim()});a.length>0&&deleteSelectedRecords(a)}function showNotification(e){document.querySelector("#notificationModal .modal-body").textContent=e,new bootstrap.Modal(document.getElementById("notificationModal")).show()}function deleteSelectedRecords(){var e=document.querySelectorAll(".rowCheckbox:checked");if(0!==e.length){var t=[],a="";e.forEach(function(e,n){var i=e.getAttribute("data-recordid");t.push(i),a+="\n            <row>\n                <rowno>".concat(n+1,"</rowno>\n                <recordid>").concat(i,"</recordid>\n            </row>")});var n=window.top.axTraceFlag?"DeleteRow-".concat(_entity.entityTransId,""):"",i={recIds:t.join(","),transid:_entity.entityTransId,s:'<root axpapp="'.concat(window.top.mainProject,'" trace="').concat(n,'" sessionid="').concat(window.top.mainSessionId,'" stype="iviews" sname="').concat(_entity.entityTransId,'" actname="delete">\n            <varlist>').concat(a,"</varlist>\n        </root>")};try{ASB.WebService.DeleteIviewRow(i.recIds,i.transid,i.s,successCallback)}catch(r){showNotification("Error while deleting records. Please try again."),console.error("Error while deleting records:",r)}}else showNotification("Please select at least one record to delete.")}function updateDataTableOrdering(e){var t=$("#table-body_Container .table").DataTable();e?(t.order([]).draw(),t.columns().every(function(){this.header().setAttribute("data-orderable","false")})):t.columns().every(function(){this.header().removeAttribute("data-orderable")})}function createCardViewHTML(){createListHTML(_entity.listJson,1)}function scrollListener(e){var t=e.target,a=t.scrollTop,n=t.scrollLeft;lastScrollTop!==a&&(lastScrollTop=a,!isFetching&&isScrollAtBottomWithinDiv(t)&&(isFetching=!0,pageNo++,_entity.getEntityListData(pageNo),setTimeout(function(){isFetching=!1},500))),lastScrollLeft=n}